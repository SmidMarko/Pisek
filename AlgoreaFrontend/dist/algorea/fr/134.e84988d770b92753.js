(self.webpackChunkalgorea=self.webpackChunkalgorea||[]).push([[134],{2134:(Ot,Ze,g)=>{"use strict";g.r(Ze),g.d(Ze,{ItemModule:()=>Kg});var d=g(4666),Xe=g(7549),Y=g(3792),D=g(745),e=g(2560);let Je=(()=>{class n{constructor(){}canDeactivate(t,o,r,a){return t?t.beforeUnload():(0,D.of)(!0)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var S=g(6482),M=g(116),U=g(5570),y=g(8977),$=g(4874),Z=g(1944),R=g(3945);function K(){return(0,Z.e)((n,i)=>{let t,o=!1;n.subscribe((0,R.x)(i,r=>{const a=t;t=r,o&&i.next([a,r]),o=!0}))})}var m=g(635),k=g(9295),E=g(2673),Te=g(5179),xe=g(7739),J=g(3158),oe=g(1920),w=g(7794),pe=g(3027),Ce=g(974),ee=g(8604),ae=g(1280),c=g(6507),u=g(2094),f=g(8987);const T="breadcrumbservice",X=(0,ae.zG)(c.n_({itemId:c.Z_,languageTag:c.Z_,title:c.Z_,type:c.i0("Chapter","Task","Course","Skill")}),c.wf(c.r$({attemptId:c.Z_,attemptNumber:c.Z_})));let te=(()=>{class n{constructor(t){this.http=t}getBreadcrumb(t){return this.http.get(`${w.e.apiUrl}/items/${t.path.concat([t.id]).join("/")}/breadcrumbs`,{params:(0,oe.i5)(t)?{attempt_id:t.attemptId}:{parent_attempt_id:t.parentAttemptId}}).pipe((0,u.m)(c.IX(X)),(0,m.U)(o=>{const r=(0,Ce.I)(o[o.length-1]);return o.slice(0,-1).map((a,s)=>({itemId:a.itemId,title:a.title,route:{id:a.itemId,path:o.slice(0,s).map(_=>_.itemId),attemptId:a.attemptId,contentType:(0,ee.yq)(a)},attemptCnt:a.attemptNumber?+a.attemptNumber:void 0})).concat([{itemId:r.itemId,title:r.title,attemptCnt:r.attemptNumber?+r.attemptNumber:void 0,route:t}])}),(0,J.K)(o=>{throw(0,pe.$k)(o,T)}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var P=g(6067),N=g(253),O=g(6562),V=g(1640),z=g(591),qe=g(4503),me=g(8585),x=g(9196),I=g(661),He=g(629),Zn=g(9319),v=g(1167),Qn=g(6249),Nt=g(7900),G=g(9617);const Bn=(0,ae.zG)(c.n_({groupId:c.Z_,login:c.Z_}),c.wf(c.r$({firstName:c.AG(c.Z_),lastName:c.AG(c.Z_)}))),Vn=(0,ae.zG)(c.n_({id:c.Z_,allowsSubmissionsUntil:G.QK,createdAt:G.QK,endedAt:c.AG(G.QK),latestActivityAt:G.QK,scoreComputed:c.Rx,startedAt:c.AG(G.QK),validated:c.O7}),c.wf(c.r$({userCreator:Bn})));let Yn=(()=>{class n{constructor(t){this.http=t}getResults(t){return this.http.get(`${w.e.apiUrl}/items/${t.id}/attempts`,{params:(0,oe.i5)(t)?{attempt_id:t.attemptId}:{parent_attempt_id:t.parentAttemptId}}).pipe((0,u.m)(c.IX(Vn)),(0,m.U)(o=>o.map(r=>({attemptId:r.id,latestActivityAt:r.latestActivityAt,startedAt:r.startedAt,score:r.scoreComputed,validated:r.validated}))))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Qe=g(1050),ye=g(5003),zn=g(7305);let ke=(()=>{class n{constructor(t,o,r,a,s,_,l){this.getBreadcrumbService=t,this.getItemByIdService=o,this.resultActionsService=r,this.getResultsService=a,this.userSessionService=s,this.groupWatchingService=_,this.localeService=l,this.fetchOperation$=new P.t(1),this.refresh$=new N.x,this.scorePatch$=new N.x,this.maxScorePatch$=this.scorePatch$.pipe((0,qe.R)((p,C)=>void 0!==C?Math.max(C,p??0):void 0,void 0),(0,$.O)(void 0),(0,y.x)()),this.profileLanguageMatchesAppLanguage$=this.userSessionService.userProfile$.pipe((0,M.h)(p=>p.defaultLanguage===this.localeService.currentLang?.tag)),this.state$=(0,O.a)([this.fetchOperation$,this.groupWatchingService.watchedGroup$]).pipe((0,me.j)(()=>this.profileLanguageMatchesAppLanguage$),(0,E.w)(([p,C])=>this.fetchItemData(p,C?.route.id).pipe((0,I.iS)({resetter:this.refresh$}))),(0,E.w)(p=>this.maxScorePatch$.pipe((0,m.U)(C=>this.patchScore(p,C)))),(0,x.d)(1)),this.subscription=this.userSessionService.userChanged$.subscribe(p=>this.refreshItem())}fetchItem(t){this.fetchOperation$.next(t)}refreshItem(){this.refresh$.next()}patchItemScore(t){this.scorePatch$.next(t)}ngOnDestroy(){this.refresh$.complete(),this.fetchOperation$.complete(),this.subscription.unsubscribe()}fetchItemData(t,o){return(0,V.D)({route:(0,D.of)(t),item:this.getItemByIdService.get(t.id,o),breadcrumbs:this.getBreadcrumbService.getBreadcrumb(t)}).pipe(function Jn(n){return(0,He.z)((0,E.w)(i=>(0,Zn.z)((0,D.of)(i),n(i).pipe((0,m.U)(t=>({...i,...t}))))))}(r=>(0,v.hO)(r.item)?this.fetchResults(r.route,r.item):z.E))}fetchResults(t,o){return this.getResultsService.getResults(t).pipe((0,E.w)(r=>{if((0,oe.i5)(t)){const _=r.find(l=>l.attemptId===t.attemptId);if(_)return(0,D.of)({results:r,currentResult:_})}const a=(0,Te.RF)(r);if(null!==a)return(0,D.of)({results:r,currentResult:a});if(!(0,Te.BH)(o))return(0,D.of)({results:r});const s=(0,oe.i5)(t)?t.attemptId:t.parentAttemptId;return s?this.resultActionsService.start(t.path.concat([t.id]),s).pipe((0,E.w)(()=>this.getResultsService.getResults(t).pipe((0,m.U)(_=>{const l=(0,Te.RF)(_);if(null===l)throw new Error("Unexpected: result just created not found");return{results:_,currentResult:l}})))):z.E}))}patchScore(t,o){if(!t.data||void 0===o)return t;const r=Math.max(o??0,t.data.currentResult?.score??0),a=Math.max(t.data.item.bestScore,r),s=o>=100||!!t.data.currentResult?.validated;return{...t,data:{...t.data,item:{...t.data.item,bestScore:a},currentResult:t.data.currentResult?{...t.data.currentResult,score:r,validated:s}:void 0}}}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(te),e.LFG(Qn.G),e.LFG(Nt.i),e.LFG(Yn),e.LFG(Qe.o),e.LFG(ye.y),e.LFG(zn.O))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var De=g(9464),lt=g(6624),Dt=g(2581),ve=g(7366),We=g(6101),Hn=g(4583),wt=g(5682),j=g(7551);function Wn(n,i){1&n&&e._UZ(0,"router-outlet")}function Kn(n,i){1&n&&e._UZ(0,"alg-loading")}function jn(n,i){1&n&&(e.TgZ(0,"p",3),e.SDv(1,8),e.qZA())}function eo(n,i){1&n&&(e.TgZ(0,"p",3),e.SDv(1,9),e.qZA())}const to=function(){return{matrixParams:"ignored",queryParams:"ignored",paths:"exact",fragment:"ignored"}};function no(n,i){if(1&n&&(e.ynx(0),e.YNc(1,jn,2,0,"p",1),e.YNc(2,eo,2,0,"ng-template",null,2,e.W1O),e.TgZ(4,"p",3)(5,"span"),e.SDv(6,4),e.qZA(),e.TgZ(7,"a",5,6),e.SDv(9,7),e.qZA()(),e.BQk()),2&n){const t=e.MAs(3),o=e.MAs(8),r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.state.error&&(403===r.state.error.status||404===r.state.error.status))("ngIfElse",t),e.xp6(3),e.Udp("visibility",o.isActive?"hidden":"visible"),e.xp6(3),e.Q6J("routerLinkActiveOptions",e.DdM(5,to))}}const xt="\xC9lements";let oo=(()=>{class n{constructor(t,o,r,a,s,_,l,p,C){this.itemRouter=t,this.activatedRoute=o,this.currentContent=r,this.modeService=a,this.itemDataSource=s,this.userSessionService=_,this.resultActionsService=l,this.getItemPathService=p,this.layoutService=C,this.state=(0,xe.ui)(),this.hasRedirected=!1,this.subscriptions=[],this.activatedRoute.paramMap.pipe((0,Dt.O)(this.userSessionService.userChanged$),(0,M.h)(()=>!("object"==typeof history.state&&history.state?.preventRefetch))).subscribe(h=>this.fetchItemAtRoute(h)),this.subscriptions.push(this.itemDataSource.state$.subscribe(h=>{if(this.state=h,h.isReady)this.hasRedirected=!1,this.currentContent.replace((0,lt.kI)({breadcrumbs:{category:xt,path:h.data.breadcrumbs.map(A=>({title:A.title,hintNumber:A.attemptCnt,navigateTo:()=>t.url(A.route)})),currentPageIdx:h.data.breadcrumbs.length-1},title:null===h.data.item.string.title?void 0:h.data.item.string.title,route:(0,oe.v6)(h.data.route,h.data.currentResult?.attemptId),details:{title:h.data.item.string.title,type:h.data.item.type,attemptId:h.data.currentResult?.attemptId,bestScore:h.data.item.bestScore,currentScore:h.data.currentResult?.score,validated:h.data.currentResult?.validated},score:void 0!==h.data.currentResult?{bestScore:h.data.item.bestScore,currentScore:h.data.currentResult.score,isValidated:h.data.currentResult.validated}:void 0})),h.data.route.answerId&&this.itemRouter.navigateTo({...h.data.route,answerId:void 0},{navExtras:{replaceUrl:!0,state:{preventRefetch:!0}}});else if(h.isError){if((0,pe.i4)(h.error,T)&&((0,pe.Lg)(h.error)||(0,pe.rV)(h.error))){if(this.hasRedirected)throw new Error("Too many redirections (unexpected)");this.hasRedirected=!0;const{contentType:A,id:Q,answerId:L}=this.getItemRoute();if(!Q)throw new Error("Unexpected: item id should exist");this.itemRouter.navigateTo({contentType:A,id:Q,answerId:L},{navExtras:{replaceUrl:!0}})}this.currentContent.clear()}}),this.modeService.modeActions$.pipe((0,M.h)(h=>[De.mw.StartEditing,De.mw.StopEditing].includes(h)),(0,U.V)(this.currentContent.content$.pipe((0,M.h)(lt.Se)))).subscribe(([h,A])=>{this.itemRouter.navigateTo(A.route,{page:h===De.mw.StartEditing?"edit":"details"})}),this.itemDataSource.state$.pipe((0,I.RI)(),(0,y.x)((h,A)=>h.item.id===A.item.id),(0,$.O)(void 0),K(),(0,M.h)(([h,A])=>!!A&&(!h||(0,ee.N2)(h.item)||(0,ee.N2)(A.item))),(0,m.U)(([,h])=>(0,Ce.I)(h).item)).subscribe(h=>{const A=(0,ee.N2)(h)&&!("object"==typeof history.state&&history.state?.preventFullFrame);this.layoutService.configure({fullFrameActive:A})}))}ngOnDestroy(){this.currentContent.clear(),this.subscriptions.forEach(t=>t.unsubscribe()),this.layoutService.fullFrame$.pipe((0,k.q)(1),(0,M.h)(t=>t.active)).subscribe(()=>this.layoutService.configure({fullFrameActive:!1}))}getItemRoute(t){const o=this.activatedRoute.snapshot;if(!o.parent)throw new Error("Unexpected: activated route snapshot has no parent");if(!o.parent.url[0])throw new Error("Unexpected: activated route snapshot parent has no url");return function Xn(n,i){const t=(0,oe.Nj)(n);if(null===t)throw new Error("Unexpected item path prefix");const{id:o,path:r,attemptId:a,parentAttemptId:s,answerId:_}=(0,oe.qi)(i),l=_??void 0;if(!o)return{contentType:t,tag:"error",id:void 0,answerId:l};if(null===r)return{contentType:t,tag:"error",id:o,answerId:l};const p=""===r?[]:r.split(",");return a?{contentType:t,id:o,path:p,attemptId:a,answerId:l}:s?{contentType:t,id:o,path:p,parentAttemptId:s,answerId:l}:{contentType:t,tag:"error",id:o,path:p,answerId:l}}(o.parent.url[0].path,t??o.paramMap)}fetchItemAtRoute(t){const o=this.getItemRoute(t);!function qn(n){return"tag"in n&&"error"===n.tag}(o)?(this.currentContent.replace((0,lt.kI)({route:o,breadcrumbs:{category:xt,path:[],currentPageIdx:-1}})),this.itemDataSource.fetchItem(o)):o.id?(this.state=(0,xe.ui)(),this.solveMissingPathAttempt(o.contentType,o.id,o.path,o.answerId)):this.state=(0,xe.Hj)(new Error("No id in url"))}solveMissingPathAttempt(t,o,r,a){(r?(0,D.of)(r):this.getItemPathService.getItemPath(o)).pipe((0,E.w)(_=>0===_.length?(0,D.of)({contentType:t,id:o,path:_,parentAttemptId:Te.OB,answerId:a}):this.resultActionsService.startWithoutAttempt(_).pipe((0,m.U)(l=>({contentType:t,id:o,path:_,parentAttemptId:l,answerId:a}))))).subscribe({next:_=>this.itemRouter.navigateTo(_,{navExtras:{replaceUrl:!0}}),error:_=>{this.state=(0,xe.Hj)(_ instanceof Error?_:new Error("unknown error")),this.layoutService.configure({fullFrameActive:!1})}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ve.h),e.Y36(Y.gz),e.Y36(We.u),e.Y36(De.dT),e.Y36(ke),e.Y36(Qe.o),e.Y36(Nt.i),e.Y36(Hn.n),e.Y36(wt.P))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-by-id"]],features:[e._Bn([ke])],decls:3,vars:3,consts:function(){let i,t,o,r;return i="Retour \xE0 la ",t=" page d'accueil ",o=" Ce contenu n'existe pas ou vous n'\xEAtes pas autoris\xE9 \xE0 le voir. ",r="Erreur lors du chargement du contenu.",[[4,"ngIf"],["class","alg-error-message",4,"ngIf","ngIfElse"],["unknownError",""],[1,"alg-error-message"],i,["routerLink","/","routerLinkActive","",1,"alg-link","base-color",3,"routerLinkActiveOptions"],["backToHome","routerLinkActive"],t,o,r]},template:function(t,o){1&t&&(e.YNc(0,Wn,1,0,"router-outlet",0),e.YNc(1,Kn,1,0,"alg-loading",0),e.YNc(2,no,10,6,"ng-container",0)),2&t&&(e.Q6J("ngIf",o.state.isReady),e.xp6(1),e.Q6J("ngIf",o.state.isFetching),e.xp6(1),e.Q6J("ngIf",o.state.isError))},dependencies:[d.O5,Y.lC,Y.yS,Y.Od,j.N],styles:[".refresh-button[_ngcontent-%COMP%]{margin-left:.5rem}"]}),n})();var le=g(6646),Ke=g(3280),we=g(8951),io=g(5330),ro=g(1308),yt=g(420),ao=g(2957);var _o=g(5044),kt=g(8947);function Rt(n=0,i=_o.z){return n<0&&(n=0),(0,kt.H)(n,n,i)}var Me=g(2931),se=g(5474),Re=g(833),gt=g(7714);const $t={now:()=>($t.delegate||performance).now(),delegate:void 0},je={schedule(n){let i=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:o}=je;o&&(i=o.requestAnimationFrame,t=o.cancelAnimationFrame);const r=i(a=>{t=void 0,n(a)});return new gt.w0(()=>t?.(r))},requestAnimationFrame(...n){const{delegate:i}=je;return(i?.requestAnimationFrame||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:i}=je;return(i?.cancelAnimationFrame||cancelAnimationFrame)(...n)},delegate:void 0};function Ft(n){const{schedule:i}=je;return new Re.y(t=>{const o=new gt.w0,r=n||$t,a=r.now(),s=_=>{const l=r.now();t.next({timestamp:n?l:_,elapsed:l-a}),t.closed||o.add(i(s))};return o.add(i(s)),o})}const go=Ft();var Be=g(73),Lt=g(9337),Gt=g(2262),et=g(7580),Ut=g(538),Zt=g(1339),mo=g(2047),uo=g(4437);class fo{constructor(i){this.channel=i,this.destroyed=!1}unbind(i,t){return!!this.destroyed||this.channel.unbind(i,t)}bind(i,t,o){return this.channel.bind(i,(a,s)=>{if(!t||this.destroyed)return;const _=l=>{this.destroyed||a.error(l,l instanceof Error?l.toString():"")};try{const l=t(s);if(!(0,uo.b)(l))return a.complete(l);a.delayReturn(!0),l.pipe((0,k.q)(1)).subscribe({next:p=>{this.destroyed||a.complete(p)},error:_})}catch(l){_(l)}},o)}call(i){return new Re.y(t=>{if(this.destroyed)return;const o={...i,success:(...r)=>{t.next(r),t.complete()},error:(r,a)=>t.error(r)};this.channel.call(o)})}notify(i){this.destroyed||this.channel.notify(i)}destroy(){this.destroyed=!0,this.channel.destroy()}}const Eo=c.n_({minScore:c.Rx,maxScore:c.Rx,noScore:c.Rx,randomSeed:c.Rx,readOnly:c.O7,options:c.mI}),To=c.G0(Eo,c.mI,c.Z_,c.Rx,c.O7),Co=c.r$({key:c.Z_,defaultValue:To}),Mo=c.r$({requires:c.Z_,includes:c.IX(c.Z_)}),Jt=c.IM(Mo),So=c.r$({score:c.Rx,message:c.Z_,scoreToken:c.AG(c.Z_)}),Io=c.r$({height:c.Rx,views:Jt,scrollTop:c.Rx}),vo=c.dX,Po=c.r$({autoHeight:c.O7,disablePlatformProgress:c.O7}),bo=c.G0(c.Z_,(0,ae.zG)(c.n_({path:c.Z_}),c.wf(c.r$({newTab:c.O7}))),(0,ae.zG)(c.n_({url:c.Z_}),c.wf(c.r$({newTab:c.O7}))));class Do{constructor(i){this.chan=i,this.platformSet=!1}destroy(){this.chan.destroy()}bindPlatform(i){if(this.platformSet)throw new Error("Task already has a platform set");this.chan.bind("platform.validate",t=>i.validate((0,G.Jx)(c.Z_)(t))),this.chan.bind("platform.getTaskParams",t=>{const[o,r]=Array.isArray(t)?t:[];return i.getTaskParams((0,G.Jx)(Co)({key:o??void 0,defaultValue:r??void 0}))}),this.chan.bind("platform.showView",t=>i.showView((0,G.Jx)(c.Z_)(t))),this.chan.bind("platform.askHint",t=>i.askHint((0,G.Jx)(c.Z_)(t))),this.chan.bind("platform.updateDisplay",t=>i.updateDisplay((0,G.Jx)(Io)(t))),this.chan.bind("platform.openUrl",t=>i.openUrl((0,G.Jx)(bo)(t))),this.chan.bind("platform.log",t=>i.log((0,G.Jx)(vo)(t))),this.chan.bind("platform.updateHeight",t=>i.updateDisplay({height:(0,G.Jx)(c.Rx)(t)})),this.platformSet=!0}load(i){return this.chan.call({method:"task.load",params:i})}unload(){return this.chan.call({method:"task.unload",timeout:2e3})}getHeight(){return this.chan.call({method:"task.getHeight",timeout:500}).pipe((0,m.U)(([i])=>(0,G.Jx)(c.Rx)(i)))}updateToken(i){return this.chan.call({method:"task.updateToken",params:i,timeout:1e4})}getMetaData(){return this.chan.call({method:"task.getMetaData",timeout:2e3}).pipe((0,m.U)(([i])=>(0,G.Jx)(Po)(i)))}getAnswer(){return this.chan.call({method:"task.getAnswer",timeout:2e3}).pipe((0,m.U)(([i])=>(0,G.Jx)(c.Z_)(i)),(0,J.K)(()=>(0,D.of)("")))}reloadAnswer(i){return this.chan.call({method:"task.reloadAnswer",params:i,timeout:2e3})}getState(){return this.chan.call({method:"task.getState",timeout:2e3}).pipe((0,m.U)(([i])=>(0,G.Jx)(c.Z_)(i)),(0,J.K)(()=>(0,D.of)("")))}reloadState(i){return this.chan.call({method:"task.reloadState",params:i,timeout:2e3})}getViews(){return this.chan.call({method:"task.getViews",timeout:2e3}).pipe((0,m.U)(([i])=>(0,G.Jx)(Jt)(i)))}showViews(i){return this.chan.call({method:"task.showViews",params:i,timeout:2e3})}gradeAnswer(i,t){return this.chan.call({method:"task.gradeAnswer",params:[i,t],timeout:4e4}).pipe((0,m.U)(o=>{if(0===o.length)throw new Error("task.gradeAnswer returned no arguments");const[r,a,s]=Array.isArray(o[0])?o[0]:o;return{score:r,message:a,scoreToken:s}}),(0,m.U)((0,G.Jx)(So)))}getResources(){return this.chan.call({method:"task.getResources",params:[],timeout:2e3})}}var ce=g(9941);const wo=c.n_({taskToken:c.Z_});let xo=(()=>{class n{constructor(t){this.http=t}generate(t,o,r){const a=r?new f.LE({fromObject:{as_team_id:r}}):void 0;return this.http.post(`${w.e.apiUrl}/items/${t}/attempts/${o}/generate-task-token`,void 0,{params:a}).pipe((0,m.U)(ce.Te),(0,u.m)(wo),(0,m.U)(s=>s.taskToken))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ko=15*Me.kG;let tt=(()=>{class n{constructor(t){this.taskTokenService=t,this.configFromItem$=new P.t(1),this.configFromIframe$=new P.t(1),this.config$=this.configFromItem$.asObservable(),this.iframe$=this.configFromIframe$.pipe((0,m.U)(o=>o.iframe)),this.taskToken$=this.config$.pipe((0,E.w)(({attemptId:o,route:r})=>this.taskTokenService.generate(r.id,o)),(0,x.d)(1)),this.iframeSrc$=this.taskToken$.pipe((0,Ut.M)(this.config$),(0,m.U)(([o,{url:r,locale:a}])=>function Oo(n,i,t,o="",r){const a=o+function Ao(){const n=Math.floor(922337203*Math.random()).toString();return Math.floor(2e9*Math.random()).toString()+n}(),s=new URL(n);return s.searchParams.set("sToken",i),s.searchParams.set("sPlatform",t),s.searchParams.set("channelId",a),r&&s.searchParams.set("sLocale",r),s.href}(this.checkUrl(r),o,w.e.itemPlatformId,"task-",a)),(0,x.d)(1)),this.task$=this.configFromIframe$.pipe((0,me.j)(({iframe:o})=>(0,Ke.R)(o,"load")),(0,E.w)(({iframe:o,bindPlatform:r})=>function No(n){return new Re.y(i=>{n.contentWindow?(i.next(n.contentWindow),i.complete()):i.error(new Error("contentWindow not set for iframe"))}).pipe(function po(n){return(0,Z.e)((i,t)=>{let o,a,r=!1;const s=()=>{o=i.subscribe((0,R.x)(t,void 0,void 0,_=>{a||(a=new N.x,n(a).subscribe((0,R.x)(t,()=>o?s():r=!0))),a&&a.next(_)})),r&&(o.unsubscribe(),o=null,r=!1,s())};s()})}(i=>i.pipe((0,Zt.g)(100),(0,k.q)(3e3))),(0,E.w)(i=>function ho(n){return new Re.y(i=>{const t=new fo((0,mo.build)({...n,onReady:()=>{i.next(t),i.complete()}}))})}({window:i,origin:"*",scope:new URL(n.src).searchParams.get("channelId")||""})),(0,m.U)(i=>new Do(i)))}(o).pipe((0,E.w)(a=>(r(a),a.load({task:!0,solution:!0,editor:!0,hints:!0,grader:!0,metadata:!0}).pipe((0,Be.h)(a)))))),(0,x.d)(1)),this.initError$=this.configFromIframe$.pipe((0,E.w)(({iframe:o})=>(0,Ke.R)(o,"load"))).pipe((0,E.w)(()=>this.task$),(0,et.V)({first:ko}),(0,J.K)(o=>(0,D.of)(o)),(0,M.h)(o=>o instanceof et.W)),this.urlError$=this.iframeSrc$.pipe((0,J.K)(o=>(0,D.of)(o)),(0,M.h)(o=>o instanceof Error)),this.initialized=!1,this.configured=!1}ngOnDestroy(){this.task$.pipe((0,et.V)(0),(0,J.K)(()=>z.E)).subscribe(t=>t.destroy()),this.configFromItem$.closed||this.configFromItem$.complete(),this.configFromIframe$.closed||this.configFromIframe$.complete()}configure(t,o,r,a,s,_=!1){if(this.configured)throw new Error("task init service can be configured once only");this.configured=!0,this.configFromItem$.next({route:t,url:o,attemptId:r,formerAnswer:a,locale:s,readOnly:_}),this.configFromItem$.complete()}initTask(t,o){if(this.initialized)throw new Error("task init service can be initialized once only");this.initialized=!0,this.configFromIframe$.next({iframe:t,bindPlatform:o}),this.configFromIframe$.complete()}checkUrl(t){try{new URL(t)}catch{throw new Error("Maformed url: \"" + t + "\"")}if(!t.startsWith("http"))throw new Error("Invalid url \"" + t + "\": please provide an http(s) link");if("https:"===globalThis.location.protocol&&t.startsWith("http:"))throw new Error("Invalid url, please provide a secure task url (https)");return t}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(xo))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var Ro=g(8504),Qt=g(4744),ge=g(2395);const $o=c.n_({answer:c.AG(c.Z_),attemptId:c.AG(c.Z_),authorId:c.Z_,id:c.Z_,itemId:c.Z_,score:c.AG(c.Rx),state:c.AG(c.Z_),type:c.i0("Submission","Saved","Current")});let Fo=(()=>{class n{constructor(t){this.http=t}get(t,o,r){const a=new f.LE({fromObject:r?{attempt_id:o,as_team_id:r}:{attempt_id:o}});return this.http.get(`${w.e.apiUrl}/items/${t}/current-answer`,{params:a}).pipe((0,u.m)($o))}update(t,o,r,a){const s=new f.LE({fromObject:a?{attempt_id:o,as_team_id:a}:{attempt_id:o}});return this.http.put(`${w.e.apiUrl}/items/${t}/attempts/${o}/answers/current`,r,{params:s}).pipe((0,m.U)(ce.IZ),(0,m.U)(()=>{}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Lo=(()=>{class n{constructor(t){this.http=t}save(t,o,r){return this.http.post(`${w.e.apiUrl}/items/${t}/attempts/${o}/answers`,r).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Go=c.n_({answerToken:c.Z_});let Uo=(()=>{class n{constructor(t){this.http=t}generate(t,o){return this.http.post(`${w.e.apiUrl}/answers`,{answer:t,task_token:o}).pipe((0,m.U)(ce.Te),(0,u.m)(Go),(0,m.U)(r=>r.answerToken))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Zo=(()=>{class n{constructor(t){this.http=t}save(t,o,r,a){return this.http.post(`${w.e.apiUrl}/items/save-grade`,{task_token:t,answer_token:o,score:r,score_token:a}).pipe((0,m.U)(ce.Te),(0,Be.h)(void 0))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Jo=5*Me.kG;let Bt=(()=>{class n{constructor(t,o,r,a,s){this.taskInitService=t,this.currentAnswerService=o,this.answerService=r,this.answerTokenService=a,this.gradeService=s,this.destroyed$=new N.x,this.errorSubject=new N.x,this.error$=this.errorSubject.asObservable(),this.scoreChange=new N.x,this.scoreChange$=this.scoreChange.asObservable(),this.saved$=new P.t,this.saveError$=new N.x,this.task$=this.taskInitService.task$.pipe((0,we.R)(this.error$)),this.config$=this.taskInitService.config$.pipe((0,we.R)(this.error$)),this.taskToken$=this.taskInitService.taskToken$.pipe((0,we.R)(this.error$)),this.initialAnswer$=this.config$.pipe((0,E.w)(({route:_,attemptId:l,formerAnswer:p,readOnly:C})=>_.answerId?C?(0,D.of)(p):this.loadFormerAsNewCurrentAnswer(_.id,l,p):C?(0,D.of)(p):this.getCurrentAnswer(_.id,l)),(0,Ro.X)(3),(0,x.d)(1)),this.initializedTaskState$=(0,O.a)([this.initialAnswer$.pipe((0,J.K)(()=>z.E)),this.task$]).pipe((0,E.w)(([_,l])=>_?.state?l.reloadState(_.state).pipe((0,Be.h)(void 0)):(0,D.of)(void 0)),(0,x.d)(1)),this.initializedTaskAnswer$=(0,O.a)([this.initialAnswer$.pipe((0,J.K)(()=>z.E)),this.task$]).pipe((0,me.j)(()=>this.initializedTaskState$),(0,E.w)(([_,l])=>_?.answer?l.reloadAnswer(_.answer).pipe((0,Be.h)(void 0)):(0,D.of)(void 0)),(0,x.d)(1)),this.canStartSaveInterval$=this.config$.pipe((0,k.q)(1),(0,M.h)(({readOnly:_})=>!_),(0,m.U)(()=>{}),(0,me.j)(()=>(0,O.a)([this.saved$,this.initializedTaskState$,this.initializedTaskAnswer$]))),this.refreshAnswerAndStatePeriod=Math.max(Jo,(window.taskSaveIntervalInSec??0)*Me.kG),this.answerOrStateChange$=Rt(this.refreshAnswerAndStatePeriod).pipe((0,we.R)(this.destroyed$),(0,E.w)(()=>this.task$),(0,E.w)(_=>(0,V.D)({answer:_.getAnswer(),state:_.getState()})),(0,y.x)((_,l)=>_.answer===l.answer&&_.state===l.state)),this.autoSaveInterval$=this.canStartSaveInterval$.pipe((0,E.w)(()=>this.saved$),(0,Dt.O)(this.saveError$),(0,E.w)(_=>this.answerOrStateChange$.pipe((0,M.h)(l=>l.answer!==_.answer||l.state!==_.state),(0,k.q)(1))),(0,Ut.M)(this.config$),(0,E.w)(([_,{route:l,attemptId:p}])=>this.currentAnswerService.update(l.id,p,_).pipe((0,m.U)(()=>_),(0,J.K)(()=>(0,D.of)(new Error("auto save failed")))))),this.saveAnswerAndStateInterval$=(0,le.T)(this.saved$.pipe((0,m.U)(()=>({success:!0}))),this.saveError$.pipe((0,m.U)(()=>({success:!1})))),this.subscriptions=[this.initializedTaskAnswer$.subscribe({error:_=>this.errorSubject.next(_ instanceof Error?_:new Error("unknown error"))}),this.initializedTaskState$.subscribe({error:_=>this.errorSubject.next(_ instanceof Error?_:new Error("unknown error"))}),this.initialAnswer$.subscribe({next:_=>this.saved$.next({answer:_?.answer??"",state:_?.state??""}),error:_=>this.errorSubject.next((0,pe.MT)(_)?_:new Error("unknown error"))}),this.autoSaveInterval$.subscribe(_=>{_ instanceof Error?this.saveError$.next(_):this.saved$.next(_)})]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.errorSubject.complete(),this.destroyed$.next(),this.destroyed$.complete()}submitAnswer(){const t=this.task$.pipe((0,k.q)(1),(0,E.w)(s=>s.getAnswer()),(0,x.d)(1)),o=(0,O.a)([this.taskToken$,t]).pipe((0,k.q)(1),(0,E.w)(([s,_])=>this.answerTokenService.generate(_,s)),(0,x.d)(1)),r=(0,O.a)([this.task$,t,o]).pipe((0,k.q)(1),(0,E.w)(([s,_,l])=>s.gradeAnswer(_,l)),(0,x.d)(1)),a=(0,O.a)([this.taskToken$,o,r]).pipe((0,k.q)(1),(0,E.w)(([s,_,l])=>this.gradeService.save(s,_,l.score,l.scoreToken??void 0)),(0,x.d)(1));return(0,O.a)([r,a]).pipe((0,J.K)(()=>z.E)).subscribe(([s])=>{void 0!==s.score&&this.scoreChange.next(s.score)}),a}clearAnswer(){return this.task$.pipe((0,k.q)(1),(0,E.w)(t=>t.reloadAnswer("")))}saveAnswerAndState(){return(0,O.a)([this.saved$,this.task$,this.config$]).pipe((0,k.q)(1),(0,et.V)(1),(0,J.K)(()=>z.E),(0,E.w)(([t,o,r])=>(0,V.D)({config:(0,D.of)(r),saved:(0,D.of)(t),current:(0,V.D)({answer:o.getAnswer(),state:o.getState()})})),(0,E.w)(({saved:t,current:o,config:{route:r,attemptId:a,readOnly:s}})=>s||t.answer===o.answer&&t.state===o.state?(0,D.of)({saving:!1}):this.currentAnswerService.update(r.id,a,o).pipe((0,m.U)(()=>({saving:!1})),(0,$.O)({saving:!0}))),(0,Qt.d)({saving:!1}),(0,x.d)(1))}loadFormerAsNewCurrentAnswer(t,o,r){return this.getCurrentAnswer(t,o).pipe((0,M.h)(ge.K0),(0,E.w)(s=>this.answerService.save(t,o,{answer:s.answer??"",state:s.state??""})),(0,Qt.d)(void 0)).pipe((0,E.w)(()=>r?this.currentAnswerService.update(t,o,{answer:r.answer??"",state:r.state??""}).pipe((0,m.U)(()=>r)):(0,D.of)(null)))}getCurrentAnswer(t,o){return this.currentAnswerService.get(t,o).pipe((0,J.K)(r=>{if((0,pe.Lg)(r))return(0,D.of)(null);throw r}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(tt),e.LFG(Fo),e.LFG(Lo),e.LFG(Uo),e.LFG(Zo))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})(),Vt=(()=>{class n{constructor(t){this.initService=t,this.errorSubject=new N.x,this.error$=this.errorSubject.asObservable(),this.displaySubject=new P.t(1),this.display$=this.displaySubject.asObservable().pipe((0,we.R)(this.error$)),this.task$=this.initService.task$.pipe((0,we.R)(this.error$)),this.views$=(0,le.T)(this.task$.pipe((0,E.w)(o=>o.getViews())),this.display$.pipe((0,m.U)(({views:o})=>o),(0,M.h)(ge.pT))).pipe((0,U.V)(this.task$.pipe((0,E.w)(o=>o.getMetaData()))),(0,m.U)(([o,{disablePlatformProgress:r}])=>{const a=this.getAvailableViews(o);return r?a:[...a,"progress"]})),this.activeViewSubject=new P.t(1),this.activeView$=this.activeViewSubject.pipe((0,y.x)(),(0,me.j)(()=>this.task$)),this.showViews$=(0,O.a)([this.initService.task$,this.activeView$]).pipe((0,E.w)(([o,r])=>o.showViews({[r]:!0}))),this.subscriptions=[this.showViews$.subscribe({error:o=>this.errorSubject.next(o instanceof Error?o:new Error("unknown error"))}),(0,O.a)([this.initService.iframe$,this.display$.pipe((0,m.U)(o=>o.scrollTop),(0,M.h)(ge.pT))]).subscribe(([o,r])=>{const a=o.getBoundingClientRect().top+globalThis.scrollY;globalThis.scrollTo({behavior:"smooth",top:a+r})})]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.displaySubject.complete(),this.activeViewSubject.complete(),this.errorSubject.complete()}updateDisplay(t){this.displaySubject.next(t)}showView(t){this.activeViewSubject.next(t)}getAvailableViews(t){return Object.entries(t).filter(([o,r],a,s)=>{const _=!!r.requires,l=s.some(([,p])=>!!p.includes?.includes(o));return!_&&!l}).map(([o])=>o).sort((o,r)=>this.sortView(o,r))}sortView(t,o){const r={task:0,editor:1,submission:2,hints:3,forum:4,solution:5},a=Math.max(...Object.values(r))+1;return(r[t]??a)-(r[o]??a)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(tt))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var dt=g(7887);const Qo=c.n_({taskToken:c.Z_});let Bo=(()=>{class n{constructor(t){this.http=t}ask(t,o){return this.http.post(`${w.e.apiUrl}/items/ask-hint`,{task_token:t,hint_requested:o}).pipe((0,m.U)(ce.Te),(0,u.m)(Qo))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Yt=(()=>{class n{constructor(t,o,r,a,s,_,l,p){this.initService=t,this.answerService=o,this.viewsService=r,this.itemRouter=a,this.activityNavTreeService=s,this.router=_,this.location=l,this.askHintService=p,this.unknownError$=(0,le.T)(this.answerService.error$,this.viewsService.error$).pipe((0,x.d)(1)),this.initError$=this.initService.initError$.pipe((0,x.d)(1)),this.urlError$=this.initService.urlError$.pipe((0,x.d)(1)),this.hintError$=new N.x,this.error$=(0,le.T)(this.initError$,this.urlError$,this.unknownError$).pipe((0,E.w)(C=>(0,se._)(()=>C))),this.task$=this.initService.task$,this.iframeSrc$=this.initService.iframeSrc$,this.views$=this.viewsService.views$,this.display$=this.viewsService.display$,this.activeView$=this.viewsService.activeView$,this.scoreChange$=this.answerService.scoreChange$,this.saveAnswerAndStateInterval$=this.answerService.saveAnswerAndStateInterval$,this.navigateToNext$=this.activityNavTreeService.navigationNeighbors$.pipe((0,m.U)(C=>C.isReady?(C.data?.next??C.data?.parent)?.navigateTo:void 0),(0,x.d)(1)),this.readOnly=!1}get initialized(){return this.initService.initialized}configure(t,o,r,a){this.readOnly=a.readOnly,this.attemptId=r,this.initService.configure(t,o,r,a.formerAnswer,a.locale,a.readOnly)}initTask(t){this.initService.initTask(t,o=>this.bindPlatform(o))}showView(t){this.viewsService.showView(t)}saveAnswerAndState(){return this.answerService.saveAnswerAndState()}bindPlatform(t){if(!this.attemptId)throw new Error('attemptId must be defined. The "configure" method has probably not been called as expected');const o=Number(this.attemptId);if(Number.isNaN(o))throw new Error("random seed must be a number");const r={validate:a=>(this.readOnly?this.validateReadOnly(a):this.validate(a)).pipe((0,Be.h)(void 0)),getTaskParams:()=>({minScore:0,maxScore:100,randomSeed:o,noScore:0,readOnly:this.readOnly,options:{}}),updateHeight:a=>r.updateDisplay({height:a}),updateDisplay:a=>this.viewsService.updateDisplay(a),showView:a=>this.viewsService.showView(a),openUrl:a=>"string"==typeof a?this.navigateToItem(a):"path"in a?this.navigateToItem(a.path,a.newTab):this.navigate(a.url,a.newTab),askHint:a=>(0,O.a)([this.askHint(a),this.task$]).pipe((0,k.q)(1),(0,E.w)(([s,_])=>_.updateToken(s)),(0,m.U)(()=>{}),(0,x.d)(1)),log:a=>{console.log(...a)}};t.bindPlatform(r)}validate(t){switch(t){case"cancel":return this.answerService.clearAnswer();case"nextImmediate":return this.navigateToNextItem();case"next":return this.answerService.submitAnswer().pipe((0,E.w)(()=>this.navigateToNextItem()));case"top":return this.answerService.submitAnswer().pipe((0,E.w)(()=>this.scrollTop()));default:return this.answerService.submitAnswer()}}validateReadOnly(t){switch(t){case"cancel":default:return z.E;case"nextImmediate":case"next":return this.navigateToNextItem();case"top":return this.scrollTop()}}navigateToNextItem(){return this.navigateToNext$.pipe((0,k.q)(1),(0,Lt.b)(t=>{t&&t()}),(0,m.U)(()=>{}))}scrollTop(){return function lo(n){return n?Ft(n):go}().pipe((0,k.q)(1),(0,Lt.b)(()=>window.scrollTo({behavior:"smooth",top:0})),(0,m.U)(()=>{}))}navigateToItem(t,o=!1){const[,...r]=t.split("/"),a=r.pop();if(!a)throw new Error("id must be defined");const s=(0,oe.SH)("activity",a,r);o?this.navigate(this.router.serializeUrl(this.itemRouter.url(s)),!0):this.itemRouter.navigateTo(s)}navigate(t,o=!1){o?(0,Gt.RB)(t,this.location):(0,Gt.hW)(t,this.location)}askHint(t){return this.initService.taskToken$.pipe((0,E.w)(o=>this.askHintService.ask(o,t)),(0,m.U)(o=>o.taskToken),(0,J.K)(o=>{throw this.hintError$.next(),o}))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(tt),e.LFG(Bt),e.LFG(Vt),e.LFG(ve.h),e.LFG(dt.X),e.LFG(Y.F0),e.LFG(d.Ye),e.LFG(Bo))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var Vo=g(2762),q=g(4706),Yo=g(4497),Se=g(5484),zt=g(3037);let Xo=(()=>{class n{constructor(t){this.http=t}publish(t,o){return this.http.post(`${w.e.apiUrl}/items/${t}/attempts/${o}/publish`,null,{context:(new f.qT).set(zt.aM,5e3)}).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var qo=g(4893),ne=g(4723);let Xt=(()=>{class n{constructor(t,o){this.el=t,this.renderer=o,this.algFullHeightContent=!0}resize(){this.setHeight()}ngAfterViewChecked(){this.renderer.setStyle(this.el.nativeElement,"display","block"),this.algFullHeightContent&&this.setHeight()}ngOnChanges(t){t.algFullHeightContent&&!t.algFullHeightContent.firstChange&&(this.algFullHeightContent?this.setHeight():this.unsetHeight())}unsetHeight(){this.renderer.removeStyle(this.el.nativeElement,"min-height"),this.renderer.removeStyle(this.el.nativeElement,"height")}setHeight(){const t=this.el.nativeElement.getBoundingClientRect().top+globalThis.scrollY;this.renderer.removeStyle(this.el.nativeElement,"height"),this.renderer.setStyle(this.el.nativeElement,"min-height",`calc(100vh - ${t}px)`)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.SBq),e.Y36(e.Qsj))},n.\u0275dir=e.lG2({type:n,selectors:[["","algFullHeightContent",""]],hostBindings:function(t,o){1&t&&e.NdJ("resize",function(){return o.resize()},!1,e.Jf7)},inputs:{algFullHeightContent:"algFullHeightContent"},features:[e.TTD]}),n})();var _e=g(6328);function Ho(n,i){if(1&n&&(e.TgZ(0,"div",3),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.label)}}function Wo(n,i){if(1&n&&(e.TgZ(0,"div",4),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.Udp("visibility",t.showDelayedLabel?void 0:"hidden"),e.xp6(1),e.hij(" ",t.delayedLabel," ")}}let qt=(()=>{class n{constructor(){this.label="",this.delay=5,this.showDelayedLabel=!1}ngOnInit(){this.delayedLabel&&(this.subscription=(0,kt.H)(this.delay*Me.kG).subscribe(()=>this.showDelayedLabel=!0))}ngOnDestroy(){this.subscription?.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-task-loader"]],inputs:{label:"label",delayedLabel:"delayedLabel",delay:"delay"},decls:4,vars:2,consts:[[1,"loading","text-center"],["class","label",4,"ngIf"],["class","sub-label",3,"visibility",4,"ngIf"],[1,"label"],[1,"sub-label"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ho,2,1,"div",1),e._UZ(2,"alg-loading"),e.YNc(3,Wo,2,3,"div",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.label),e.xp6(2),e.Q6J("ngIf",o.delayedLabel))},dependencies:[d.O5,j.N],styles:["[_nghost-%COMP%]{position:relative;display:block}.loading[_ngcontent-%COMP%]{padding:1rem}.label[_ngcontent-%COMP%]{font-size:1.6rem;color:var(--base-color)}.sub-label[_ngcontent-%COMP%]{color:var(--base-text-color)}"]}),n})();const Ko=["iframe"],jo=["url","","attemptId","","route",""];function ei(n,i){1&n&&e._UZ(0,"alg-error",13)}function ti(n,i){1&n&&e._UZ(0,"alg-error",17)}function ni(n,i){1&n&&e._UZ(0,"alg-error",19),2&n&&e.s9C("message",i.ngIf.message)}function oi(n,i){if(1&n&&(e.YNc(0,ni,1,1,"alg-error",18),e.ALo(1,"async")),2&n){e.oxw();const t=e.MAs(6),o=e.oxw(3);e.Q6J("ngIf",e.lcZ(1,2,o.urlError$))("ngIfElse",t)}}function ii(n,i){if(1&n&&e._UZ(0,"alg-error",19),2&n){const t=e.oxw(5);e.Q6J("message",t.errorMessage)}}function ri(n,i){if(1&n&&(e.YNc(0,ii,1,1,"alg-error",20),e.ALo(1,"async")),2&n){const t=e.oxw(4);e.Q6J("ngIf",e.lcZ(1,1,t.unknownError$))}}function ai(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ti,1,0,"alg-error",14),e.ALo(2,"async"),e.YNc(3,oi,2,4,"ng-template",null,15,e.W1O),e.YNc(5,ri,2,3,"ng-template",null,16,e.W1O),e.BQk()),2&n){const t=e.MAs(4),o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.initError$))("ngIfElse",t)}}function si(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",7),e.YNc(1,ei,1,0,"ng-template",null,8,e.W1O),e.YNc(3,ai,7,4,"ng-container",9),e.ALo(4,"allowsEditingAll"),e.TgZ(5,"div",10)(6,"p-button",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.showTaskAnyway=!0)}),e.qZA(),e.TgZ(7,"p-button",12),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh.emit())}),e.qZA()()()}if(2&n){const t=e.MAs(2),o=e.oxw(2);e.xp6(3),e.Q6J("ngIf",e.lcZ(4,2,o.editingPermission))("ngIfElse",t)}}function ci(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"p",22)(2,"span"),e.SDv(3,23),e.qZA(),e._UZ(4,"alg-loading",24),e.TgZ(5,"p-button",25),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.skipSave.emit())}),e.qZA()()()}}function _i(n,i){if(1&n&&(e._UZ(0,"iframe",26,27),e.ALo(2,"async"),e.ALo(3,"async")),2&n){const t=i.ngIf,o=e.oxw().ngIf,r=e.oxw();let a;e.Udp("height",o.isReady||r.showTaskAnyway?e.lcZ(2,4,r.iframeHeight$):void 0),e.Q6J("src",t,e.uOi)("algFullHeightContent",!(null==(a=e.lcZ(3,6,r.metadata$))||!a.autoHeight)&&(o.isReady||r.showTaskAnyway))}}function li(n,i){1&n&&e._UZ(0,"alg-task-loader",28)}function gi(n,i){if(1&n&&(e.TgZ(0,"div",1),e.YNc(1,si,8,4,"div",2),e.TgZ(2,"div",3),e.YNc(3,ci,6,0,"div",4),e.YNc(4,_i,4,8,"iframe",5),e.ALo(5,"async"),e.YNc(6,li,1,0,"alg-task-loader",6),e.qZA()()),2&n){const t=i.ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isError&&!o.showTaskAnyway),e.xp6(1),e.Udp("display",t.isError&&!o.showTaskAnyway?"none":"block"),e.Q6J("algFullHeightContent",!0),e.xp6(1),e.Q6J("ngIf",o.savingAnswer),e.xp6(1),e.Q6J("ngIf",e.lcZ(5,7,o.iframeSrc$)),e.xp6(2),e.Q6J("ngIf",t.isFetching)}}const di=.2*Me.kG;let Ht=(()=>{class n{constructor(t,o,r,a,s){this.taskService=t,this.sanitizer=o,this.actionFeedbackService=r,this.publishResultService=a,this.ltiDataSource=s,this.editingPermission={canEdit:q.m$.None},this.taskConfig={readOnly:!1,formerAnswer:null},this.savingAnswer=!1,this.scoreChange=this.taskService.scoreChange$,this.skipSave=new e.vpe,this.refresh=new e.vpe,this.state$=(0,le.T)(this.taskService.task$,this.taskService.error$).pipe((0,I.iS)()),this.initError$=this.taskService.initError$,this.urlError$=this.taskService.urlError$,this.unknownError$=this.taskService.unknownError$,this.iframeSrc$=this.taskService.iframeSrc$.pipe((0,m.U)(_=>this.sanitizer.bypassSecurityTrustResourceUrl(_)),(0,J.K)(()=>z.E)),this.metadata$=this.taskService.task$.pipe((0,E.w)(_=>_.getMetaData()),(0,x.d)(1)),this.iframeHeight$=this.metadata$.pipe((0,E.w)(({autoHeight:_})=>_?(0,D.of)(void 0):(0,le.T)(this.taskService.task$.pipe((0,E.w)(l=>Rt(di).pipe((0,E.w)(()=>l.getHeight())))),this.taskService.display$.pipe((0,m.U)(({height:l})=>l),(0,M.h)(ge.pT))).pipe((0,m.U)(l=>`${l}px`))),(0,y.x)()),this.showTaskAnyway=!1,this.viewChange=this.taskService.activeView$,this.tabsChange=this.taskService.views$.pipe((0,m.U)(_=>_.map(l=>({view:l,name:this.getTabNameByView(l)})))),this.subscriptions=[this.taskService.saveAnswerAndStateInterval$.pipe((0,$.O)({success:!0}),K()).subscribe(([_,l])=>{const C=!_.success&&l.success;if(!l.success&&!this.actionFeedbackService.hasFeedback){const h="Your current progress could not have been saved. Are you connected to the internet?";this.actionFeedbackService.error(h,{life:24*Me.gd})}C&&(this.actionFeedbackService.clear(),this.actionFeedbackService.success("Progress saved!"))}),this.scoreChange.pipe((0,E.w)(()=>this.ltiDataSource.data?this.publishResultService.publish(this.ltiDataSource.data.contentId,this.ltiDataSource.data.attemptId):z.E)).subscribe({error:_=>{const l=(0,pe.Lg)(_)?"You might be unauthenticated anymore, please try relaunching the exercise. If the problem persits contact us.":"An unknown error occurred while publishing your result";this.actionFeedbackService.error(l,{life:10*Me.kG})}}),this.taskService.hintError$.subscribe(()=>this.actionFeedbackService.error("Hint request failed"))],this.errorMessage="Une erreur est survenue. "+"Si le probl\xE8me persiste, contactez-nous."}ngOnInit(){this.taskService.configure(this.route,this.url,this.attemptId,this.taskConfig),this.taskService.showView(this.view??"task")}ngAfterViewChecked(){!this.iframe||this.taskService.initialized||this.taskService.initTask(this.iframe.nativeElement)}ngOnChanges(t){if(t.view&&this.view&&this.taskService.showView(this.view),t.route&&!t.route.firstChange&&t.route.previousValue?.id!==t.route.currentValue?.id)throw new Error("this component does not support changing its route input");if(t.url&&!t.url.firstChange)throw new Error("this component does not support changing its url input");if(t.attemptId&&!t.attemptId.firstChange)throw new Error("this component does not support changing its attemptId input")}ngOnDestroy(){this.actionFeedbackService.hasFeedback&&this.actionFeedbackService.clear(),this.subscriptions.forEach(t=>t.unsubscribe())}saveAnswerAndState(){return this.subscriptions.forEach(t=>t.unsubscribe()),this.taskService.saveAnswerAndState()}getTabNameByView(t){switch(t){case"editor":return "Solve";case"forum":return "Forum";case"hints":return "Hints";case"solution":return "Solution";case"submission":return "Soumission";case"task":return "Statement";default:return(0,Vo.k)(t)}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Yt),e.Y36(Yo.H7),e.Y36(Se.C),e.Y36(Xo),e.Y36(qo.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-display","url","","attemptId","","route",""]],viewQuery:function(t,o){if(1&t&&e.Gf(Ko,5),2&t){let r;e.iGM(r=e.CRH())&&(o.iframe=r.first)}},inputs:{route:"route",url:"url",editingPermission:"editingPermission",attemptId:"attemptId",view:"view",taskConfig:"taskConfig",savingAnswer:"savingAnswer"},outputs:{scoreChange:"scoreChange",skipSave:"skipSave",refresh:"refresh",viewChange:"viewChange",tabsChange:"tabsChange"},features:[e._Bn([Yt,tt,Bt,Vt]),e.TTD],attrs:jo,decls:2,vars:3,consts:function(){let i,t,o,r,a,s,_,l;return i="Loading the task",t="The task is taking an unexpected long time to load... please wait...",o="Show task anyway (for debugging)",r="R\xE9essayer",a="Unable to load the task",s="Cela se produit lorsque l'url de la t\xE2che est invalide. Si l'url est valide et que le probl\xE8me persiste, contactez-nous.",_="Saving answer...",l="Skip",[["class","item-display",4,"ngIf"],[1,"item-display"],["class","errors",4,"ngIf"],[1,"iframe-container",3,"algFullHeightContent"],["class","saving-answer",4,"ngIf"],["allowfullscreen","",3,"height","src","algFullHeightContent",4,"ngIf"],["label",i,"delayedLabel",t,4,"ngIf"],[1,"errors"],["defaultErrorMessage",""],[4,"ngIf","ngIfElse"],[1,"error-buttons"],["styleClass","alg-button","label",o,1,"error-button",3,"click"],["styleClass","alg-button","label",r,1,"error-button",3,"click"],["message",a],["message",s,4,"ngIf","ngIfElse"],["urlError",""],["unknownError",""],["message",s],[3,"message",4,"ngIf","ngIfElse"],[3,"message"],[3,"message",4,"ngIf"],[1,"saving-answer"],[1,"saving-answer-message"],_,["size","medium"],["type","button","label",l,3,"click"],["allowfullscreen","",3,"src","algFullHeightContent"],["iframe",""],["label",i,"delayedLabel",t]]},template:function(t,o){1&t&&(e.YNc(0,gi,7,9,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.O5,ne.q,j.N,Xt,_e.zx,qt,d.Ov,q.fy],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}[_nghost-%COMP%]   .item-display[_ngcontent-%COMP%]{background-color:#f1f2f7;background-color:var(--base-bk-color)}[_nghost-%COMP%]   .errors[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .iframe-container[_ngcontent-%COMP%]{position:relative;min-height:12rem;background-color:#fff}[_nghost-%COMP%]   .iframe-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{display:block;min-height:100%}[_nghost-%COMP%]   .saving-answer[_ngcontent-%COMP%]{background-color:#4a4a4ab3;position:absolute;z-index:10;top:0;left:0;height:100%;width:100%;text-align:center}[_nghost-%COMP%]   .saving-answer-message[_ngcontent-%COMP%]{margin:0;margin-top:5rem;padding:.5rem 2rem;background:#F1F2F7;background:var(--base-bk-color);border-radius:.5rem;font-size:1.25em;display:inline-flex;align-items:center;justify-content:center}[_nghost-%COMP%]   iframe[_ngcontent-%COMP%]{height:0;width:100%;border:none}[_nghost-%COMP%]   .error-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .error-button[_ngcontent-%COMP%]:first-child{margin-right:1rem}"]}),n})();var $e=g(458),pt=g(1203),F=g(9350),ie=g(8520);const pi=["op"];function mi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-inputNumber",30),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(2).$implicit;return e.KtG(a.scoreWeight=r)})("ngModelChange",function(){e.CHM(t);const r=e.oxw(7);return e.KtG(r.onScoreWeightChange())}),e.qZA()}if(2&n){const t=e.oxw(2).$implicit;e.Q6J("size",3)("ngModel",t.scoreWeight)("min",0)("max",100)("ariaRequired",!0)}}function ui(n,i){if(1&n&&e._uU(0),2&n){const t=e.oxw(2).$implicit;e.hij(" x",t.scoreWeight," ")}}function hi(n,i){1&n&&(e.ynx(0),e.TgZ(1,"td",27)(2,"p-cellEditor"),e.YNc(3,mi,1,5,"ng-template",28),e.YNc(4,ui,1,1,"ng-template",29),e.qZA()(),e.BQk())}const fi=function(n){return{disabled:n}};function Ei(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"td")(2,"span",31),e._uU(3),e.qZA()(),e.TgZ(4,"td",32)(5,"a",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,a=e.oxw(5);return e.KtG(a.onClick(r))}),e._uU(6),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.type),e.xp6(2),e.Q6J("ngClass",e.VKq(3,fi,!t.id)),e.xp6(1),e.hij(" ",t.title," ")}}function Ti(n,i){if(1&n&&(e.TgZ(0,"td",32),e.ynx(1),e.SDv(2,34),e.BQk(),e._uU(3),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(3),e.hij(" (",t.id,")")}}const Ci=function(n,i,t){return{"fa-eye":n,"fa-lock":i,"fa-eye-slash":t}};function Mi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr",17)(1,"td",18),e._UZ(2,"i",19),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"p-tableCheckbox",20),e.qZA(),e.YNc(5,hi,5,0,"ng-container",0),e.YNc(6,Ei,7,5,"ng-container",21),e.YNc(7,Ti,4,1,"ng-template",null,22,e.W1O),e.TgZ(9,"td")(10,"div",23,24)(12,"button",25),e.NdJ("click",function(r){const s=e.CHM(t).rowIndex,_=e.MAs(11),l=e.oxw(5);return e.KtG(l.openPropagationEditMenu(r,_,s))}),e._UZ(13,"i",26),e.qZA()()()()}if(2&n){const t=i.$implicit,o=i.rowIndex,r=e.MAs(8),a=e.oxw(5);e.Q6J("pSelectableRow",t)("pReorderableRow",o),e.xp6(1),e.Q6J("pReorderableRowHandle",o),e.xp6(1),e.Q6J("pReorderableRowHandle",o),e.xp6(2),e.Q6J("value",t),e.xp6(1),e.Q6J("ngIf",a.scoreWeightEnabled),e.xp6(1),e.Q6J("ngIf",t.isVisible)("ngIfElse",r),e.xp6(7),e.Q6J("ngClass",e.kEZ(9,Ci,"as_content"===t.contentViewPropagation,"as_info"===t.contentViewPropagation,"none"===t.contentViewPropagation))}}const Si=function(n){return{disabled:n}};function Ii(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",35),e._UZ(1,"span",36)(2,"p-tableHeaderCheckbox"),e.TgZ(3,"span",37),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.onSelectAll())}),e.SDv(4,38),e.qZA(),e._UZ(5,"span",39),e.TgZ(6,"div",40)(7,"span",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.onRemove())}),e.TgZ(8,"span"),e.SDv(9,42),e.qZA(),e._UZ(10,"i",43),e.qZA()()()}if(2&n){const t=e.oxw(5);e.xp6(7),e.Q6J("ngClass",e.VKq(1,Si,0===t.selectedRows.length))}}function vi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-table",14),e.NdJ("selectionChange",function(r){e.CHM(t);const a=e.oxw(4);return e.KtG(a.selectedRows=r)})("onRowReorder",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.orderChanged())}),e.YNc(1,Mi,14,13,"ng-template",15),e.YNc(2,Ii,11,3,"ng-template",16),e.qZA()}if(2&n){const t=e.oxw(4);e.Q6J("value",t.data)("reorderableColumns",!0)("selection",t.selectedRows)}}function Pi(n,i){1&n&&(e.TgZ(0,"p"),e.SDv(1,44),e.qZA())}function bi(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",5)(2,"div",6)(3,"div",7)(4,"span",8),e.SDv(5,9),e.qZA(),e.TgZ(6,"alg-switch",10),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.scoreWeightEnabled=r)})("ngModelChange",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onEnableScoreWeightChange(r))}),e.qZA()()(),e.YNc(7,vi,3,3,"p-table",11),e.YNc(8,Pi,2,0,"p",0),e.qZA(),e.TgZ(9,"div",12)(10,"alg-add-item",13),e.NdJ("contentAdded",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.addChild(r))}),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw(3);e.xp6(6),e.Q6J("ngModel",t.scoreWeightEnabled),e.xp6(1),e.Q6J("ngIf",t.data.length),e.xp6(1),e.Q6J("ngIf",!t.data.length),e.xp6(2),e.Q6J("allowSkills","Skill"===t.itemData.item.type)("addedItemIds",t.addedItemIds)}}function Ai(n,i){1&n&&e._UZ(0,"alg-loading")}function Oi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",45),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.reloadData())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function Ni(n,i){if(1&n&&(e.ynx(0),e.YNc(1,bi,11,5,"ng-container",0),e.YNc(2,Ai,1,0,"alg-loading",0),e.YNc(3,Oi,1,1,"alg-error",4),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",t.isReady),e.xp6(1),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError)}}function Di(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ni,4,3,"ng-container",0),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.itemData)}}function wi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-propagation-edit-menu",47),e.NdJ("clickEvent",function(r){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onContentViewPropagationChanged(r))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("childData",t.data[t.propagationEditItemIdx])}}function xi(n,i){if(1&n&&e.YNc(0,wi,1,1,"alg-propagation-edit-menu",46),2&n){const t=e.oxw();e.Q6J("ngIf",void 0!==t.propagationEditItemIdx)}}const yi=function(){return{minWidth:"112px",maxWidth:"280px"}};let Kt=(()=>{class n{constructor(t,o){this.getItemChildrenService=t,this.itemRouter=o,this.data=[],this.selectedRows=[],this.scoreWeightEnabled=!1,this.addedItemIds=[],this.childrenChanges=new e.vpe,this.params$=new P.t(1),this.refresh$=new N.x,this.state$=this.params$.pipe((0,y.x)((r,a)=>r.id===a.id&&r.attemptId===a.attemptId),(0,E.w)(({id:r,attemptId:a})=>this.getItemChildrenService.getWithInvisibleItems(r,a)),(0,m.U)(r=>r.sort((a,s)=>a.order-s.order).map(a=>{const s={scoreWeight:a.scoreWeight,contentViewPropagation:a.contentViewPropagation,editPropagation:a.editPropagation,grantViewPropagation:a.grantViewPropagation,upperViewLevelsPropagation:a.upperViewLevelsPropagation,watchPropagation:a.watchPropagation,permissions:a.permissions};if((0,$e.p)(a)){const _=(0,Te.RF)(a.results);return{...s,id:a.id,title:a.string.title,type:a.type,isVisible:!0,result:null===_?void 0:{attemptId:_.attemptId,validated:_.validated,score:_.scoreComputed}}}return{...s,id:a.id,isVisible:!1}})),(0,I.iS)({resetter:this.refresh$}),(0,pt.B)())}ngOnInit(){this.subscription=this.state$.pipe((0,I.RI)()).subscribe(t=>{this.data=t,this.scoreWeightEnabled=this.data.some(o=>1!==o.scoreWeight),this.onChildrenListUpdate()})}ngOnDestroy(){this.refresh$.complete(),this.params$.complete(),this.subscription?.unsubscribe()}ngOnChanges(){this.itemData?.currentResult&&this.params$.next({id:this.itemData.item.id,attemptId:this.itemData.currentResult.attemptId})}reloadData(){this.refresh$.next()}addChild(t){const o={canView:v.C1,canWatch:ie.Cm,canEdit:q.JQ,canGrantView:F.WB,isOwner:!0};this.data.push({...t,scoreWeight:1,isVisible:!0,contentViewPropagation:(0,F.Il)(t.permissions??o)?"as_info":"none",permissions:t.permissions??o}),this.onChildrenListUpdate(),this.childrenChanges.emit(this.data)}onSelectAll(){this.selectedRows=this.selectedRows.length===this.data.length?[]:this.data}onRemove(){this.data=this.data.filter(t=>!this.selectedRows.includes(t)),this.onChildrenListUpdate(),this.childrenChanges.emit(this.data),this.selectedRows=[]}orderChanged(){this.childrenChanges.emit(this.data)}reset(){this.reloadData()}onEnableScoreWeightChange(t){t||this.resetScoreWeight()}resetScoreWeight(){this.data=this.data.map(t=>({...t,scoreWeight:1})),this.onChildrenListUpdate(),this.onScoreWeightChange()}onScoreWeightChange(){this.childrenChanges.emit(this.data)}openPropagationEditMenu(t,o,r){this.propagationEditItemIdx=r,this.op?.toggle(t,o)}onContentViewPropagationChanged(t){this.op?.hide(),this.data=this.data.map((o,r)=>r===this.propagationEditItemIdx?{...o,contentViewPropagation:t}:o),this.propagationEditItemIdx=void 0,this.childrenChanges.emit(this.data)}onChildrenListUpdate(){this.recomputeAddedItemIds()}recomputeAddedItemIds(){this.addedItemIds=this.data.map(t=>t.id).filter(ge.pT)}onClick(t){if(!this.itemData||!t.id||!t.isVisible)return;const o=t.result?.attemptId,r=this.itemData.currentResult?.attemptId;!r||this.itemRouter.navigateTo({contentType:(0,ee.yq)(t),id:t.id,path:this.itemData.route.path.concat([this.itemData.item.id]),...o?{attemptId:o}:{parentAttemptId:r}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36($e.q),e.Y36(ve.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-children-edit"]],viewQuery:function(t,o){if(1&t&&e.Gf(pi,5),2&t){let r;e.iGM(r=e.CRH())&&(o.op=r.first)}},inputs:{itemData:"itemData"},outputs:{childrenChanges:"childrenChanges"},features:[e.TTD],decls:5,vars:6,consts:function(){let i,t,o,r,a,s;return i="Error while loading the children items",t="Enable score weight",o="Non-visible content",r="S\xE9lectionner tout",a="Supprimer la s\xE9lection",s="Aucun enfant dans ce chapitre.",[[4,"ngIf"],["styleClass","alg-propagation-edit-menu","appendTo","body"],["op",""],["pTemplate",""],["class","dark","message",i,3,"showRefreshButton","refresh",4,"ngIf"],[1,"section-chapter-wrapper"],[1,"score-weight-container"],[1,"score-weight"],[1,"score-weight-label","alg-base-text-color"],t,["mode","white",3,"ngModel","ngModelChange"],["class","alg-editable-table",3,"value","reorderableColumns","selection","selectionChange","onRowReorder",4,"ngIf"],[1,"add-item-container"],[3,"allowSkills","addedItemIds","contentAdded"],[1,"alg-editable-table",3,"value","reorderableColumns","selection","selectionChange","onRowReorder"],["pTemplate","body"],["pTemplate","summary"],[3,"pSelectableRow","pReorderableRow"],[1,"reorder-handle",3,"pReorderableRowHandle"],[1,"fa","fa-sort",3,"pReorderableRowHandle"],[3,"value"],[4,"ngIf","ngIfElse"],["invisibleChildCells",""],[1,"propagation-state-wrapper"],["propagationStateWrapperTarget",""],["type","button",1,"alg-button-icon","base-color",3,"click"],[1,"fa",3,"ngClass"],["pEditableColumn",""],["pTemplate","input"],["pTemplate","output"],[3,"size","ngModel","min","max","ariaRequired","ngModelChange"],[1,"type"],[1,"flex-1"],[1,"main","alg-link",3,"ngClass","click"],o,[1,"summary"],[1,"spacer"],[1,"select-all",3,"click"],r,[1,"filler"],[1,"summary-actions"],[3,"ngClass","click"],a,[1,"fa","fa-trash-alt"],s,["message",i,1,"dark",3,"showRefreshButton","refresh"],[3,"childData","clickEvent",4,"ngIf"],[3,"childData","clickEvent"]]},template:function(t,o){1&t&&(e.YNc(0,Di,2,1,"ng-container",0),e.ALo(1,"async"),e.TgZ(2,"p-overlayPanel",1,2),e.YNc(4,xi,1,1,"ng-template",3),e.qZA()),2&t&&(e.Q6J("ngIf",e.lcZ(1,3,o.state$)),e.xp6(2),e.Akn(e.DdM(5,yi)))},styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.section-chapter-wrapper[_ngcontent-%COMP%]{padding:0 2rem}.add-item-container[_ngcontent-%COMP%]{padding-left:5.8333rem;padding-right:1.6667rem}.reorder-handle[_ngcontent-%COMP%]{cursor:grab}.main[_ngcontent-%COMP%]{flex:1}.type[_ngcontent-%COMP%]{color:#4a90e2;color:var(--base-color)}.spacer[_ngcontent-%COMP%]{width:2.9rem}.score-weight-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.score-weight[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem}.score-weight-label[_ngcontent-%COMP%]{margin-right:1rem}.propagation-state-wrapper[_ngcontent-%COMP%]{width:3rem;display:flex;justify-content:center;align-items:center}"]}),n})();var Ri=g(4610);const $i=5*Me.kG;let mt=(()=>{class n{constructor(t){this.http=t}updateItem(t,o){return this.http.put(`${w.e.apiUrl}/items/${t}`,o,{context:(new f.qT).set(zt.aM,$i)}).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var jt=g(3392),ut=g(4619);const Fi=["childrenEdit"];function Li(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-floating-save",6),e.NdJ("save",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.save())})("cancel",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onCancel())}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("saving",t.disabled)}}const Gi=function(n){return{disabled:n}};function Ui(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"alg-item-children-edit",3,4),e.NdJ("childrenChanges",function(r){e.CHM(t);const a=e.oxw(2);return e.KtG(a.updateItemChanges(r))}),e.qZA(),e.YNc(3,Li,1,1,"alg-floating-save",5),e.BQk()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("itemData",t.itemData)("ngClass",e.VKq(3,Gi,t.disabled)),e.xp6(2),e.Q6J("ngIf",t.dirty)}}function Zi(n,i){1&n&&(e.TgZ(0,"p",7),e.SDv(1,8),e.qZA())}function Ji(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ui,4,5,"ng-container",1),e.ALo(2,"allowsEditingChildren"),e.YNc(3,Zi,2,0,"ng-template",null,2,e.W1O),e.BQk()),2&n){const t=e.MAs(4),o=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.itemData.item.permissions))("ngIfElse",t)}}let en=(()=>{class n{constructor(t,o,r,a,s,_){this.createItemService=t,this.updateItemService=o,this.itemDataSource=r,this.actionFeedbackService=a,this.pendingChangesService=s,this.currentContentService=_,this.disabled=!1,this.dirty=!1,this.itemChanges={}}isDirty(){return this.dirty}ngOnInit(){this.pendingChangesService.set(this)}ngOnDestroy(){this.pendingChangesService.clear()}updateItemChanges(t){this.dirty=!0,this.itemChanges.children=t}createChildren(){return this.itemChanges.children?0===this.itemChanges.children.length?(0,D.of)([]):(0,V.D)(this.itemChanges.children.map(t=>this.itemData?function ki(n){return!!n.id}(t)||!t.isVisible?(0,D.of)(t):t.title?this.createItemService.create({title:t.title,type:t.type,languageTag:"en",parent:this.itemData.item.id}).pipe((0,m.U)(r=>({id:r,...t}))):(0,se._)(new Error("Something went wrong, the new child is missing his title")):(0,se._)(new Error("Missed item data")))):(0,D.of)(void 0)}updateItem(){return this.createChildren().pipe((0,E.w)(t=>{if(!this.itemData)return(0,se._)(new Error("Invalid initial data"));if(!t)return(0,se._)(new Error("Unexpected: Children list are empty"));const o={children:[]};return this.itemChanges.children=t,o.children=t.map((r,a)=>({item_id:r.id,order:a,score_weight:r.scoreWeight,content_view_propagation:r.contentViewPropagation,edit_propagation:r.editPropagation,grant_view_propagation:r.grantViewPropagation,upper_view_levels_propagation:r.upperViewLevelsPropagation,watch_propagation:r.watchPropagation})),this.updateItemService.updateItem(this.itemData.item.id,o)}))}save(){this.disabled=!0,this.updateItem().subscribe({next:t=>{this.actionFeedbackService.success("Modifications bien enregistr\xE9es."),this.itemDataSource.refreshItem(),this.currentContentService.forceNavMenuReload()},error:t=>{if(this.disabled=!1,this.actionFeedbackService.unexpectedError(),this.currentContentService.forceNavMenuReload(),!(t instanceof f.UA))throw t}})}onCancel(){this.itemChanges={},this.disabled=!1,this.dirty=!1,this.childrenEdit?.reset()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Ri.O),e.Y36(mt),e.Y36(ke),e.Y36(Se.C),e.Y36(jt.F),e.Y36(We.u))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-children-edit-form"]],viewQuery:function(t,o){if(1&t&&e.Gf(Fi,5),2&t){let r;e.iGM(r=e.CRH())&&(o.childrenEdit=r.first)}},inputs:{itemData:"itemData"},decls:1,vars:1,consts:function(){let i;return i=" You do not have the permissions to edit this content. ",[[4,"ngIf"],[4,"ngIf","ngIfElse"],["notAuthorized",""],[3,"itemData","ngClass","childrenChanges"],["childrenEdit",""],[3,"saving","save","cancel",4,"ngIf"],[3,"saving","save","cancel"],[1,"validation-text"],i]},template:function(t,o){1&t&&e.YNc(0,Ji,5,4,"ng-container",0),2&t&&e.Q6J("ngIf",o.itemData)},dependencies:[d.mk,d.O5,ut.b,Kt,q.pG],styles:[".validation-text[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin:0;padding:1rem;color:var(--base-color);font-size:1.6rem;text-align:center}"]}),n})();var nt=g(1865),ue=g(261);const Qi=["*"];let Bi=(()=>{class n{constructor(){this.icon="pi pi-exclamation-circle"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-message-info"]],inputs:{icon:"icon"},ngContentSelectors:Qi,decls:4,vars:1,consts:[[1,"container"],[1,"message-icon",3,"ngClass"],[1,"message-text"]],template:function(t,o){1&t&&(e.F$t(),e.TgZ(0,"div",0),e._UZ(1,"i",1),e.TgZ(2,"div",2),e.Hsn(3),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngClass",o.icon))},dependencies:[d.mk],styles:[".container[_ngcontent-%COMP%]{padding:.4rem;display:flex;justify-content:flex-start;align-items:center;background-color:var(--warning-color);border-radius:1rem}.message-icon[_ngcontent-%COMP%]{margin:0 1rem;color:#fff;font-size:1.4rem}.message-text[_ngcontent-%COMP%]{color:#fff;font-size:1.4rem}"]}),n})();var Fe=g(7244);const tn=function(n){return{disabled:n}};function Vi(n,i){if(1&n&&(e.TgZ(0,"div",1)(1,"span",2),e._UZ(2,"i"),e.qZA(),e.TgZ(3,"span",3),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.Q6J("ngClass",t.class),e.xp6(1),e.Q6J("ngClass",e.VKq(7,tn,t.disabled)),e.xp6(1),e.Tol(t.icon),e.xp6(1),e.Q6J("ngClass",e.VKq(9,tn,t.disabled)),e.xp6(1),e.hij(" ",t.type," ")}}let Yi=(()=>{class n{constructor(){this.type="Undefined",this.disabled=!1,this.icon="",this.class=""}ngOnChanges(t){switch(this.type){case"Discovery":this.icon="fa fa-book-open";break;case"Application":this.icon="fa fa-code";break;case"Validation":this.icon="fa fa-video";break;case"Challenge":this.icon="fa fa-laptop-code";break;default:this.type="Undefined",this.icon="fa fa-book-open"}this.class=this.type.toLowerCase()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-state-widget"]],inputs:{type:"type",disabled:"disabled"},features:[e.TTD],decls:1,vars:1,consts:[["class","state-container",3,"ngClass",4,"ngIf"],[1,"state-container",3,"ngClass"],[1,"state-icon",3,"ngClass"],[1,"state-label",3,"ngClass"]],template:function(t,o){1&t&&e.YNc(0,Vi,5,11,"div",0),2&t&&e.Q6J("ngIf","Undefined"!==o.type)},dependencies:[d.mk,d.O5],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.state-container[_ngcontent-%COMP%]{width:9rem;height:2rem;border-radius:1rem;color:#fff;display:flex;font-size:.9rem}.state-container.undefined[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{background-color:#2e5e95;background-color:var(--dark-base-color)}.state-container.undefined[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{background-color:#4a90e2;background-color:var(--base-color)}.state-container.discovery[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{background-color:#c2459f}.state-container.discovery[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{background-color:#e044b4}.state-container.application[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{background-color:#d3932b}.state-container.application[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{background-color:#f5a623}.state-container.validation[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{background-color:#8ab262}.state-container.validation[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{background-color:#9acc68}.state-container.challenge[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%], .state-container.challenge[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{background-color:#4a4a4a}.state-container[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;width:3rem;line-height:100%;background-color:#2e5e95;background-color:var(--dark-base-color);border-top-left-radius:9rem;border-bottom-left-radius:9rem}.state-container[_ngcontent-%COMP%]   .state-icon.disabled[_ngcontent-%COMP%]{background-color:#efefef!important;color:#d8d8d8!important}.state-container[_ngcontent-%COMP%]   .state-label[_ngcontent-%COMP%]{flex:1;display:block;background-color:#4a90e2;background-color:var(--base-color);border-top-right-radius:9rem;border-bottom-right-radius:9rem;font-size:.9rem;font-weight:700;padding-left:.5rem;line-height:1.9rem}.state-container[_ngcontent-%COMP%]   .state-label.disabled[_ngcontent-%COMP%]{background-color:#efefef!important;color:#d8d8d8!important}"]}),n})();function zi(n,i){1&n&&e._UZ(0,"alg-loading")}function Xi(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",2),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function qi(n,i){1&n&&(e.TgZ(0,"p",5),e.SDv(1,6),e.qZA())}function Hi(n,i){1&n&&(e.TgZ(0,"p",5),e.SDv(1,7),e.qZA())}function Wi(n,i){if(1&n&&e._UZ(0,"alg-score-ring",16),2&n){const t=e.oxw().$implicit;e.Q6J("diameter",30)("currentScore",t.result.score)("isValidated",t.result.validated)("bestScore",t.bestScore)}}function Ki(n,i){1&n&&e._UZ(0,"i",19)}function ji(n,i){if(1&n&&(e.TgZ(0,"span",17),e.YNc(1,Ki,1,0,"i",18),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.isLocked)}}const er=function(n){return{locked:n}};function tr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"span",10),e.YNc(2,Wi,1,4,"alg-score-ring",11),e.qZA(),e.TgZ(3,"span",12),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(4);return e.KtG(s.click(a))}),e.TgZ(4,"a",13),e._uU(5),e.qZA(),e.YNc(6,ji,2,1,"span",14),e._UZ(7,"alg-state-widget",15),e.qZA()()}if(2&n){const t=i.$implicit,o=i.index;e.xp6(2),e.Q6J("ngIf",!t.isLocked&&t.result),e.xp6(1),e.Q6J("ngClass",e.VKq(6,er,t.isLocked)),e.xp6(2),e.AsE(" ",o+1,". ",t.string.title," "),e.xp6(1),e.Q6J("ngIf",t.isLocked),e.xp6(1),e.Q6J("type",t.category)}}function nr(n,i){if(1&n&&(e.TgZ(0,"ul",8),e.YNc(1,tr,8,8,"li",9),e.qZA()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.children)}}function or(n,i){if(1&n&&(e.ynx(0),e.YNc(1,qi,2,0,"p",3),e.YNc(2,Hi,2,0,"p",3),e.YNc(3,nr,2,1,"ul",4),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.missingValidation),e.xp6(1),e.Q6J("ngIf",0===t.children.length),e.xp6(1),e.Q6J("ngIf",t.children.length>0)}}function ir(n,i){if(1&n&&(e.ynx(0),e.YNc(1,zi,1,0,"alg-loading",0),e.YNc(2,Xi,1,1,"alg-error",1),e.YNc(3,or,4,3,"ng-container",0),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data)}}let rr=(()=>{class n{constructor(t,o){this.getItemChildrenService=t,this.itemRouter=o,this.params$=new P.t(1),this.refresh$=new N.x,this.state$=this.params$.pipe((0,y.x)((r,a)=>r.id===a.id&&r.attemptId===a.attemptId),(0,E.w)(({id:r,attemptId:a})=>this.getItemChildrenService.get(r,a)),(0,m.U)(r=>{const a=r.map(s=>{const _=(0,Te.RF)(s.results);return{...s,isLocked:!(0,v.hO)(s),result:null===_?void 0:{attemptId:_.attemptId,validated:_.validated,score:_.scoreComputed}}});return{children:a,missingValidation:!(this.itemData?.currentResult?.validated||a.filter(s=>"Validation"===s.category).every(s=>s.result&&s.result.validated))}}),(0,I.iS)({resetter:this.refresh$}))}ngOnChanges(t){this.itemData?.currentResult&&this.params$.next({id:this.itemData.item.id,attemptId:this.itemData.currentResult.attemptId})}click(t){if(!this.itemData)return;const o=t.result?.attemptId,r=this.itemData.currentResult?.attemptId;!r||this.itemRouter.navigateTo({contentType:(0,ee.yq)(t),id:t.id,path:this.itemData.route.path.concat([this.itemData.item.id]),...o?{attemptId:o}:{parentAttemptId:r}})}ngOnDestroy(){this.params$.complete(),this.refresh$.complete()}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36($e.q),e.Y36(ve.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-chapter-children"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t,o;return i="Erreur lors du chargement des enfants de ce chapitre",t=" Pour valider ce chapitre, r\xE9solvez toutes les t\xE2ches de type Validation ",o=" Ce chapitre n'a pas contenu visible, vous ne pouvez pas le valider. ",[[4,"ngIf"],["message",i,3,"showRefreshButton","refresh",4,"ngIf"],["message",i,3,"showRefreshButton","refresh"],["class","validation-text",4,"ngIf"],["class","data-list-container activity",4,"ngIf"],[1,"validation-text"],t,o,[1,"data-list-container","activity"],[4,"ngFor","ngForOf"],[1,"activity-progress"],[3,"diameter","currentScore","isValidated","bestScore",4,"ngIf"],[1,"activity-content",3,"ngClass","click"],[1,"activity-title","alg-link"],["class","activity-status",4,"ngIf"],[3,"type"],[3,"diameter","currentScore","isValidated","bestScore"],[1,"activity-status"],["class","fa fa-lock",4,"ngIf"],[1,"fa","fa-lock"]]},template:function(t,o){1&t&&(e.YNc(0,ir,4,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.mk,d.sg,d.O5,Fe.C,Yi,ne.q,j.N,d.Ov],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.validation-text[_ngcontent-%COMP%]{color:#4a90e2;color:var(--base-color);font-size:1.6rem;margin:0;padding:2rem 0;text-align:center}.validation-text[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:0;padding-top:0!important}.data-list-container[_ngcontent-%COMP%]{list-style:none;padding-left:0;margin:0;color:#4a4a4a;color:var(--dark-text-color)}.data-list-container.activity[_ngcontent-%COMP%]{padding:1.6667rem}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;border-bottom:none;padding:0}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-progress[_ngcontent-%COMP%]{width:4.1667rem}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-content[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1;box-sizing:border-box;height:4rem;border-bottom:.1rem solid #EBEBEB;border-bottom:.1rem solid var(--light-border-color);cursor:pointer}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-content.locked[_ngcontent-%COMP%]{color:#dbdbdb;color:var(--light-text-color);cursor:default}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-content[_ngcontent-%COMP%]   .activity-weight[_ngcontent-%COMP%]{margin-right:2rem;width:3.3333rem}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-content[_ngcontent-%COMP%]   .activity-title[_ngcontent-%COMP%]{flex:1}.data-list-container.activity[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .activity-content[_ngcontent-%COMP%]   .activity-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-right:2rem}"]}),n})();var ht=g(8365);function ar(n,i){1&n&&e._UZ(0,"alg-loading")}function sr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",3),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function cr(n,i){1&n&&(e.TgZ(0,"p"),e.SDv(1,5),e.qZA())}function _r(n,i){1&n&&e._UZ(0,"i",14)}function lr(n,i){if(1&n&&(e.TgZ(0,"span",12),e.YNc(1,_r,1,0,"i",13),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.isLocked)}}function gr(n,i){if(1&n&&e._UZ(0,"alg-skill-progress",15),2&n){const t=e.oxw().$implicit;e.Q6J("bestScore",t.bestScore)("currentScore",t.result.score)}}const dr=function(n){return{locked:n}};function pr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"div",8),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(4);return e.KtG(s.click(a))}),e.TgZ(2,"a",9),e._uU(3),e.qZA(),e.YNc(4,lr,2,1,"span",10),e.YNc(5,gr,1,2,"alg-skill-progress",11),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(4,dr,t.isLocked)),e.xp6(2),e.hij(" ",t.string.title," "),e.xp6(1),e.Q6J("ngIf",t.isLocked),e.xp6(1),e.Q6J("ngIf",t.result)}}function mr(n,i){if(1&n&&(e.TgZ(0,"ul",6),e.YNc(1,pr,6,6,"li",7),e.qZA()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}function ur(n,i){if(1&n&&(e.ynx(0),e.YNc(1,cr,2,0,"p",0),e.YNc(2,mr,2,1,"ul",4),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",0===t.length),e.xp6(1),e.Q6J("ngIf",t.length>0)}}function hr(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"alg-section",1),e.YNc(2,ar,1,0,"alg-loading",0),e.YNc(3,sr,1,1,"alg-error",2),e.YNc(4,ur,3,2,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=i.ngIf;e.xp6(2),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data)}}let fr=(()=>{class n{constructor(t,o){this.getItemChildrenService=t,this.itemRouter=o,this.params$=new P.t(1),this.refresh$=new N.x,this.state$=this.params$.pipe((0,y.x)((r,a)=>r.id===a.id&&r.attemptId===a.attemptId),(0,E.w)(({id:r,attemptId:a})=>this.getItemChildrenService.get(r,a)),(0,m.U)(r=>r.filter(a=>(0,ee.$)(a)).map(a=>{const s=(0,Te.RF)(a.results);return{...a,isLocked:!(0,v.hO)(a),result:null===s?void 0:{attemptId:s.attemptId,score:s.scoreComputed}}})),(0,I.iS)({resetter:this.refresh$}))}ngOnChanges(t){this.itemData?.currentResult&&this.params$.next({id:this.itemData.item.id,attemptId:this.itemData.currentResult.attemptId})}click(t){if(!this.itemData)return;const o=t.result?.attemptId,r=this.itemData.currentResult?.attemptId;!r||this.itemRouter.navigateTo({contentType:(0,ee.yq)(t),id:t.id,path:this.itemData.route.path.concat([this.itemData.item.id]),...o?{attemptId:o}:{parentAttemptId:r}})}ngOnDestroy(){this.params$.complete(),this.refresh$.complete()}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36($e.q),e.Y36(ve.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-sub-skills"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t,o;return i="Sous-comp\xE9tences",t="Erreur lors du chargement du contenu",o="Cette comp\xE9tence n'a pas de sous-comp\xE9tence.",[[4,"ngIf"],["label",i,"icon","fa fa-graduation-cap"],["class","dark","message",t,3,"showRefreshButton","refresh",4,"ngIf"],["message",t,1,"dark",3,"showRefreshButton","refresh"],["class","data-list-container sub-skill",4,"ngIf"],o,[1,"data-list-container","sub-skill"],[4,"ngFor","ngForOf"],[1,"skill-content",3,"ngClass","click"],[1,"skill-title","alg-link"],["class","skill-status",4,"ngIf"],["style","width: 25%;","type","thick-horizontal",3,"bestScore","currentScore",4,"ngIf"],[1,"skill-status"],["class","fa fa-lock",4,"ngIf"],[1,"fa","fa-lock"],["type","thick-horizontal",2,"width","25%",3,"bestScore","currentScore"]]},template:function(t,o){1&t&&(e.YNc(0,hr,5,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.mk,d.sg,d.O5,ue.e,ht.D,ne.q,j.N,d.Ov],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.data-list-container[_ngcontent-%COMP%]{list-style:none;padding-left:0;color:#4a4a4a;color:var(--dark-text-color)}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-left:-3.3333rem;border-bottom:none;display:flex;align-items:center}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-icon[_ngcontent-%COMP%]{width:2.9167rem}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]{display:flex;flex:1;padding:.5833rem 0;border-bottom:.1rem solid #EBEBEB;border-bottom:.1rem solid var(--light-border-color);cursor:pointer}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content.locked[_ngcontent-%COMP%]{color:#dbdbdb;color:var(--light-text-color);cursor:default}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-title[_ngcontent-%COMP%]{flex:1}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-icon[_ngcontent-%COMP%]{margin-right:.4167rem}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-right:2rem}"]}),n})();var Ie=g(1633);const Er=c.n_({id:c.Z_,bestScore:c.Rx,string:c.n_({title:c.AG(c.Z_)}),category:c.i0("Undefined","Discovery","Application","Validation","Challenge"),type:c.i0("Chapter","Task","Course","Skill"),permissions:Ie.Cc,result:c.n_({attemptId:c.Z_,latestActivityAt:G.QK,startedAt:c.AG(G.QK),scoreComputed:c.Rx,validated:c.O7})});let Tr=(()=>{class n{constructor(t){this.http=t}get(t,o){let r=new f.LE;return r=r.set("attempt_id",o),this.http.get(`${w.e.apiUrl}/items/${t}/parents`,{params:r}).pipe((0,u.m)(c.IX(Er)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Cr(n,i){1&n&&e._UZ(0,"alg-loading")}function Mr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",3),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function Sr(n,i){1&n&&(e.TgZ(0,"p"),e.SDv(1,5),e.qZA())}function Ir(n,i){1&n&&e._UZ(0,"i",14)}function vr(n,i){if(1&n&&(e.TgZ(0,"span",12),e.YNc(1,Ir,1,0,"i",13),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.isLocked)}}const Pr=function(n){return{locked:n}};function br(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"div",8),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(4);return e.KtG(s.click(a))}),e.TgZ(2,"a",9),e._uU(3),e.qZA(),e.YNc(4,vr,2,1,"span",10),e._UZ(5,"alg-skill-progress",11),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(5,Pr,t.isLocked)),e.xp6(2),e.hij(" ",t.string.title," "),e.xp6(1),e.Q6J("ngIf",t.isLocked),e.xp6(1),e.Q6J("bestScore",t.bestScore)("currentScore",t.result.scoreComputed)}}function Ar(n,i){if(1&n&&(e.TgZ(0,"ul",6),e.YNc(1,br,6,7,"li",7),e.qZA()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}function Or(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Sr,2,0,"p",0),e.YNc(2,Ar,2,1,"ul",4),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",0===t.length),e.xp6(1),e.Q6J("ngIf",t.length>0)}}function Nr(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"alg-section",1),e.YNc(2,Cr,1,0,"alg-loading",0),e.YNc(3,Mr,1,1,"alg-error",2),e.YNc(4,Or,3,2,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=i.ngIf;e.xp6(2),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data)}}let Dr=(()=>{class n{constructor(t,o){this.getItemParentsService=t,this.itemRouter=o,this.params$=new P.t(1),this.refresh$=new N.x,this.state$=this.params$.pipe((0,y.x)((r,a)=>r.id===a.id&&r.attemptId===a.attemptId),(0,E.w)(({id:r,attemptId:a})=>this.getItemParentsService.get(r,a)),(0,m.U)(r=>r.map(a=>({...a,isLocked:!(0,v.hO)(a)}))),(0,I.iS)({resetter:this.refresh$}))}ngOnChanges(t){this.itemData?.currentResult&&this.params$.next({id:this.itemData.item.id,attemptId:this.itemData.currentResult.attemptId})}click(t){!this.itemData||this.itemRouter.navigateTo({contentType:(0,ee.yq)(t),id:t.id,path:this.itemData.route.path.slice(0,-1),attemptId:t.result.attemptId})}ngOnDestroy(){this.params$.complete(),this.refresh$.complete()}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Tr),e.Y36(ve.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-parent-skills"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t,o;return i="Comp\xE9tences parentes",t="Erreur lors du chargement des comp\xE9tences",o="Cette comp\xE9tence n'a pas de comp\xE9tence parente.",[[4,"ngIf"],["label",i,"icon","fa fa-link"],["class","dark","message",t,3,"showRefreshButton","refresh",4,"ngIf"],["message",t,1,"dark",3,"showRefreshButton","refresh"],["class","data-list-container sub-skill",4,"ngIf"],o,[1,"data-list-container","sub-skill"],[4,"ngFor","ngForOf"],[1,"skill-content",3,"ngClass","click"],[1,"skill-title","alg-link"],["class","skill-status",4,"ngIf"],["type","thick-horizontal",2,"width","25%",3,"bestScore","currentScore"],[1,"skill-status"],["class","fa fa-lock",4,"ngIf"],[1,"fa","fa-lock"]]},template:function(t,o){1&t&&(e.YNc(0,Nr,5,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.mk,d.sg,d.O5,ue.e,ht.D,ne.q,j.N,d.Ov],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.data-list-container[_ngcontent-%COMP%]{list-style:none;padding-left:0;color:#4a4a4a;color:var(--dark-text-color)}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-left:-3.3333rem;border-bottom:none;display:flex;align-items:center}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-icon[_ngcontent-%COMP%]{width:2.9167rem}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]{display:flex;flex:1;padding:.5833rem 0;border-bottom:.1rem solid #EBEBEB;border-bottom:.1rem solid var(--light-border-color);cursor:pointer}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content.locked[_ngcontent-%COMP%]{color:#dbdbdb;color:var(--light-text-color);cursor:default}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-title[_ngcontent-%COMP%]{flex:1}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-icon[_ngcontent-%COMP%]{margin-right:.4167rem}.data-list-container.sub-skill[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .skill-content[_ngcontent-%COMP%]   .skill-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-right:2rem}"]}),n})();var wr=g(7260),xr=g(5463);const yr={url:"",deserializer:n=>JSON.parse(n.data),serializer:n=>JSON.stringify(n)};class ft extends N.u{constructor(i,t){if(super(),this._socket=null,i instanceof Re.y)this.destination=t,this.source=i;else{const o=this._config=Object.assign({},yr);if(this._output=new N.x,"string"==typeof i)o.url=i;else for(const r in i)i.hasOwnProperty(r)&&(o[r]=i[r]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new P.t}}lift(i){const t=new ft(this._config,this.destination);return t.operator=i,t.source=this,t}_resetState(){this._socket=null,this.source||(this.destination=new P.t),this._output=new N.x}multiplex(i,t,o){const r=this;return new Re.y(a=>{try{r.next(i())}catch(_){a.error(_)}const s=r.subscribe({next:_=>{try{o(_)&&a.next(_)}catch(l){a.error(l)}},error:_=>a.error(_),complete:()=>a.complete()});return()=>{try{r.next(t())}catch(_){a.error(_)}s.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:i,protocol:t,url:o,binaryType:r}=this._config,a=this._output;let s=null;try{s=t?new i(o,t):new i(o),this._socket=s,r&&(this._socket.binaryType=r)}catch(l){return void a.error(l)}const _=new gt.w0(()=>{this._socket=null,s&&1===s.readyState&&s.close()});s.onopen=l=>{const{_socket:p}=this;if(!p)return s.close(),void this._resetState();const{openObserver:C}=this._config;C&&C.next(l);const h=this.destination;this.destination=xr.Lv.create(A=>{if(1===s.readyState)try{const{serializer:Q}=this._config;s.send(Q(A))}catch(Q){this.destination.error(Q)}},A=>{const{closingObserver:Q}=this._config;Q&&Q.next(void 0),A&&A.code?s.close(A.code,A.reason):a.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:A}=this._config;A&&A.next(void 0),s.close(),this._resetState()}),h&&h instanceof P.t&&_.add(h.subscribe(this.destination))},s.onerror=l=>{this._resetState(),a.error(l)},s.onclose=l=>{s===this._socket&&this._resetState();const{closeObserver:p}=this._config;p&&p.next(l),l.wasClean?a.complete():a.error(l)},s.onmessage=l=>{try{const{deserializer:p}=this._config;a.next(p(l))}catch(p){a.error(p)}}}_subscribe(i){const{source:t}=this;return t?t.subscribe(i):(this._socket||this._connectSocket(),this._output.subscribe(i),i.add(()=>{const{_socket:o}=this;0===this._output.observers.length&&(o&&(1===o.readyState||0===o.readyState)&&o.close(),this._resetState())}),i)}unsubscribe(){const{_socket:i}=this;i&&(1===i.readyState||0===i.readyState)&&i.close(),this._resetState(),super.unsubscribe()}}var nn=g(6241);const $r=c.n_({eventType:c.i0("thread_opened"),byUserId:c.Z_}),Fr=c.n_({eventType:c.i0("thread_closed"),byUserId:c.Z_}),Lr=c.n_({eventType:c.i0("follow"),userId:c.Z_}),Gr=c.n_({eventType:c.i0("unfollow"),userId:c.Z_}),Ur=c.n_({eventType:c.i0("attempt_started"),attemptId:c.Z_}),Zr=(0,ae.zG)(c.n_({eventType:c.i0("submission"),attemptId:c.Z_,answerId:c.Z_}),c.wf(c.r$({score:c.Rx,validated:c.O7}))),Jr=c.n_({eventType:c.i0("message"),userId:c.Z_,content:c.Z_}),Qr=(0,ae.zG)(c.n_({time:G.QK}),c.wf(c.G0($r,Fr,Lr,Ur,Zr,Gr,Jr))),Br=c.n_({status:c.i0("none","closed","opened")});let Vr=(()=>{class n{constructor(t,o,r){if(this.activityLogService=t,this.actionFeedbackService=o,this.http=r,this.clearEvents$=new P.t(1),!w.e.forumServerUrl)throw new Error("cannot instantiate threads service when no forum server url");this.socket=function Rr(n){return new ft(n)}(w.e.forumServerUrl),this.newEvents$=this.socket.pipe((0,u.m)(c.IX(Qr)),(0,J.K)(()=>z.E)),this.events$=this.clearEvents$.pipe((0,E.w)(()=>this.newEvents$.pipe((0,$.O)([]),(0,qe.R)((a,s)=>[...a,...s]))),(0,m.U)(a=>a.sort((s,_)=>s.time.valueOf()-_.time.valueOf()))),this.status$=(0,le.T)(this.clearEvents$.pipe((0,E.w)(()=>this.getStatus())),this.newEvents$.pipe((0,m.U)(a=>a.find(s=>"thread_opened"===s.eventType||"thread_closed"===s.eventType)),(0,m.U)(a=>{switch(a?.eventType){case"thread_closed":return"closed";case"thread_opened":return"opened";default:return}}),(0,M.h)(ge.pT))).pipe((0,y.x)(),(0,x.d)(1))}ngOnDestroy(){this.socket.complete()}init(t){this.tokenData=t,this.clearEvents$.next()}send(t){if(!this.tokenData)throw new Error("service must be initialized");this.socket.next({token:this.tokenData,...t})}open(t){if(!this.tokenData)throw new Error("cannot open thread without token data");const{participantId:o,userId:r,itemId:a}=this.tokenData,s=o===r?void 0:o;this.clearEvents$.next(),this.activityLogService.getActivityLog(a,s).subscribe({next:_=>{this.send({action:"open-thread",history:_}),t()},error:_=>{if(t(),this.actionFeedbackService.error("We could not open a thread, please retry. If the problem persists, contact us"),!(_ instanceof f.UA))throw _}})}close(){this.send({action:"close-thread"})}follow(){this.send({action:"follow"})}unfollow(){this.send({action:"unfollow"})}sendMessage(t){if(!t)throw new Error("Cannot send an empty message");this.send({action:"send-message",message:t})}getStatus(){if(!w.e.forumApiUrl)throw new Error("cannot call forum api");return this.http.post(`${w.e.forumApiUrl}/thread-status`,{token:this.tokenData}).pipe((0,u.m)(Br),(0,J.K)(()=>z.E),(0,m.U)(t=>t.status))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(nn.t),e.LFG(Se.C),e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var b=g(2508);function Yr(n,i){if(1&n&&(e.TgZ(0,"div")(1,"div"),e._uU(2),e.ALo(3,"json"),e.qZA()()),2&n){const t=i.$implicit;e.xp6(2),e.Oqu(e.lcZ(3,1,t))}}function zr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"textarea",10),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.messageToSend=r)}),e.qZA(),e.TgZ(2,"p-button",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.sendMessage())}),e.qZA()()}if(2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngModel",t.messageToSend),e.xp6(1),e.Q6J("disabled",!t.messageToSend.trim())}}function Xr(n,i){if(1&n&&(e.TgZ(0,"div",8),e.YNc(1,Yr,4,3,"div",9),e.YNc(2,zr,3,2,"div",1),e.ALo(3,"async"),e.qZA()),2&n){const t=e.oxw().ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngIf","opened"===e.lcZ(3,2,o.threadStatus$))}}function qr(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Xr,4,4,"div",7),e.BQk()),2&n){const t=i.ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.widgetOpened&&t.length>0)}}function Hr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-button",12),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.openThread())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.openingThread)}}function Wr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-button",13),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.closeThread())}),e.qZA()}}function Kr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.toggleWidget(!1))}),e.qZA()}}function jr(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p-button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.toggleWidget(!0))}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",!e.lcZ(1,1,t.threadStatus$)||"none"===e.lcZ(2,3,t.threadStatus$))}}let ea=(()=>{class n{constructor(t,o,r){this.threadService=t,this.userSession=o,this.groupWatchingService=r,this.messageToSend="",this.openingThread=!1,this.widgetOpened=!1,this.events$=this.threadService.events$,this.threadStatus$=this.threadService.status$,this.canOpenThread$=(0,O.a)([this.groupWatchingService.isWatching$,this.threadStatus$]).pipe((0,m.U)(([a,s])=>!a&&"opened"!==s)),this.canCloseThread$=(0,O.a)([this.groupWatchingService.isWatching$,this.threadStatus$]).pipe((0,m.U)(([a,s])=>!a&&"opened"===s)),this.itemId$=new P.t(1),this.subscriptions=[(0,O.a)([this.itemId$,this.userSession.userProfile$,this.groupWatchingService.watchedGroup$]).pipe((0,J.K)(()=>z.E)).subscribe(([a,s,_])=>{this.threadService.init({participantId:_?.route.id||s.groupId,itemId:a,userId:s.groupId,isMine:!_,canWatchParticipant:!!_})}),this.itemId$.pipe((0,E.w)(()=>this.threadStatus$),(0,k.q)(1)).subscribe(a=>{this.threadService.follow(),this.widgetOpened="opened"===a}),this.itemId$.pipe((0,wr.T)(1)).subscribe(()=>this.threadService.unfollow()),(0,Ke.R)(window,"beforeunload").subscribe(()=>this.threadService.unfollow())]}ngOnChanges(t){if(this.itemId&&t.itemId){const o=t.itemId?.previousValue;this.itemId!==o&&this.itemId$.next(this.itemId)}}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.threadService.unfollow()}openThread(){this.openingThread=!0,this.widgetOpened=!0,this.threadService.open(()=>this.openingThread=!1)}closeThread(){this.widgetOpened=!1,this.threadService.close()}toggleWidget(t){this.widgetOpened=t}sendMessage(){const t=this.messageToSend.trim();!t||(this.threadService.sendMessage(t),this.messageToSend="")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Vr),e.Y36(Qe.o),e.Y36(ye.y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-thread"]],inputs:{itemId:"itemId"},features:[e.TTD],decls:10,vars:11,consts:[[1,"widget"],[4,"ngIf"],[1,"widget-footer"],["label","Open thread",3,"disabled","click",4,"ngIf"],["label","Close thread",3,"click",4,"ngIf"],["label","Hide thread",3,"click",4,"ngIf"],["label","Show thread",3,"disabled","click",4,"ngIf"],["class","widget-body",4,"ngIf"],[1,"widget-body"],[4,"ngFor","ngForOf"],["placeholder","Send a message...",3,"ngModel","ngModelChange"],["label","Submit",3,"disabled","click"],["label","Open thread",3,"disabled","click"],["label","Close thread",3,"click"],["label","Hide thread",3,"click"],["label","Show thread",3,"disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,qr,2,1,"ng-container",1),e.ALo(2,"async"),e.TgZ(3,"div",2),e.YNc(4,Hr,1,1,"p-button",3),e.ALo(5,"async"),e.YNc(6,Wr,1,0,"p-button",4),e.ALo(7,"async"),e.YNc(8,Kr,1,0,"p-button",5),e.YNc(9,jr,3,5,"p-button",6),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,5,o.events$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,7,o.canOpenThread$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,9,o.canCloseThread$)),e.xp6(2),e.Q6J("ngIf",o.widgetOpened),e.xp6(1),e.Q6J("ngIf",!o.widgetOpened))},dependencies:[d.sg,d.O5,b.Fj,b.JJ,b.On,_e.zx,d.Ov,d.Ts],styles:[".widget[_ngcontent-%COMP%]{display:block;position:fixed;bottom:0;right:2rem;background:var(--base-color);color:var(--base-bk-color);border-radius:.25rem;z-index:30;max-height:25rem;overflow-y:auto}.widget-body[_ngcontent-%COMP%], .widget-footer[_ngcontent-%COMP%]{padding:.75rem 1rem}.widget-footer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}"]}),n})();var on=g(6317),rn=g(1989),an=g(8523);const ta=(0,ae.zG)(c.n_({allowsMultipleAttempts:c.O7,bestScore:c.Rx,defaultLanguageTag:c.Z_,dependencyGrantContentView:c.O7,dependencyRequiredScore:c.Rx,displayDetailsInParent:c.O7,duration:c.AG(G.nT),entryParticipantType:c.i0("User","Team"),id:c.Z_,noScore:c.O7,permissions:Ie.Cc,requiresExplicitEntry:c.O7,string:(0,ae.zG)(c.n_({languageTag:c.Z_,title:c.AG(c.Z_)}),c.wf(c.r$({subtitle:c.AG(c.Z_)}))),type:c.i0("Chapter","Task","Course","Skill"),validationType:c.i0("None","All","AllButOne","Categories","One","Manual")}),c.wf(c.r$({watchedGroup:(0,ae.zG)(c.n_({canView:c.i0("none","info","content","content_with_descendants","solution")}),c.wf(c.r$({allValidated:c.O7,avgScore:c.Rx})))})));let sn=(()=>{class n{constructor(t){this.http=t}get(t){return this.http.get(`${w.e.apiUrl}/items/${t}/prerequisites`).pipe((0,u.m)(c.IX(ta)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var cn=g(7233),Ve=g(6664),Et=g(966);const na=["op"],oa=["contentRef"];function ia(n,i){1&n&&e._UZ(0,"alg-loading",3)}function ra(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",4),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function aa(n,i){1&n&&e._UZ(0,"i",18)}function sa(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li",11),e.NdJ("mouseleave",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onMouseLeave(r))}),e.TgZ(1,"div",12)(2,"span",13),e._UZ(3,"alg-score-ring",14),e.qZA(),e.TgZ(4,"a",15,16),e.NdJ("mouseenter",function(r){const a=e.CHM(t),s=a.$implicit,_=a.index,l=e.oxw(3);return e.KtG(l.onMouseEnter(r,s.id,_))}),e.ALo(6,"rawItemLink"),e._uU(7),e.qZA()(),e.YNc(8,aa,1,0,"i",17),e.qZA()}if(2&n){const t=i.$implicit;e.xp6(3),e.Q6J("diameter",30)("bestScore",t.bestScore)("currentScore",t.bestScore),e.xp6(1),e.Q6J("routerLink",e.lcZ(6,6,t)),e.xp6(3),e.hij(" ",t.string.title," "),e.xp6(1),e.Q6J("ngIf",t.isLocked)}}function ca(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"alg-path-suggestion",19),e.NdJ("mouseleave",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.closeOverlay())}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(3);let o;e.xp6(1),e.Q6J("itemId",null==(o=e.lcZ(2,1,t.showOverlay$))?null:o.itemId)}}function _a(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"alg-section",5)(2,"p"),e.SDv(3,6),e.qZA(),e.TgZ(4,"ul",7),e.YNc(5,sa,9,8,"li",8),e.qZA()(),e.TgZ(6,"p-overlayPanel",9,10),e.YNc(8,ca,3,3,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=e.MAs(7),o=e.oxw().ngIf;e.xp6(5),e.Q6J("ngForOf",o.data),e.xp6(3),e.Q6J("ngIf",t.overlayVisible)}}const la=function(){return[]};function ga(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ia,1,0,"alg-loading",1),e.YNc(2,ra,1,1,"alg-error",2),e.YNc(3,_a,9,2,"ng-container",0),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",!t.isFetching&&(t.data||e.DdM(3,la)).length>0)}}let da=(()=>{class n{constructor(t){this.getItemPrerequisitesService=t,this.itemId$=new P.t(1),this.refresh$=new N.x,this.state$=this.itemId$.pipe((0,E.w)(o=>this.getItemPrerequisitesService.get(o)),(0,m.U)(o=>o.map(r=>({...r,isLocked:!(0,v.hO)(r)}))),(0,I.iS)({resetter:this.refresh$}),(0,pt.B)()),this.showOverlaySubject$=new on.X(void 0),this.showOverlay$=(0,le.T)(this.showOverlaySubject$.pipe((0,rn.b)(750)),this.showOverlaySubject$.pipe((0,M.h)(o=>!o))).pipe((0,y.x)(),(0,x.d)(1)),this.showOverlaySubscription=this.showOverlay$.subscribe(o=>{o?this.op?.toggle(o.event,o.target):this.op?.hide()})}ngOnChanges(){this.itemData&&this.itemId$.next(this.itemData.item.id)}ngOnDestroy(){this.itemId$.complete(),this.showOverlaySubject$.complete(),this.refresh$.complete(),this.showOverlaySubscription.unsubscribe()}onMouseEnter(t,o,r){const a=this.contentRef?.get(r);if(!a)throw new Error("Unexpected: Target is not found");this.showOverlaySubject$.next({event:t,itemId:o,target:a.nativeElement})}onMouseLeave(t){(0,an.j)(t)&&this.closeOverlay()}closeOverlay(){this.showOverlaySubject$.next(void 0)}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(sn))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-unlock-access"]],viewQuery:function(t,o){if(1&t&&(e.Gf(na,5),e.Gf(oa,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.op=r.first),e.iGM(r=e.CRH())&&(o.contentRef=r)}},inputs:{itemData:"itemData"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t,o;return i="Unable to load the dependencies",t="Prerequisites",o="You can unlock access by validating one of the following content.",[[4,"ngIf"],["size","medium",4,"ngIf"],["class","dark","icon","fa fa-exclamation-triangle","message",i,3,"showRefreshButton","refresh",4,"ngIf"],["size","medium"],["icon","fa fa-exclamation-triangle","message",i,1,"dark",3,"showRefreshButton","refresh"],["icon","fa fa-list","label",t],o,[1,"list"],["class","list-item",3,"mouseleave",4,"ngFor","ngForOf"],["styleClass","alg-path-suggestion-overlay"],["op",""],[1,"list-item",3,"mouseleave"],[1,"list-item-left"],[1,"activity-progress"],[3,"diameter","bestScore","currentScore"],[1,"alg-link",3,"routerLink","mouseenter"],["contentRef",""],["class","lock-icon fa fa-lock",4,"ngIf"],[1,"lock-icon","fa","fa-lock"],[3,"itemId","mouseleave"]]},template:function(t,o){1&t&&(e.YNc(0,ga,4,4,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.sg,d.O5,Y.yS,ue.e,Fe.C,ne.q,j.N,cn.a,Ve.T,d.Ov,Et.M],styles:[".list[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0 1.6667rem 1.6667rem}.list-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:4rem;border-bottom:.1rem solid var(--light-border-color)}.list-item-left[_ngcontent-%COMP%]{display:flex;align-items:center}.activity-progress[_ngcontent-%COMP%]{margin-right:2rem}.lock-icon[_ngcontent-%COMP%]{margin-left:2rem;color:var(--light-text-color)}"]}),n})();function pa(n,i){if(1&n&&(e.TgZ(0,"alg-section",5)(1,"p"),e._uU(2),e.qZA()()),2&n){const t=e.oxw(4);e.xp6(2),e.hij("",t.itemData.item.string.description," ")}}function ma(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",9)(1,"label",10)(2,"span",11),e.SDv(3,12),e.qZA(),e.TgZ(4,"alg-switch",13),e.NdJ("change",function(r){e.CHM(t);const a=e.oxw(5);return e.KtG(a.onEditModeEnableChange(r))}),e.qZA()()()}if(2&n){const t=e.oxw(5);e.xp6(4),e.Q6J("checked",t.editModeEnabled)}}function ua(n,i){if(1&n&&e._UZ(0,"alg-item-children-edit-form",14),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)}}function ha(n,i){if(1&n&&e._UZ(0,"alg-chapter-children",15),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)("algFullHeightContent",!0)}}function fa(n,i){if(1&n&&e._UZ(0,"alg-sub-skills",14),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)}}function Ea(n,i){if(1&n&&e._UZ(0,"alg-parent-skills",14),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)}}const Ta=function(){return["all","all_with_grant","children"]};function Ca(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ma,5,1,"div",6),e.YNc(2,ua,1,1,"alg-item-children-edit-form",7),e.YNc(3,ha,1,2,"alg-chapter-children",8),e.YNc(4,fa,1,1,"alg-sub-skills",7),e.YNc(5,Ea,1,1,"alg-parent-skills",7),e.BQk()),2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("ngIf",e.DdM(5,Ta).includes(t.itemData.item.permissions.canEdit)||t.editModeEnabled),e.xp6(1),e.Q6J("ngIf",t.editModeEnabled),e.xp6(1),e.Q6J("ngIf","Chapter"===t.itemData.item.type&&!t.editModeEnabled),e.xp6(1),e.Q6J("ngIf","Skill"===t.itemData.item.type&&!t.editModeEnabled),e.xp6(1),e.Q6J("ngIf","Skill"===t.itemData.item.type)}}function Ma(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-item-display",19),e.NdJ("viewChange",function(r){e.CHM(t);const a=e.oxw(6);return e.KtG(a.taskViewChange.emit(r))})("tabsChange",function(r){e.CHM(t);const a=e.oxw(6);return e.KtG(a.taskTabsChange.emit(r))})("scoreChange",function(r){e.CHM(t);const a=e.oxw(6);return e.KtG(a.scoreChange.emit(r))})("skipSave",function(){e.CHM(t);const r=e.oxw(6);return e.KtG(r.skipSave.emit())})("refresh",function(){e.CHM(t);const r=e.oxw(6);return e.KtG(r.refresh.emit())}),e.qZA()}if(2&n){const t=e.oxw(6);e.Q6J("route",t.itemData.route)("editingPermission",t.itemData.item.permissions)("url",t.itemData.item.url)("attemptId",t.attemptId)("view",t.taskView)("taskConfig",t.taskConfig)("savingAnswer",t.savingAnswer)}}function Sa(n,i){if(1&n&&e._UZ(0,"alg-thread",20),2&n){const t=e.oxw(6);e.Q6J("itemId",t.itemData.route.id)}}function Ia(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ma,1,7,"alg-item-display",17),e.YNc(2,Sa,1,1,"alg-thread",18),e.BQk()),2&n){e.oxw(4);const t=e.MAs(6),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.attemptId)("ngIfElse",t),e.xp6(1),e.Q6J("ngIf",o.showItemThreadWidget)}}function va(n,i){1&n&&(e.TgZ(0,"p",21),e.SDv(1,24),e.qZA())}function Pa(n,i){if(1&n&&(e.TgZ(0,"p",21),e.SDv(1,22),e.qZA(),e.YNc(2,va,2,0,"p",23),e.ALo(3,"allowsEditingChildren")),2&n){const t=e.oxw(5);e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,t.itemData.item.permissions))}}function ba(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ia,3,3,"ng-container",1),e.YNc(2,Pa,4,3,"ng-template",null,16,e.W1O),e.BQk()),2&n){const t=e.MAs(3),o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",o.itemData.item.url)("ngIfElse",t)}}const Aa=function(){return["Chapter","Skill"]};function Oa(n,i){if(1&n&&(e.ynx(0),e.YNc(1,pa,3,1,"alg-section",4),e.YNc(2,Ca,6,6,"ng-container",0),e.YNc(3,ba,4,2,"ng-container",0),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.itemData.item.string.description),e.xp6(1),e.Q6J("ngIf",e.DdM(3,Aa).includes(t.itemData.item.type)),e.xp6(1),e.Q6J("ngIf","Task"===t.itemData.item.type||"Course"===t.itemData.item.type)}}function Na(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Oa,4,4,"ng-container",1),e.BQk()),2&n){e.oxw();const t=e.MAs(6),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.itemData.currentResult)("ngIfElse",t)}}function Da(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,26),e.qZA())}function wa(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,27),e.qZA())}function xa(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,28),e.qZA())}function ya(n,i){if(1&n&&e._UZ(0,"alg-item-unlock-access",14),2&n){const t=e.oxw(3);e.Q6J("itemData",t.itemData)}}const ka=function(){return["Task","Course"]};function Ra(n,i){if(1&n&&(e.TgZ(0,"div",25)(1,"alg-message-info"),e.YNc(2,Da,2,0,"span",0),e.YNc(3,wa,2,0,"span",0),e.YNc(4,xa,2,0,"span",0),e.qZA()(),e.YNc(5,ya,1,1,"alg-item-unlock-access",7),e.ALo(6,"allowsViewingInfo"),e.ALo(7,"allowsViewingContent")),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf","Chapter"===t.itemData.item.type),e.xp6(1),e.Q6J("ngIf","Skill"===t.itemData.item.type),e.xp6(1),e.Q6J("ngIf",e.DdM(8,ka).includes(t.itemData.item.type)),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,4,t.itemData.item.permissions)&&!e.lcZ(7,6,t.itemData.item.permissions))}}function $a(n,i){1&n&&(e.TgZ(0,"p",21)(1,"span"),e.ynx(2),e.SDv(3,31),e.BQk(),e._uU(4,"\xa0 "),e.ynx(5),e.SDv(6,32),e.BQk(),e._uU(7,". "),e.qZA()())}function Fa(n,i){1&n&&e._UZ(0,"alg-task-loader",33),2&n&&e.Q6J("algFullHeightContent",!0)}function La(n,i){if(1&n&&(e.YNc(0,$a,8,0,"p",29),e.YNc(1,Fa,1,1,"ng-template",null,30,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw(2);e.Q6J("ngIf",o.itemData.item.requiresExplicitEntry)("ngIfElse",t)}}function Ga(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Na,2,2,"ng-container",1),e.ALo(2,"allowsViewingContent"),e.YNc(3,Ra,8,9,"ng-template",null,2,e.W1O),e.YNc(5,La,3,2,"ng-template",null,3,e.W1O),e.BQk()),2&n){const t=e.MAs(4),o=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.itemData.item.permissions))("ngIfElse",t)}}let _n=(()=>{class n{constructor(t,o){this.router=t,this.route=o,this.taskConfig={readOnly:!1,formerAnswer:null},this.savingAnswer=!1,this.editModeEnabled=!1,this.taskTabsChange=new e.vpe,this.taskViewChange=new e.vpe,this.scoreChange=new e.vpe,this.skipSave=new e.vpe,this.refresh=new e.vpe,this.showItemThreadWidget=!!w.e.forumServerUrl}isDirty(){return!!this.itemChildrenEditFormComponent?.dirty}ngOnChanges(){!this.itemData||(this.attemptId=this.itemData.route.attemptId||this.itemData.currentResult?.attemptId)}onEditModeEnableChange(t){this.router.navigate([t?"./edit-children":"./"],{relativeTo:this.route}).then(o=>{!t&&!o&&this.switchComponent?.writeValue(!0)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Y.F0),e.Y36(Y.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-content"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Ht,5),e.Gf(en,5),e.Gf(nt.q,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.itemDisplayComponent=r.first),e.iGM(r=e.CRH())&&(o.itemChildrenEditFormComponent=r.first),e.iGM(r=e.CRH())&&(o.switchComponent=r.first)}},inputs:{itemData:"itemData",taskView:"taskView",taskConfig:"taskConfig",savingAnswer:"savingAnswer",editModeEnabled:"editModeEnabled"},outputs:{taskTabsChange:"taskTabsChange",taskViewChange:"taskViewChange",scoreChange:"scoreChange",skipSave:"skipSave",refresh:"refresh"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,t,o,r,a,s,_,l,p,C;return i="Description",t="Edit content",o=" This activity has not been correctly configured. ",r=" You need to set a url in editing mode. ",a=" Your current access rights do not allow you to list the content of this chapter. ",s=" Your current access rights do not allow you to list the content of this skill. ",_=" Your current access rights do not allow you to start the activity. ",l="This activity requires explicit entry",p="(not implemented)",C="Starting the activity",[[4,"ngIf"],[4,"ngIf","ngIfElse"],["notAllowToWatch",""],["noCurrentResult",""],["icon","fa fa-book","label",i,4,"ngIf"],["icon","fa fa-book","label",i],["class","edit",4,"ngIf"],[3,"itemData",4,"ngIf"],[3,"itemData","algFullHeightContent",4,"ngIf"],[1,"edit"],[1,"edit-label"],[1,"alg-base-text-color"],t,["mode","white",1,"edit-switch",3,"checked","change"],[3,"itemData"],[3,"itemData","algFullHeightContent"],["noUrl",""],[3,"route","editingPermission","url","attemptId","view","taskConfig","savingAnswer","viewChange","tabsChange","scoreChange","skipSave","refresh",4,"ngIf","ngIfElse"],[3,"itemId",4,"ngIf"],[3,"route","editingPermission","url","attemptId","view","taskConfig","savingAnswer","viewChange","tabsChange","scoreChange","skipSave","refresh"],[3,"itemId"],[1,"validation-text"],o,["class","validation-text",4,"ngIf"],r,[1,"message-info"],a,s,_,["class","validation-text",4,"ngIf","ngIfElse"],["noRequiresExplicitEntry",""],l,p,["label",C,3,"algFullHeightContent"]]},template:function(t,o){1&t&&e.YNc(0,Ga,7,4,"ng-container",0),2&t&&e.Q6J("ngIf",o.itemData)},dependencies:[d.O5,ue.e,nt.q,Xt,Bi,rr,fr,Dr,Ht,qt,en,ea,da,v.vJ,v.CG,q.pG],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.validation-text[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin:0;padding:1rem;color:#4a90e2;color:var(--base-color);font-size:1.6rem;text-align:center}.edit[_ngcontent-%COMP%]{padding:1rem 2rem;display:flex;justify-content:flex-end;align-items:center}.edit-label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.edit-switch[_ngcontent-%COMP%]{margin-left:1rem}.message-info[_ngcontent-%COMP%]{padding:1rem}"]}),n})(),ln=(()=>{class n{constructor(t){this.http=t}updateItem(t,o,r){return this.http.put(`${w.e.apiUrl}/items/${t}/strings/${r||"default"}`,o).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Tt=g(3148),Ua=g(6499);function Za(n,i){if(1&n&&(e.TgZ(0,"alg-section",2),e._UZ(1,"alg-textarea",3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("parentForm",t.parentForm)}}function Ja(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Za,2,1,"alg-section",1),e.ALo(2,"allowsEditingAll"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.itemData.item.permissions))}}let gn=(()=>{class n{constructor(){this.childrenChanges=new e.vpe}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-edit-content"]],inputs:{parentForm:"parentForm",itemData:"itemData"},outputs:{childrenChanges:"childrenChanges"},decls:1,vars:1,consts:function(){let i;return i="Description",[[4,"ngIf"],["icon","fa fa-book","label",i,4,"ngIf"],["icon","fa fa-book","label",i],["inputName","description",3,"parentForm"]]},template:function(t,o){1&t&&e.YNc(0,Ja,3,3,"ng-container",0),2&t&&e.Q6J("ngIf",o.itemData&&o.itemData.currentResult)},dependencies:[d.O5,ue.e,Ua.R,q.fy],styles:[".disabled[_ngcontent-%COMP%]{pointer-events:none!important;opacity:.5}"]}),n})();function Qa(n,i){if(1&n&&(e.TgZ(0,"div",17),e._UZ(1,"alg-input",18)(2,"alg-input",19),e.qZA()),2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("parentForm",t.itemForm)("isDark",!1),e.xp6(1),e.Q6J("parentForm",t.itemForm)("isDark",!1)}}function Ba(n,i){if(1&n&&e._UZ(0,"alg-item-edit-content",20),2&n){const t=e.oxw(3).ngIf,o=e.oxw();e.Q6J("parentForm",o.itemForm)("itemData",t.data)}}function Va(n,i){if(1&n&&e._UZ(0,"alg-item-edit-advanced-parameters",22,23),2&n){const t=e.oxw().ngIf,o=e.oxw(4);e.Q6J("parentForm",o.itemForm)("item",o.initialFormData)("attemptId",t)}}function Ya(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Va,2,3,"alg-item-edit-advanced-parameters",21),e.ALo(2,"allowsEditingAll"),e.BQk()),2&n){e.oxw();const t=e.MAs(8),o=e.oxw(2).ngIf;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,o.data.item.permissions)&&t.isActive)}}const dn=function(){return{matrixParams:"ignored",queryParams:"ignored",paths:"exact",fragment:"ignored"}};function za(n,i){if(1&n&&(e.TgZ(0,"form",6),e.YNc(1,Qa,3,4,"div",7),e.ALo(2,"allowsEditingAll"),e.TgZ(3,"nav",8)(4,"a",9,10),e.SDv(6,11),e.qZA(),e.TgZ(7,"a",12,13),e.SDv(9,14),e.ALo(10,"allowsEditingAll"),e.qZA()(),e.TgZ(11,"div",15),e.YNc(12,Ba,1,2,"alg-item-edit-content",16),e.YNc(13,Ya,3,3,"ng-container",0),e.ALo(14,"async"),e.qZA()()),2&n){const t=e.MAs(5),o=e.MAs(8),r=e.oxw(2).ngIf,a=e.oxw();e.Q6J("formGroup",a.itemForm),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,13,r.data.item.permissions)),e.xp6(3),e.ekj("active",t.isActive),e.Q6J("routerLink","./")("routerLinkActiveOptions",e.DdM(19,dn)),e.xp6(3),e.ekj("active",o.isActive),e.Q6J("hidden",!e.lcZ(10,15,r.data.item.permissions))("routerLink","./advanced-parameters")("routerLinkActiveOptions",e.DdM(20,dn)),e.xp6(5),e.Q6J("ngIf",t.isActive),e.xp6(1),e.Q6J("ngIf",e.lcZ(14,17,a.attemptId$))}}function Xa(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-floating-save",24),e.NdJ("save",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.save())})("cancel",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onCancel())}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("saving",t.itemForm.disabled)}}function qa(n,i){1&n&&(e.TgZ(0,"p"),e.SDv(1,25),e.qZA())}function Ha(n,i){if(1&n&&(e.TgZ(0,"div",2),e.YNc(1,za,15,21,"form",3),e.ALo(2,"allowsEditingChildren"),e.YNc(3,Xa,1,1,"alg-floating-save",4),e.YNc(4,qa,2,0,"ng-template",null,5,e.W1O),e.qZA()),2&n){const t=e.MAs(5),o=e.oxw().ngIf,r=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,3,o.data.item.permissions))("ngIfElse",t),e.xp6(2),e.Q6J("ngIf",r.itemForm.dirty)}}function Wa(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ha,6,5,"div",1),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isReady)}}const Ct="1000-01-01T00:00:00Z",Mt="9999-12-31T23:59:59Z";let pn=(()=>{class n{constructor(t,o,r,a,s,_,l){this.modeService=t,this.currentContentService=o,this.itemDataSource=r,this.formBuilder=a,this.updateItemService=s,this.updateItemStringService=_,this.actionFeedbackService=l,this.itemForm=this.formBuilder.group({title:["",[b.kI.required,b.kI.minLength(3),b.kI.maxLength(200)]],subtitle:["",b.kI.maxLength(200)],description:[""],url:["",b.kI.maxLength(2e3)],text_id:["",b.kI.maxLength(200)],uses_api:[!1],validation_type:[""],no_score:[!1],title_bar_visible:[!1],prompt_to_join_group_by_code:[!1],full_screen:[""],allows_multiple_attempts:[!1],requires_explicit_entry:[!1],duration_enabled:[!1],duration:[null],entering_time_min_enabled:[!1],entering_time_min:[null],entering_time_max_enabled:[!1],entering_time_max:[null],entry_participant_type:[!1],entry_frozen_teams:[!1],entry_max_team_size:[""],entry_min_admitted_members_ratio:[""]},{validators:[this.maxTeamSizeValidator()]}),this.fetchState$=this.itemDataSource.state$,this.attemptId$=this.itemDataSource.state$.pipe((0,m.U)(p=>{if(p.isReady)return p.data.route.attemptId||p.data.route.parentAttemptId})),this.modeService.startEditing(),this.subscription=this.fetchState$.pipe((0,I.RI)(),(0,m.U)(p=>({...p.item,durationEnabled:null!==p.item.duration,enteringTimeMinEnabled:p.item.enteringTimeMin.getTime()!==new Date(Ct).getTime(),enteringTimeMaxEnabled:p.item.enteringTimeMax.getTime()!==new Date(Mt).getTime()}))).subscribe(p=>{this.initialFormData=p,this.resetForm()})}get enableParticipation(){return"Skill"!==this.initialFormData?.type}get enableTeam(){return"Skill"!==this.initialFormData?.type}ngOnDestroy(){this.modeService.stopEditing(),this.subscription?.unsubscribe()}isDirty(){return this.itemForm.dirty}getItemChanges(){const t={url:this.itemForm.get("url"),textId:this.itemForm.get("text_id"),usesApi:this.itemForm.get("uses_api"),validationType:this.itemForm.get("validation_type"),noScore:this.itemForm.get("no_score"),titleBarVisible:this.itemForm.get("title_bar_visible"),promptToJoinGroupByCode:this.itemForm.get("prompt_to_join_group_by_code"),fullScreen:this.itemForm.get("full_screen"),...this.enableParticipation?{allowsMultipleAttempts:this.itemForm.get("allows_multiple_attempts"),requiresExplicitEntry:this.itemForm.get("requires_explicit_entry"),durationEnabled:this.itemForm.get("duration_enabled"),duration:this.itemForm.get("duration"),enteringTimeMinEnabled:this.itemForm.get("entering_time_min_enabled"),enteringTimeMin:this.itemForm.get("entering_time_min"),enteringTimeMaxEnabled:this.itemForm.get("entering_time_max_enabled"),enteringTimeMax:this.itemForm.get("entering_time_max")}:{},...this.enableTeam?{entryParticipantType:this.itemForm.get("entry_participant_type"),entryFrozenTeams:this.itemForm.get("entry_frozen_teams"),entryMaxTeamSize:this.itemForm.get("entry_max_team_size"),entryMinAdmittedMembersRatio:this.itemForm.get("entry_min_admitted_members_ratio")}:{}};if(Object.values(t).includes(null)||!this.initialFormData)return;const o={},r=""!==t.url?.value?t.url?.value:null;(0,ge.pT)(this.initialFormData.url)&&r!==this.initialFormData.url&&(o.url=r);const a=t.usesApi?.value;(0,ge.pT)(this.initialFormData.usesApi)&&a!==this.initialFormData.usesApi&&(o.uses_api=a);const s=t.textId?.value;""!==s&&(o.text_id=s);const _=t.validationType?.value;_!==this.initialFormData.validationType&&(o.validation_type=_);const l=t.noScore?.value;l!==this.initialFormData.noScore&&(o.no_score=l);const p=t.titleBarVisible?.value;p!==this.initialFormData.titleBarVisible&&(o.title_bar_visible=p);const C=t.promptToJoinGroupByCode?.value;C!==this.initialFormData.promptToJoinGroupByCode&&(o.prompt_to_join_group_by_code=C);const h=t.fullScreen?.value;if(h!==this.initialFormData.fullScreen&&(o.full_screen=h),this.enableParticipation){const A=t.allowsMultipleAttempts?.value;A!==this.initialFormData.allowsMultipleAttempts&&(o.allows_multiple_attempts=A);const Q=t.requiresExplicitEntry?.value,L=Q!==this.initialFormData.requiresExplicitEntry;L&&(o.requires_explicit_entry=Q);const he=t.durationEnabled?.value,re=t.duration?.value,be=he!==this.initialFormData.durationEnabled;(re?.getMs()!==this.initialFormData?.duration?.getMs()||be||L)&&(o.duration=he&&Q?re?.toString():null);const Ee=t.enteringTimeMinEnabled?.value,Ge=Ee!==this.initialFormData.enteringTimeMinEnabled,Ae=t.enteringTimeMin?.value;(Ae.getTime()!==this.initialFormData.enteringTimeMin.getTime()||Ge)&&(o.entering_time_min=Ee?Ae:new Date(Ct));const Oe=t.enteringTimeMaxEnabled?.value,Ue=Oe!==this.initialFormData.enteringTimeMaxEnabled,Ne=t.enteringTimeMax?.value;(Ne.getTime()!==this.initialFormData.enteringTimeMax.getTime()||Ue)&&(o.entering_time_max=Oe?Ne:new Date(Mt))}if(this.enableTeam){const A=t.entryParticipantType?.value?"Team":"User";A!==this.initialFormData.entryParticipantType&&(o.entry_participant_type=A);const L=t.entryFrozenTeams?.value;L!==this.initialFormData.entryFrozenTeams&&(o.entry_frozen_teams=L);const re=t.entryMaxTeamSize?.value;re!==this.initialFormData.entryMaxTeamSize&&(o.entry_max_team_size=re);const fe=t.entryMinAdmittedMembersRatio?.value;fe!==this.initialFormData.entryMinAdmittedMembersRatio&&(o.entry_min_admitted_members_ratio=fe)}return o}updateItem(){if(!this.initialFormData)return(0,se._)(new Error("Invalid initial data"));const t=this.getItemChanges();return t?Object.keys(t).length?this.updateItemService.updateItem(this.initialFormData.id,t):(0,D.of)(void 0):(0,se._)(new Error("Invalid form"))}getItemStringChanges(){const t=this.itemForm.get("title"),o=this.itemForm.get("subtitle"),r=this.itemForm.get("description"),a=this.initialFormData?.string;if(null===t||null===o||null===r||!a)return;const s={},_=t.value;_!==a.title&&(s.title=_.trim());const l=o.value.trim()||null;l!==a.subtitle&&(s.subtitle=l);const p=r.value.trim()||null;return p!==a.description&&(s.description=p),s}updateString(){if(!this.initialFormData)return(0,se._)(new Error("Missing ID form"));const t=this.getItemStringChanges();return t?Object.keys(t).length?this.updateItemStringService.updateItem(this.initialFormData.id,t):(0,D.of)(void 0):(0,se._)(new Error("Invalid form or initial data"))}save(){if(this.initialFormData){if(this.itemForm.invalid)return void this.actionFeedbackService.error("Vous devez r\xE9soudre toutes les erreurs affich\xE9es dans le formulaire avant de sauvegarder.");this.itemForm.disable(),(0,V.D)([this.updateItem(),this.updateString()]).subscribe({next:t=>{this.actionFeedbackService.success("Modifications bien enregistr\xE9es."),this.itemDataSource.refreshItem(),this.currentContentService.forceNavMenuReload()},error:t=>{if(this.itemForm.enable(),this.actionFeedbackService.unexpectedError(),!(t instanceof f.UA))throw t}})}}onCancel(){this.resetForm()}resetForm(){if(!this.initialFormData)return;const t=this.initialFormData;this.itemForm.reset({title:t.string.title||"",description:t.string.description||"",subtitle:t.string.subtitle||"",url:t.url||"",text_id:"",uses_api:t.usesApi||!1,validation_type:t.validationType,no_score:t.noScore,title_bar_visible:t.titleBarVisible||!1,prompt_to_join_group_by_code:t.promptToJoinGroupByCode||!1,full_screen:t.fullScreen,...this.enableParticipation?{allows_multiple_attempts:t.allowsMultipleAttempts,requires_explicit_entry:t.requiresExplicitEntry,duration_enabled:t.durationEnabled,duration:t.duration,entering_time_min_enabled:t.enteringTimeMinEnabled,entering_time_min:t.enteringTimeMin,entering_time_max_enabled:t.enteringTimeMaxEnabled,entering_time_max:t.enteringTimeMax}:{},...this.enableTeam?{entry_participant_type:"Team"===t.entryParticipantType,entry_frozen_teams:t.entryFrozenTeams,entry_max_team_size:t.entryMaxTeamSize,entry_min_admitted_members_ratio:t.entryMinAdmittedMembersRatio}:{}}),this.itemForm.enable()}maxTeamSizeValidator(){return t=>{const o=t.get("entry_participant_type")?.value,r=t.get("entry_max_team_size");return r&&r.setErrors(o?b.kI.min(1)(r):null),null}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(De.dT),e.Y36(We.u),e.Y36(ke),e.Y36(b.QS),e.Y36(mt),e.Y36(ln),e.Y36(Se.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-edit"]],decls:2,vars:3,consts:function(){let i,t,o,r,a;return i=" Contenu ",t=" Param\xE8tres avanc\xE9s ",o="Titre",r="Sous-titre",a="Vous n'avez pas les permissions d'\xE9diter ce contenu.",[[4,"ngIf"],["style","margin: 1rem 0 0.5rem 0",4,"ngIf"],[2,"margin","1rem 0 0.5rem 0"],[3,"formGroup",4,"ngIf","ngIfElse"],[3,"saving","save","cancel",4,"ngIf"],["notAuthorized",""],[3,"formGroup"],["class","header",4,"ngIf"],[1,"nav-tab"],["routerLinkActive","",1,"nav-tab-item",3,"routerLink","routerLinkActiveOptions"],["rla1","routerLinkActive"],i,["routerLinkActive","",1,"nav-tab-item",3,"hidden","routerLink","routerLinkActiveOptions"],["rla2","routerLinkActive"],t,[1,"bg-white"],[3,"parentForm","itemData",4,"ngIf"],[1,"header"],["placeholder",o,"name","title","size","large",3,"parentForm","isDark"],["placeholder",r,"name","subtitle","size","small",3,"parentForm","isDark"],[3,"parentForm","itemData"],[3,"parentForm","item","attemptId",4,"ngIf"],[3,"parentForm","item","attemptId"],["advancedParameters",""],[3,"saving","save","cancel"],a]},template:function(t,o){1&t&&(e.YNc(0,Wa,2,1,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.fetchState$))},styles:[".header[_ngcontent-%COMP%]{margin-bottom:2rem}"]}),n})();var mn=g(2187),Ka=g(9255),ja=g(8992);function es(n,i){if(1&n&&e._UZ(0,"p-dropdown",1),2&n){const t=e.oxw();e.Q6J("options",t.options)("placeholder",t.placeholder)("formControl",t.formControl)}}let ts=(()=>{class n{constructor(){this.options=[],this.placeholder="",this.name=""}ngOnInit(){this.parentForm&&this.parentForm.get(this.name)&&(this.formControl=this.parentForm.get(this.name))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-dropdown"]],inputs:{options:"options",placeholder:"placeholder",parentForm:"parentForm",name:"name"},decls:1,vars:1,consts:[["styleClass","alg-dropdown","optionLabel","label","optionValue","value",3,"options","placeholder","formControl",4,"ngIf"],["styleClass","alg-dropdown","optionLabel","label","optionValue","value",3,"options","placeholder","formControl"]],template:function(t,o){1&t&&e.YNc(0,es,1,3,"p-dropdown",0),2&t&&e.Q6J("ngIf",o.formControl)},dependencies:[d.O5,b.JJ,ja.Lt,b.oH]}),n})();var ns=g(5999),un=g(2547),St=g(7990),Pe=g(4356);let os=(()=>{class n{constructor(t){this.http=t}delete(t){return this.http.delete(`${w.e.apiUrl}/items/${t}`).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function is(n,i){1&n&&e._UZ(0,"alg-loading",8)}const rs=function(){return{Chapter:"Only empty chapters can be deleted.",other:"Only empty skills can be deleted."}};function as(n,i){if(1&n&&(e.TgZ(0,"span",10),e.SDv(1,11),e.ALo(2,"i18nSelect"),e.qZA()),2&n){const t=e.oxw(4);e.xp6(2),e.pQV(e.xi3(2,1,t.item.type,e.DdM(4,rs))),e.QtT(1)}}const hn=function(){return["Chapter","Skill"]};function ss(n,i){if(1&n&&(e.ynx(0),e.YNc(1,as,3,5,"span",9),e.BQk()),2&n){const t=e.oxw().ngIf,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data&&e.DdM(1,hn).includes(o.item.type))}}function cs(n,i){1&n&&(e.TgZ(0,"span",10),e.SDv(1,12),e.qZA())}function _s(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",13),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function ls(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e.YNc(1,is,1,0,"alg-loading",3),e.YNc(2,ss,2,2,"ng-container",4),e.YNc(3,cs,2,0,"ng-template",null,5,e.W1O),e.YNc(5,_s,1,1,"alg-error",6),e.TgZ(6,"button",7),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onDeleteItem())}),e.qZA()()}if(2&n){const t=i.ngIf,o=e.MAs(4),r=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.isFetching||r.deletionInProgress),e.xp6(1),e.Q6J("ngIf",r.item.permissions.isOwner)("ngIfElse",o),e.xp6(3),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("disabled",t.isReady&&t.data&&e.DdM(5,hn).includes(r.item.type)||t.isFetching||t.isError||r.deletionInProgress||!r.item.permissions.isOwner)}}function gs(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ls,7,6,"div",1),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.state$))}}let ds=(()=>{class n{constructor(t,o,r,a,s){this.getItemChildrenService=t,this.confirmationService=o,this.removeItemService=r,this.actionFeedbackService=a,this.router=s,this.confirmRemoval=new e.vpe,this.params$=new P.t(1),this.refresh$=new N.x,this.state$=this.params$.pipe((0,y.x)((_,l)=>_.id===l.id&&_.attemptId===l.attemptId),(0,E.w)(({id:_,attemptId:l})=>this.getItemChildrenService.get(_,l).pipe((0,m.U)(p=>p.length>0))),(0,I.iS)({resetter:this.refresh$})),this.deletionInProgress=!1}ngOnChanges(){this.item&&this.attemptId&&this.params$.next({id:this.item.id,attemptId:this.attemptId})}ngOnDestroy(){this.refresh$.complete()}onDeleteItem(){if(!this.item)throw new Error("Unexpected: missed item input of component");this.confirmationService.confirm({message:"Deleting it will also remove permanently all answers and results related with this content.",header:"Are you sure you want to delete this content?",icon:"pi pi-exclamation-triangle",acceptLabel:"Yes",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.confirmRemoval.emit(),this.deleteItem()},rejectLabel:"Non"})}deleteItem(){if(!this.item)throw new Error("Unexpected: missed item input of component");const t=this.item.id,o=this.item.string.title;this.deletionInProgress=!0,this.removeItemService.delete(t).subscribe({next:()=>{this.deletionInProgress=!1,this.actionFeedbackService.success("Vous avez supprim\xE9 \"" + o + "\""),this.navigateToMyRoot()},error:r=>{this.deletionInProgress=!1,this.actionFeedbackService.error("Echec lors de la suppression de \"" + o + "\"")}})}navigateToMyRoot(){this.router.navigate(["/"])}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36($e.q),e.Y36(Pe.YP),e.Y36(os),e.Y36(Se.C),e.Y36(Y.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-remove-button"]],inputs:{item:"item",attemptId:"attemptId"},outputs:{confirmRemoval:"confirmRemoval"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,t,o,r;return i="Error while loading the item info",t="Delete this item",o=" " + "\ufffd0\ufffd" + " ",r="Only owner can delete items",[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],["size","small",4,"ngIf"],[4,"ngIf","ngIfElse"],["notOwner",""],["class","warning small","message",i,"refreshButtonType","refresh",3,"showRefreshButton","refresh",4,"ngIf"],["pButton","","type","button","label",t,1,"p-button-rounded","p-button-danger",3,"disabled","click"],["size","small"],["class","message",4,"ngIf"],[1,"message"],o,r,["message",i,"refreshButtonType","refresh",1,"warning","small",3,"showRefreshButton","refresh"]]},template:function(t,o){1&t&&e.YNc(0,gs,3,3,"ng-container",0),2&t&&e.Q6J("ngIf",o.item)},dependencies:[d.O5,ne.q,j.N,_e.Hq,d.Ov,d._K],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.message[_ngcontent-%COMP%]{margin-right:.4rem;color:#ff001f;color:var(--notify-error-color)}"]}),n})();function ps(n,i){if(1&n&&(e.TgZ(0,"alg-section",9)(1,"div",10)(2,"span",11),e.SDv(3,12),e.qZA(),e.TgZ(4,"div",13),e._UZ(5,"alg-input",14),e.qZA()(),e.TgZ(6,"div",10)(7,"span",11),e.SDv(8,15),e.qZA(),e.TgZ(9,"div",13),e._UZ(10,"alg-switch",16),e.qZA()(),e.TgZ(11,"div",10)(12,"span",11),e._uU(13,"TextID"),e.qZA(),e.TgZ(14,"div",13),e._UZ(15,"alg-input",17),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("parentForm",t.parentForm),e.xp6(10),e.Q6J("parentForm",t.parentForm)}}function ms(n,i){if(1&n&&(e.TgZ(0,"alg-section",18)(1,"div",10)(2,"span",11),e.SDv(3,19),e.qZA(),e.TgZ(4,"div",13),e._UZ(5,"alg-dropdown",20),e.qZA()(),e.TgZ(6,"div",10)(7,"span",11),e.SDv(8,21),e.qZA(),e.TgZ(9,"div",13),e._UZ(10,"alg-switch",22),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("options",t.validationCriteriaOptions)("parentForm",t.parentForm)}}function us(n,i){if(1&n&&(e.TgZ(0,"alg-section",23)(1,"div",10)(2,"span",11),e.ynx(3),e.SDv(4,24),e.BQk(),e._uU(5,"\xa0 "),e.ynx(6),e.SDv(7,25),e.BQk(),e.qZA(),e.TgZ(8,"div",13),e._UZ(9,"alg-switch",26),e.qZA()(),e.TgZ(10,"div",10)(11,"span",11),e.SDv(12,27),e.qZA(),e.TgZ(13,"div",13),e._UZ(14,"alg-switch",28),e.qZA()(),e.TgZ(15,"div",10)(16,"span",11),e.ynx(17),e.SDv(18,29),e.BQk(),e._uU(19,"\xa0 "),e.ynx(20),e.SDv(21,30),e.BQk(),e.qZA(),e.TgZ(22,"div",13),e._UZ(23,"alg-selection",31),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(23),e.Q6J("items",t.fullScreenOptions)}}function hs(n,i){if(1&n&&e._UZ(0,"alg-duration",51),2&n){const t=e.oxw(4);e.Q6J("parentForm",t.parentForm)("limitToTimeMax",!0)}}function fs(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",44)(2,"p-calendar",52),e.NdJ("ngModelChange",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.onDateChange())}),e.qZA()(),e.BQk()}2&n&&(e.xp6(2),e.Q6J("showIcon",!0)("showTime",!0))}function Es(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",44)(2,"p-calendar",53),e.NdJ("ngModelChange",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.onDateChange())}),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw(4);e.xp6(2),e.Q6J("showIcon",!0)("showTime",!0)("minDate",t.minEnteringTimeMaxDate)}}function Ts(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",39)(2,"span",11),e.ynx(3),e.SDv(4,40),e.BQk(),e._uU(5,"\xa0 "),e.ynx(6),e.SDv(7,41),e.BQk(),e.qZA(),e.TgZ(8,"div",42)(9,"alg-switch",43),e.NdJ("ngModelChange",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onDurationEnabledChange())}),e.qZA(),e.TgZ(10,"div",44),e.YNc(11,hs,1,2,"alg-duration",45),e.qZA()()(),e.TgZ(12,"div",46)(13,"span",11),e.SDv(14,47),e.qZA(),e.TgZ(15,"div",42)(16,"alg-switch",48),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onEnteringTimeMinEnabledChange(r))}),e.qZA(),e.YNc(17,fs,3,2,"ng-container",38),e.qZA()(),e.TgZ(18,"div",46)(19,"span",11),e.SDv(20,49),e.qZA(),e.TgZ(21,"div",42)(22,"alg-switch",50),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onEnteringTimeMaxEnabledChange(r))}),e.qZA(),e.YNc(23,Es,3,3,"ng-container",38),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw(3);let o,r,a;e.xp6(11),e.Q6J("ngIf",!(null==(o=t.parentForm.get("duration_enabled"))||!o.value)),e.xp6(6),e.Q6J("ngIf",!(null==(r=t.parentForm.get("entering_time_min_enabled"))||!r.value)),e.xp6(6),e.Q6J("ngIf",!(null==(a=t.parentForm.get("entering_time_max_enabled"))||!a.value))}}function Cs(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-section",32)(1,"div",10)(2,"span",11),e.ynx(3),e.SDv(4,33),e.BQk(),e._uU(5,"\xa0 "),e.ynx(6),e.SDv(7,34),e.BQk(),e.qZA(),e.TgZ(8,"div",13),e._UZ(9,"alg-switch",35),e.qZA()(),e.TgZ(10,"div",10)(11,"span",11),e.SDv(12,36),e.qZA(),e.TgZ(13,"div",13)(14,"alg-switch",37),e.NdJ("ngModelChange",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onRequiresExplicitEntryChange())}),e.qZA()()(),e.YNc(15,Ts,24,3,"ng-container",38),e.qZA()}if(2&n){const t=e.oxw(2);let o;e.xp6(15),e.Q6J("ngIf",!(null==(o=t.parentForm.get("requires_explicit_entry"))||!o.value))}}function Ms(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"div",10)(2,"span",11),e.SDv(3,58),e.qZA(),e.TgZ(4,"div",13),e._UZ(5,"alg-switch",59),e.qZA()(),e.TgZ(6,"div",10)(7,"span",11),e.SDv(8,60),e.qZA(),e.TgZ(9,"div",13),e._UZ(10,"p-inputNumber",61)(11,"alg-input-error",62),e.qZA()(),e.TgZ(12,"div",10)(13,"span",11),e.SDv(14,63),e.qZA(),e.TgZ(15,"div",13),e._UZ(16,"alg-dropdown",64),e.qZA()(),e.BQk()),2&n){const t=e.oxw(3);e.xp6(11),e.Q6J("form",t.parentForm),e.xp6(5),e.Q6J("options",t.minAdmittedMembersRatioOptions)("parentForm",t.parentForm)}}function Ss(n,i){if(1&n&&(e.TgZ(0,"alg-section",54)(1,"div",10)(2,"span",11),e.ynx(3),e.SDv(4,55),e.BQk(),e._uU(5,"\xa0 "),e.ynx(6),e.SDv(7,56),e.BQk(),e.qZA(),e.TgZ(8,"div",13),e._UZ(9,"alg-switch",57),e.qZA()(),e.YNc(10,Ms,17,3,"ng-container",38),e.qZA()),2&n){const t=e.oxw(2);let o;e.xp6(10),e.Q6J("ngIf",!(null==(o=t.parentForm.get("entry_participant_type"))||!o.value))}}const Is=function(){return["Task","Course"]},vs=function(){return["Chapter","Skill"]};function Ps(n,i){if(1&n&&(e.TgZ(0,"form",3),e.YNc(1,ps,16,2,"alg-section",4),e.YNc(2,ms,11,2,"alg-section",5),e.YNc(3,us,24,1,"alg-section",6),e.YNc(4,Cs,16,1,"alg-section",7),e.YNc(5,Ss,11,1,"alg-section",8),e.qZA()),2&n){const t=e.oxw();e.Q6J("formGroup",t.parentForm),e.xp6(1),e.Q6J("ngIf",e.DdM(6,Is).includes(t.item.type)),e.xp6(1),e.Q6J("ngIf",e.DdM(7,vs).includes(t.item.type)),e.xp6(1),e.Q6J("ngIf","Skill"!==t.item.type),e.xp6(1),e.Q6J("ngIf","Skill"!==t.item.type),e.xp6(1),e.Q6J("ngIf","Skill"!==t.item.type)}}let fn=(()=>{class n{constructor(){this.confirmRemoval=new e.vpe,this.validationCriteriaOptions=[{label:"Jamais",value:"None"},{label:"Tous les enfants valid\xE9s",value:"All"},{label:"Tous les enfants sauf un valid\xE9s",value:"AllButOne"},{label:"Tous les enfants 'Cat\xE9gories' valid\xE9s",value:"Categories"},{label:"Un enfant valid\xE9",value:"One"}],this.fullScreenOptions=[{label:"Non",value:"forceNo"},{label:"Bas\xE9 sur le type",value:"default"},{label:"Oui mapp\xE9",value:"forceYes"}],this.minEnteringTimeMaxDate=new Date,this.minAdmittedMembersRatioOptions=[{label:"Tous les membres doivent \xEAtre admis",value:"All"},{label:"La moiti\xE9 des membres doivent \xEAtre admis",value:"Half"},{label:"Un membre doit \xEAtre admis",value:"One"},{label:"Aucun des membres n'a \xE0 \xEAtre admis",value:"None"}]}ngOnInit(){this.handleDurationValidators()}onRequiresExplicitEntryChange(){this.handleDurationValidators()}onDurationEnabledChange(){this.handleDurationValidators()}handleDurationValidators(){const t=this.parentForm?.get("requires_explicit_entry")?.value,o=this.parentForm?.get("duration_enabled")?.value,r=t&&o;this.parentForm?.get("duration")?.setValidators(r?b.kI.required:null),this.parentForm?.get("duration")?.updateValueAndValidity()}onEnteringTimeMinEnabledChange(t){t&&this.parentForm?.get("entering_time_min")?.value.getTime()===new Date(Ct).getTime()&&this.parentForm?.get("entering_time_min")?.patchValue(new Date)}onEnteringTimeMaxEnabledChange(t){if(t&&this.parentForm?.get("entering_time_max")?.value.getTime()===new Date(Mt).getTime()){const r=this.parentForm?.get("entering_time_min_enabled")?.value,a=r?this.parentForm?.get("entering_time_min")?.value:new Date,s=r?a.getTime()+Me.gd:a.getTime();this.parentForm?.get("entering_time_max")?.patchValue(new Date(s))}}onDateChange(){const t=this.parentForm?.get("entering_time_min_enabled")?.value,o=this.parentForm?.get("entering_time_min")?.value,r=this.parentForm?.get("entering_time_max")?.value;this.minEnteringTimeMaxDate=t?new Date(Math.min(o.getTime(),r.getTime())):new Date}onConfirmRemoval(){this.confirmRemoval.emit()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-edit-advanced-parameters"]],inputs:{item:"item",parentForm:"parentForm",attemptId:"attemptId"},outputs:{confirmRemoval:"confirmRemoval"},decls:3,vars:3,consts:function(){let i,t,o,r,a,s,_,l,p,C,h,A,Q,L,he,re,be,fe,Ee,Ge,Ae,ct,Oe,Ue,Ne,_t;return i="Param\xE8tres globaux",t="Score et Validation",o="Affichage",r="Participation",a="\xC9quipe",s="Url",_="Utilise l'API",l="Crit\xE8res de validation",p="D\xE9sactiver le score",C="Afficher l'en-t\xEAte",h="(not implemented)",A="Afficher l'en-t\xEAte code de groupe",Q="Plein \xE9cran",L="(not implemented)",he="Autoriser plusieurs tentatives",re="(not implemented)",be="Commencer manuellement la participation",fe="Dur\xE9e",Ee="(not implemented)",Ge="Heure d'entr\xE9e minimale",Ae="Heure d'entr\xE9e maximale",ct="Participation en tant qu'\xE9quipe (uniquement)",Oe="(not implemented)",Ue="Geler l'\xE9quipe \xE0 l'entr\xE9e",Ne="Taille maximale de l'\xE9quipe",_t="Nombre minimal de membres admis",[[3,"formGroup",4,"ngIf"],[1,"delete-button"],[3,"item","attemptId","confirmRemoval"],[3,"formGroup"],["icon","fa fa-cogs","label",i,4,"ngIf"],["icon","fa fa-book","label",t,4,"ngIf"],["icon","fa fa-desktop","label",o,4,"ngIf"],["icon","fa fa-desktop","label",r,4,"ngIf"],["icon","fa fa-users","label",a,4,"ngIf"],["icon","fa fa-cogs","label",i],[1,"form-item-view"],[1,"form-item-label"],s,[1,"form-item-control"],["inputName","url","name","url","size","small",3,"parentForm"],_,["formControlName","uses_api","mode","white"],["inputName","text_id","name","text_id","size","small",3,"parentForm"],["icon","fa fa-book","label",t],l,["inputName","validation_type","name","validation_type",3,"options","parentForm"],p,["formControlName","no_score","mode","white"],["icon","fa fa-desktop","label",o],C,h,["formControlName","title_bar_visible","mode","white"],A,["formControlName","prompt_to_join_group_by_code","mode","white"],Q,L,["formControlName","full_screen",3,"items"],["icon","fa fa-desktop","label",r],he,re,["formControlName","allows_multiple_attempts","mode","white"],be,["formControlName","requires_explicit_entry","mode","white",3,"ngModelChange"],[4,"ngIf"],[1,"form-item-view","form-item-duration"],fe,Ee,[1,"form-item-control","another-input"],["formControlName","duration_enabled","mode","white",1,"first-child",3,"ngModelChange"],[1,"input-wrapper"],["class","alg-duration","formControlName","duration","name","duration","layout","HMS",3,"parentForm","limitToTimeMax",4,"ngIf"],[1,"form-item-view","form-item-datepicker"],Ge,["formControlName","entering_time_min_enabled","mode","white",1,"first-child",3,"ngModelChange"],Ae,["formControlName","entering_time_max_enabled","mode","white",1,"first-child",3,"ngModelChange"],["formControlName","duration","name","duration","layout","HMS",1,"alg-duration",3,"parentForm","limitToTimeMax"],["formControlName","entering_time_min",1,"alg-calendar",3,"showIcon","showTime","ngModelChange"],["formControlName","entering_time_max",1,"alg-calendar",3,"showIcon","showTime","minDate","ngModelChange"],["icon","fa fa-users","label",a],ct,Oe,["formControlName","entry_participant_type","mode","white"],Ue,["formControlName","entry_frozen_teams","mode","white"],Ne,["formControlName","entry_max_team_size",1,"alg-input-number"],["inputName","entry_max_team_size",3,"form"],_t,["inputName","entry_min_admitted_members_ratio","name","entry_min_admitted_members_ratio",3,"options","parentForm"]]},template:function(t,o){1&t&&(e.YNc(0,Ps,6,8,"form",0),e.TgZ(1,"div",1)(2,"alg-item-remove-button",2),e.NdJ("confirmRemoval",function(){return o.onConfirmRemoval()}),e.qZA()()),2&t&&(e.Q6J("ngIf",o.item&&o.parentForm),e.xp6(2),e.Q6J("item",o.item)("attemptId",o.attemptId))},dependencies:[d.O5,ue.e,nt.q,mn.p,Tt.a,Ka.A,ts,ns._,b._Y,b.JJ,b.JL,b.sg,b.u,un.f,St.Rn,ds],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.form-item-view[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1.25rem}.form-item-view[_ngcontent-%COMP%]   .form-item-label[_ngcontent-%COMP%]{display:block;font-size:1.2rem;width:21rem;color:#4a4a4a;color:var(--dark-text-color);font-weight:700}.form-item-view[_ngcontent-%COMP%]   .form-item-control[_ngcontent-%COMP%]{flex:1}.form-item-view[_ngcontent-%COMP%]   .form-item-control.another-input[_ngcontent-%COMP%]{display:flex;align-items:center}.form-item-view[_ngcontent-%COMP%]   .form-item-control.another-input[_ngcontent-%COMP%]   .first-child[_ngcontent-%COMP%]{margin-right:2rem}.form-item-view[_ngcontent-%COMP%]   .form-item-control.another-input[_ngcontent-%COMP%]   .first-child.stretch[_ngcontent-%COMP%]{flex:1}.form-item-view[_ngcontent-%COMP%]   .form-item-control.another-input[_ngcontent-%COMP%]   .date-pickers[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:1.2rem}.form-item-view[_ngcontent-%COMP%]   .form-item-control.another-input[_ngcontent-%COMP%]   .date-pickers[_ngcontent-%COMP%]   .date-label[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}.form-item-duration[_ngcontent-%COMP%]{margin:.25rem 1.25rem;height:6rem}.form-item-datepicker[_ngcontent-%COMP%]{margin:.25rem 1.25rem;height:3rem}.delete-button[_ngcontent-%COMP%]{padding:1rem}"]}),n})();function bs(n,i){if(1&n&&(e.TgZ(0,"alg-section",7)(1,"div",8)(2,"div",9)(3,"label"),e.SDv(4,10),e.qZA()(),e.TgZ(5,"div",11),e._UZ(6,"alg-input",12),e.qZA()(),e.TgZ(7,"div",8)(8,"div",9)(9,"label"),e.SDv(10,13),e.qZA()(),e.TgZ(11,"div",11),e._UZ(12,"alg-input",14),e.qZA()()()),2&n){const t=e.oxw(3);e.xp6(6),e.Q6J("parentForm",t.itemForm),e.xp6(6),e.Q6J("parentForm",t.itemForm)}}function As(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-item-edit-advanced-parameters",16),e.NdJ("confirmRemoval",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.onConfirmRemoval())}),e.qZA()}if(2&n){const t=e.oxw(4);e.Q6J("parentForm",t.itemForm)("item",t.initialFormData)("attemptId",t.attemptId)}}function Os(n,i){if(1&n&&(e.ynx(0),e.YNc(1,As,1,3,"alg-item-edit-advanced-parameters",15),e.ALo(2,"allowsEditingAll"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.itemData.item.permissions))}}function Ns(n,i){if(1&n&&(e.TgZ(0,"form",4),e.YNc(1,bs,13,2,"alg-section",5),e.ALo(2,"allowsEditingAll"),e._UZ(3,"alg-item-edit-content",6),e.YNc(4,Os,3,3,"ng-container",0),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("formGroup",t.itemForm),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,5,t.itemData.item.permissions)),e.xp6(2),e.Q6J("parentForm",t.itemForm)("itemData",t.itemData),e.xp6(1),e.Q6J("ngIf",t.attemptId)}}function Ds(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ns,5,7,"form",3),e.ALo(2,"allowsEditingChildren"),e.BQk()),2&n){const t=e.oxw(),o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.itemData.item.permissions))("ngIfElse",o)}}function ws(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-floating-save",17),e.NdJ("save",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.save())})("cancel",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onCancel())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("saving",t.itemForm.disabled)}}function xs(n,i){1&n&&(e.TgZ(0,"div",18),e.SDv(1,19),e.qZA())}const En="1000-01-01T00:00:00Z",Tn="9999-12-31T23:59:59Z";let Cn=(()=>{class n{constructor(t,o,r,a,s,_,l){this.currentContentService=t,this.itemDataSource=o,this.formBuilder=r,this.updateItemService=a,this.updateItemStringService=s,this.actionFeedbackService=_,this.pendingChangesService=l,this.itemForm=this.formBuilder.group({title:["",[b.kI.required,b.kI.minLength(3),b.kI.maxLength(200)]],subtitle:["",b.kI.maxLength(200)],description:[""],url:["",b.kI.maxLength(2e3)],text_id:["",b.kI.maxLength(200)],uses_api:[!1],validation_type:[""],no_score:[!1],title_bar_visible:[!1],prompt_to_join_group_by_code:[!1],full_screen:[""],allows_multiple_attempts:[!1],requires_explicit_entry:[!1],duration_enabled:[!1],duration:[null],entering_time_min_enabled:[!1],entering_time_min:[null],entering_time_max_enabled:[!1],entering_time_max:[null],entry_participant_type:[!1],entry_frozen_teams:[!1],entry_max_team_size:[""],entry_min_admitted_members_ratio:[""]},{validators:[this.maxTeamSizeValidator()]})}get enableParticipation(){return"Skill"!==this.initialFormData?.type}get enableTeam(){return"Skill"!==this.initialFormData?.type}ngOnInit(){this.pendingChangesService.set(this)}ngOnChanges(){this.itemData&&(this.attemptId=this.itemData.route.attemptId||this.itemData.route.parentAttemptId,this.initialFormData={...this.itemData.item,durationEnabled:null!==this.itemData.item.duration,enteringTimeMinEnabled:this.itemData.item.enteringTimeMin.getTime()!==new Date(En).getTime(),enteringTimeMaxEnabled:this.itemData.item.enteringTimeMax.getTime()!==new Date(Tn).getTime()},this.resetForm())}ngOnDestroy(){this.pendingChangesService.clear()}isDirty(){return this.itemForm.dirty}getItemChanges(){const t={url:this.itemForm.get("url"),textId:this.itemForm.get("text_id"),usesApi:this.itemForm.get("uses_api"),validationType:this.itemForm.get("validation_type"),noScore:this.itemForm.get("no_score"),titleBarVisible:this.itemForm.get("title_bar_visible"),promptToJoinGroupByCode:this.itemForm.get("prompt_to_join_group_by_code"),fullScreen:this.itemForm.get("full_screen"),...this.enableParticipation?{allowsMultipleAttempts:this.itemForm.get("allows_multiple_attempts"),requiresExplicitEntry:this.itemForm.get("requires_explicit_entry"),durationEnabled:this.itemForm.get("duration_enabled"),duration:this.itemForm.get("duration"),enteringTimeMinEnabled:this.itemForm.get("entering_time_min_enabled"),enteringTimeMin:this.itemForm.get("entering_time_min"),enteringTimeMaxEnabled:this.itemForm.get("entering_time_max_enabled"),enteringTimeMax:this.itemForm.get("entering_time_max")}:{},...this.enableTeam?{entryParticipantType:this.itemForm.get("entry_participant_type"),entryFrozenTeams:this.itemForm.get("entry_frozen_teams"),entryMaxTeamSize:this.itemForm.get("entry_max_team_size"),entryMinAdmittedMembersRatio:this.itemForm.get("entry_min_admitted_members_ratio")}:{}};if(Object.values(t).includes(null)||!this.initialFormData)return;const o={},r=""!==t.url?.value?t.url?.value:null;(0,ge.pT)(this.initialFormData.url)&&r!==this.initialFormData.url&&(o.url=r);const a=t.usesApi?.value;(0,ge.pT)(this.initialFormData.usesApi)&&a!==this.initialFormData.usesApi&&(o.uses_api=a);const s=t.textId?.value;""!==s&&(o.text_id=s);const _=t.validationType?.value;_!==this.initialFormData.validationType&&(o.validation_type=_);const l=t.noScore?.value;l!==this.initialFormData.noScore&&(o.no_score=l);const p=t.titleBarVisible?.value;p!==this.initialFormData.titleBarVisible&&(o.title_bar_visible=p);const C=t.promptToJoinGroupByCode?.value;C!==this.initialFormData.promptToJoinGroupByCode&&(o.prompt_to_join_group_by_code=C);const h=t.fullScreen?.value;if(h!==this.initialFormData.fullScreen&&(o.full_screen=h),this.enableParticipation){const A=t.allowsMultipleAttempts?.value;A!==this.initialFormData.allowsMultipleAttempts&&(o.allows_multiple_attempts=A);const Q=t.requiresExplicitEntry?.value,L=Q!==this.initialFormData.requiresExplicitEntry;L&&(o.requires_explicit_entry=Q);const he=t.durationEnabled?.value,re=t.duration?.value,be=he!==this.initialFormData.durationEnabled;(re?.getMs()!==this.initialFormData?.duration?.getMs()||be||L)&&(o.duration=he&&Q?re?.toString():null);const Ee=t.enteringTimeMinEnabled?.value,Ge=Ee!==this.initialFormData.enteringTimeMinEnabled,Ae=t.enteringTimeMin?.value;(Ae.getTime()!==this.initialFormData.enteringTimeMin.getTime()||Ge)&&(o.entering_time_min=Ee?Ae:new Date(En));const Oe=t.enteringTimeMaxEnabled?.value,Ue=Oe!==this.initialFormData.enteringTimeMaxEnabled,Ne=t.enteringTimeMax?.value;(Ne.getTime()!==this.initialFormData.enteringTimeMax.getTime()||Ue)&&(o.entering_time_max=Oe?Ne:new Date(Tn))}if(this.enableTeam){const A=t.entryParticipantType?.value?"Team":"User";A!==this.initialFormData.entryParticipantType&&(o.entry_participant_type=A);const L=t.entryFrozenTeams?.value;L!==this.initialFormData.entryFrozenTeams&&(o.entry_frozen_teams=L);const re=t.entryMaxTeamSize?.value;re!==this.initialFormData.entryMaxTeamSize&&(o.entry_max_team_size=re);const fe=t.entryMinAdmittedMembersRatio?.value;fe!==this.initialFormData.entryMinAdmittedMembersRatio&&(o.entry_min_admitted_members_ratio=fe)}return o}updateItem(){if(!this.initialFormData)return(0,se._)(new Error("Invalid initial data"));const t=this.getItemChanges();return t?Object.keys(t).length?this.updateItemService.updateItem(this.initialFormData.id,t):(0,D.of)(void 0):(0,se._)(new Error("Invalid form"))}getItemStringChanges(){const t=this.itemForm.get("title"),o=this.itemForm.get("subtitle"),r=this.itemForm.get("description"),a=this.initialFormData?.string;if(null===t||null===o||null===r||!a)return;const s={},_=t.value;_!==a.title&&(s.title=_.trim());const l=o.value.trim()||null;l!==a.subtitle&&(s.subtitle=l);const p=r.value.trim()||null;return p!==a.description&&(s.description=p),s}updateString(){if(!this.initialFormData)return(0,se._)(new Error("Missing ID form"));const t=this.getItemStringChanges();return t?Object.keys(t).length?this.updateItemStringService.updateItem(this.initialFormData.id,t):(0,D.of)(void 0):(0,se._)(new Error("Invalid form or initial data"))}save(){if(this.initialFormData){if(this.itemForm.invalid)return void this.actionFeedbackService.error("Vous devez r\xE9soudre toutes les erreurs affich\xE9es dans le formulaire avant de sauvegarder.");this.itemForm.disable(),(0,V.D)([this.updateItem(),this.updateString()]).subscribe({next:t=>{this.actionFeedbackService.success("Modifications bien enregistr\xE9es."),this.itemDataSource.refreshItem(),this.currentContentService.forceNavMenuReload()},error:t=>{if(this.itemForm.enable(),this.actionFeedbackService.unexpectedError(),!(t instanceof f.UA))throw t}})}}onCancel(){this.resetForm()}onConfirmRemoval(){this.resetForm()}resetForm(){if(!this.initialFormData)return;const t=this.initialFormData;this.itemForm.reset({title:t.string.title||"",description:t.string.description||"",subtitle:t.string.subtitle||"",url:t.url||"",text_id:"",uses_api:t.usesApi||!1,validation_type:t.validationType,no_score:t.noScore,title_bar_visible:t.titleBarVisible||!1,prompt_to_join_group_by_code:t.promptToJoinGroupByCode||!1,full_screen:t.fullScreen,...this.enableParticipation?{allows_multiple_attempts:t.allowsMultipleAttempts,requires_explicit_entry:t.requiresExplicitEntry,duration_enabled:t.durationEnabled,duration:t.duration,entering_time_min_enabled:t.enteringTimeMinEnabled,entering_time_min:t.enteringTimeMin,entering_time_max_enabled:t.enteringTimeMaxEnabled,entering_time_max:t.enteringTimeMax}:{},...this.enableTeam?{entry_participant_type:"Team"===t.entryParticipantType,entry_frozen_teams:t.entryFrozenTeams,entry_max_team_size:t.entryMaxTeamSize,entry_min_admitted_members_ratio:t.entryMinAdmittedMembersRatio}:{}}),this.itemForm.enable()}maxTeamSizeValidator(){return t=>{const o=t.get("entry_participant_type")?.value,r=t.get("entry_max_team_size");return r&&r.setErrors(o?b.kI.min(1)(r):null),null}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(We.u),e.Y36(ke),e.Y36(b.QS),e.Y36(mt),e.Y36(ln),e.Y36(Se.C),e.Y36(jt.F))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-edit-wrapper"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:4,vars:2,consts:function(){let i,t,o,r;return i="Information",t="Titre",o="Sous-titre",r="Vous n'avez pas les permissions d'\xE9diter ce contenu.",[[4,"ngIf"],[3,"saving","save","cancel",4,"ngIf"],["notAuthorized",""],[3,"formGroup",4,"ngIf","ngIfElse"],[3,"formGroup"],["icon","fa fa-cog","label",i,4,"ngIf"],[3,"parentForm","itemData"],["icon","fa fa-cog","label",i],[1,"field"],[1,"field-name"],t,[1,"field-value"],["name","title","size","large",3,"parentForm"],o,["name","subtitle","size","large",3,"parentForm"],[3,"parentForm","item","attemptId","confirmRemoval",4,"ngIf"],[3,"parentForm","item","attemptId","confirmRemoval"],[3,"saving","save","cancel"],[1,"error","alg-error-text"],r]},template:function(t,o){1&t&&(e.YNc(0,Ds,3,4,"ng-container",0),e.YNc(1,ws,1,1,"alg-floating-save",1),e.YNc(2,xs,2,0,"ng-template",null,2,e.W1O)),2&t&&(e.Q6J("ngIf",o.itemData),e.xp6(1),e.Q6J("ngIf",o.itemForm.dirty))},dependencies:[d.O5,ue.e,Tt.a,ut.b,b._Y,b.JL,b.sg,gn,fn,q.fy,q.pG],styles:[".error[_ngcontent-%COMP%]{padding:1rem 0}.field[_ngcontent-%COMP%]{display:flex}.field[_ngcontent-%COMP%]   .field-name[_ngcontent-%COMP%]{float:left;width:20%;margin-top:6px}.field[_ngcontent-%COMP%]   .field-name[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding:12px 12px 12px 0;display:inline-block}.field[_ngcontent-%COMP%]   .field-value[_ngcontent-%COMP%]{float:left;width:80%;margin-top:6px}"]}),n})();const ys=c.n_({answer:c.AG(c.Z_),attemptId:c.AG(c.Z_),authorId:c.Z_,createdAt:G.QK,gradedAt:c.AG(G.QK),id:c.Z_,itemId:c.Z_,score:c.AG(c.Rx),state:c.AG(c.Z_),type:c.i0("Submission","Saved","Current")});let ks=(()=>{class n{constructor(t){this.http=t}get(t){return this.http.get(`${w.e.apiUrl}/answers/${t}`).pipe((0,u.m)(ys))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Rs=g(9520),It=g(9999),$s=g(2703);function Fs(n,i){if(1&n&&e._UZ(0,"alg-score-ring",12),2&n){const t=e.oxw(4);e.Q6J("bestScore",t.itemData.item.bestScore)("currentScore",t.itemData.currentResult.score)("isValidated",t.itemData.currentResult.validated)("diameter",70)}}function Ls(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Fs,1,4,"alg-score-ring",11),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.itemData.currentResult)}}function Gs(n,i){1&n&&(e.TgZ(0,"span",13),e._UZ(1,"i",14),e.qZA())}function Us(n,i){if(1&n&&(e.TgZ(0,"div",8),e.YNc(1,Ls,2,1,"ng-container",9),e.ALo(2,"allowsViewingContent"),e.YNc(3,Gs,2,0,"ng-template",null,10,e.W1O),e.qZA()),2&n){const t=e.MAs(4),o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.itemData.item.permissions))("ngIfElse",t)}}function Zs(n,i){if(1&n&&e._UZ(0,"alg-skill-progress",15),2&n){const t=e.oxw(2);e.Q6J("bestScore",t.itemData.item.bestScore)("currentScore",t.itemData.currentResult.score)}}function Js(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.itemData.item.string.subtitle)}}const Qs=function(n,i,t){return{parent:n,left:i,right:t}};function Bs(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-page-navigator",16),e.NdJ("parent",function(){const a=e.CHM(t).ngIf;return e.KtG(null==a||null==a.data||null==a.data.parent?null:a.data.parent.navigateTo())})("left",function(){const a=e.CHM(t).ngIf;return e.KtG(null==a||null==a.data||null==a.data.previous?null:a.data.previous.navigateTo())})("right",function(){const a=e.CHM(t).ngIf;return e.KtG(null==a||null==a.data||null==a.data.next?null:a.data.next.navigateTo())})("edit",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onEditButtonClicked())}),e.qZA()}if(2&n){const t=i.ngIf;e.Q6J("allowEditing",!1)("allowFullScreen",!1)("navigationMode",e.kEZ(3,Qs,!(null==t||!t.isReady||null==t||null==t.data||!t.data.parent),!(null==t||!t.isReady||null==t||null==t.data||!t.data.previous),!(null==t||!t.isReady||null==t||null==t.data||!t.data.next)))}}function Vs(n,i){if(1&n&&(e.TgZ(0,"div",1)(1,"div",2),e.YNc(2,Us,5,4,"div",3),e.YNc(3,Zs,1,2,"alg-skill-progress",4),e.TgZ(4,"div",5)(5,"p"),e._uU(6),e.qZA(),e.YNc(7,Js,2,1,"span",6),e.qZA(),e.YNc(8,Bs,1,7,"alg-page-navigator",7),e.ALo(9,"async"),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","Skill"!==t.itemData.item.type),e.xp6(1),e.Q6J("ngIf","Skill"===t.itemData.item.type&&t.itemData.currentResult),e.xp6(3),e.Oqu(t.itemData.item.string.title),e.xp6(1),e.Q6J("ngIf",t.itemData.item.string.subtitle),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,5,t.navigationNeighbors$))}}let Ys=(()=>{class n{constructor(t,o,r){this.modeService=t,this.activityNavTreeService=o,this.skillNavTreeService=r,this.activityNavigationNeighbors$=this.activityNavTreeService.navigationNeighbors$,this.skillNavigationNeighbors$=this.skillNavTreeService.navigationNeighbors$,this.navigationNeighbors$=this.activityNavigationNeighbors$}ngOnChanges(t){!this.itemData||(this.navigationNeighbors$=(0,ee.$)(this.itemData.item)?this.skillNavigationNeighbors$:this.activityNavigationNeighbors$)}onEditButtonClicked(){this.modeService.modeActions$.next(De.mw.StartEditing)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(De.dT),e.Y36(dt.X),e.Y36(dt.M))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-header"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:1,vars:1,consts:[["class","task-header-container",4,"ngIf"],[1,"task-header-container"],[1,"task-header"],["class","task-score-ring",4,"ngIf"],[3,"bestScore","currentScore",4,"ngIf"],[1,"task-title"],[4,"ngIf"],[3,"allowEditing","allowFullScreen","navigationMode","parent","left","right","edit",4,"ngIf"],[1,"task-score-ring"],[4,"ngIf","ngIfElse"],["lock",""],[3,"bestScore","currentScore","isValidated","diameter",4,"ngIf"],[3,"bestScore","currentScore","isValidated","diameter"],[1,"lock-icon"],[1,"fa","fa-lock"],[3,"bestScore","currentScore"],[3,"allowEditing","allowFullScreen","navigationMode","parent","left","right","edit"]],template:function(t,o){1&t&&e.YNc(0,Vs,10,7,"div",0),2&t&&e.Q6J("ngIf",o.itemData)},dependencies:[d.O5,$s._,ht.D,Fe.C,d.Ov,v.vJ],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}[_nghost-%COMP%]{background-color:#f1f2f7;background-color:var(--base-bk-color)}.task-header-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:10.3rem;position:relative;margin-top:1rem;margin-bottom:.5rem;justify-content:center}.task-header-container[_ngcontent-%COMP%]   alg-skill-progress[_ngcontent-%COMP%]{position:absolute;left:0;bottom:2rem;top:50%;width:100%;transform:translateY(3rem)}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:2rem}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]{flex-direction:column;align-items:initial}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   app-input[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]{display:flex;align-items:center}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%]   .parent-link[_ngcontent-%COMP%]{color:#4a90e2;color:var(--base-color)}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%]   .parent-item[_ngcontent-%COMP%]{margin-left:1rem;color:#787878;color:var(--base-text-color);font-size:1.2rem}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;align-items:center;color:#4a90e2;color:var(--base-color);font-size:1.2rem}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:1rem;cursor:pointer}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:1rem}.task-header-container[_ngcontent-%COMP%]   .task-header.edit[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{margin-right:0}.task-header-container[_ngcontent-%COMP%]   .task-header.small[_ngcontent-%COMP%]{height:3.5833rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .task-user-image[_ngcontent-%COMP%]{border-radius:9rem;background-color:#fff;margin-right:1.5rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .task-user-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:9rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{margin-right:1rem;flex:1;min-width:0}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:2.5rem;margin:0;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#787878;color:var(--base-text-color);font-size:1.6rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:.4167rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   span.user-avatar[_ngcontent-%COMP%]{position:relative}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   span.user-id[_ngcontent-%COMP%]{color:#4a90e2;color:var(--base-color);font-size:1.6667rem;font-weight:700}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .clock-icon[_ngcontent-%COMP%]{color:#4a4a4a;color:var(--dark-text-color);font-size:2rem;font-weight:700;margin-right:.4167rem}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .clock-icon.finished[_ngcontent-%COMP%]{color:#dbdbdb;color:var(--light-text-color)}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .remaining-time[_ngcontent-%COMP%]{color:#4a4a4a;color:var(--dark-text-color);font-size:2rem;font-weight:700}.task-header-container[_ngcontent-%COMP%]   .task-header[_ngcontent-%COMP%]   .remaining-time.finished[_ngcontent-%COMP%]{color:#dbdbdb;color:var(--light-text-color)}.task-header-container[_ngcontent-%COMP%]   .task-score-ring[_ngcontent-%COMP%]{width:5.83333rem;height:5.83333rem;margin-right:1rem}.task-header-container[_ngcontent-%COMP%]   .lock-icon[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:#787878;color:var(--base-text-color);font-size:1.6rem;border:4px solid #c1c2c6;border:4px solid var(--lock-border-color);border-radius:50%}.task-header-container[_ngcontent-%COMP%]   .team-count[_ngcontent-%COMP%]{margin-left:1.6667rem;font-size:1.6667rem;color:#4a4a4a;color:var(--dark-text-color)}.task-header-container[_ngcontent-%COMP%]   .team-view-container[_ngcontent-%COMP%]{align-items:center}.task-header-container[_ngcontent-%COMP%]   .team-view-container[_ngcontent-%COMP%]   app-sub-grid[_ngcontent-%COMP%]{margin-bottom:2rem}.task-header-container[_ngcontent-%COMP%]   .team-view-container[_ngcontent-%COMP%]   app-sub-grid[_ngcontent-%COMP%] + .tool-container[_ngcontent-%COMP%]{margin-top:2rem}.task-header-container[_ngcontent-%COMP%]   .team-view-container[_ngcontent-%COMP%]   .tool-container[_ngcontent-%COMP%]{flex:2;display:flex;align-items:center;justify-content:center}.task-header-container[_ngcontent-%COMP%]   .team-view-container[_ngcontent-%COMP%]   .tool-container[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{width:13.3333rem}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:1.2rem;color:#787878;color:var(--base-text-color)}.task-header-container[_ngcontent-%COMP%]   .checklist-container-title[_ngcontent-%COMP%]{font-weight:700;padding-left:1rem}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist[_ngcontent-%COMP%]{list-style:none;padding-left:0;display:flex;flex-direction:column}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.5rem}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#4a90e2;color:var(--base-color);height:1.6667rem;width:2.0833rem;margin-right:.5rem}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item-icon.danger[_ngcontent-%COMP%]{color:#ff001f;color:var(--section-danger-handle-color)}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item-label[_ngcontent-%COMP%]{flex:1}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item-label.danger[_ngcontent-%COMP%]{color:#ff001f;color:var(--section-danger-handle-color);font-weight:700}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item.checklist-score[_ngcontent-%COMP%]{border-bottom:.1rem solid #E8D1D8;margin-left:1.6667rem;min-height:2.9167rem}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item.checklist-score[_ngcontent-%COMP%]:last-child{border-bottom:.1rem solid transparent}.task-header-container[_ngcontent-%COMP%]   .checklist-container[_ngcontent-%COMP%]   .checklist-item.checklist-score[_ngcontent-%COMP%]   app-skill-progress[_ngcontent-%COMP%]{width:13.3333rem}"]}),n})();var de=g(2578),zs=g(6257),Mn=g(5659),Xs=g(7579);function qs(n,i){1&n&&e._UZ(0,"alg-loading",3)}function Hs(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",4),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function Ws(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"th")(2,"div",13),e._uU(3),e.qZA()(),e.BQk()),2&n){const t=i.$implicit;e.xp6(3),e.hij(" ",t.header," ")}}function Ks(n,i){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,Ws,4,1,"ng-container",12),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function js(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"th",9)(2,"div",10)(3,"p-button",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.refresh())}),e.qZA()()()(),e.YNc(4,Ks,2,1,"tr",0)}if(2&n){const t=i.$implicit,o=i.$implicit;e.xp6(1),e.Q6J("colSpan",o.length),e.xp6(3),e.Q6J("ngIf",t.length>0)}}function ec(n,i){if(1&n&&(e.ynx(0),e._uU(1," \xa0( "),e.TgZ(2,"a",17),e.SDv(3,18),e.ALo(4,"rawItemLink"),e.qZA(),e._uU(5," ) "),e.BQk()),2&n){const t=e.oxw(3).$implicit;e.xp6(2),e.Q6J("routerLink",e.Dn7(4,1,t.item,"details",t.answerId))}}function tc(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"logActionDisplay"),e.YNc(3,ec,6,5,"ng-container",0),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,2,t.activityType,t.score)," "),e.xp6(2),e.Q6J("ngIf",t.displayLoadButton)}}const nc=function(n){return{disabled:n}};function oc(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"a",19),e.ALo(2,"rawItemLink"),e._uU(3),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(5,nc,!t.item))("routerLink",e.lcZ(2,3,t.item)),e.xp6(2),e.hij(" ",t.item.string.title," ")}}const ic=function(n){return{id:n,isUser:!0}};function rc(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"a",17),e.ALo(2,"groupLink"),e._uU(3),e.ALo(4,"userCaption"),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("routerLink",e.lcZ(2,2,e.VKq(6,ic,t.user.id))),e.xp6(2),e.Oqu(e.lcZ(4,4,t.user))}}function ac(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.at,"short")," ")}}function sc(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.hij(" ",o[t.field]," ")}}function cc(n,i){if(1&n&&(e.TgZ(0,"td"),e.ynx(1,14),e.YNc(2,tc,4,5,"ng-container",15),e.YNc(3,oc,4,7,"ng-container",15),e.YNc(4,rc,5,8,"ng-container",15),e.YNc(5,ac,3,4,"ng-container",15),e.YNc(6,sc,2,1,"ng-container",16),e.BQk(),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","activityType"),e.xp6(1),e.Q6J("ngSwitchCase","item.string.title"),e.xp6(1),e.Q6J("ngSwitchCase","item.user"),e.xp6(1),e.Q6J("ngSwitchCase","at")}}function _c(n,i){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,cc,7,5,"td",12),e.qZA()),2&n){const t=i.columns;e.xp6(1),e.Q6J("ngForOf",t)}}function lc(n,i){if(1&n&&(e.TgZ(0,"tr")(1,"td")(2,"span"),e.SDv(3,20),e.qZA()()()),2&n){const t=i.$implicit;e.xp6(1),e.uIk("colspan",t.length)}}function gc(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"p-table",5),e.YNc(2,js,5,2,"ng-template",6),e.YNc(3,_c,2,1,"ng-template",7),e.YNc(4,lc,4,1,"ng-template",8),e.qZA(),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("columns",t.data.columns)("value",t.data.rowData)("loading",t.isFetching)}}function dc(n,i){if(1&n&&(e.ynx(0),e.YNc(1,qs,1,0,"alg-loading",1),e.YNc(2,Hs,1,1,"alg-error",2),e.YNc(3,gc,5,3,"ng-container",0),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching&&!t.data),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.data)}}let pc=(()=>{class n{constructor(t,o,r){this.activityLogService=t,this.groupWatchingService=o,this.sessionService=r,this.isTaskReadOnly=!1,this.refresh$=new N.x,this.item$=new P.t(1),this.state$=(0,O.a)([this.item$.pipe((0,y.x)()),this.groupWatchingService.watchedGroup$]).pipe((0,E.w)(([a,s])=>this.getData$(a,s)),(0,I.iS)({resetter:this.refresh$}))}ngOnChanges(){!this.itemData||this.item$.next(this.itemData.item)}ngOnDestroy(){this.item$.complete(),this.refresh$.complete()}refresh(){this.refresh$.next()}getData$(t,o){return(0,O.a)([this.activityLogService.getActivityLog(t.id,o?.route.id),this.sessionService.userProfile$]).pipe((0,m.U)(([r,a])=>({columns:this.getLogColumns(t.type,o),rowData:r.filter(s=>!this.isSelfCurrentAnswer(s,a.groupId)).map(s=>({...s,displayLoadButton:this.canDisplayLoadButton(s,a.groupId)}))})))}isSelfCurrentAnswer(t,o){return"current_answer"===t.activityType&&t.participant.id===o}canDisplayLoadButton(t,o){if(!this.itemData)throw new Error("itemData must be defined");return!!t.answerId&&(this.isTaskReadOnly?(0,ie.C1)(this.itemData.item.permissions)&&["submission","saved_answer","current_answer"].includes(t.activityType):t.user?.id===o&&["submission","saved_answer"].includes(t.activityType))}getLogColumns(t,o){return[{field:"activityType",header:"Op\xE9ration",enabled:!0},{field:"item.string.title",header:"Contenu",enabled:!["Task","Course"].includes(t)},{field:"item.user",header:"User",enabled:o&&!o.route.isUser},{field:"at",header:"Date/Heure",enabled:!0}].filter(a=>a.enabled).map(a=>({field:a.field,header:a.header}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(nn.t),e.Y36(ye.y),e.Y36(Qe.o))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-log-view"]],inputs:{itemData:"itemData",isTaskReadOnly:"isTaskReadOnly"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t,o;return i="Erreur lors du chargement les activit\xE9s r\xE9centes",t=" Load ",o="There is no progress to report for this item.",[[4,"ngIf"],["size","medium",4,"ngIf"],["class","dark","icon","fa fa-exclamation-triangle","message",i,3,"showRefreshButton","refresh",4,"ngIf"],["size","medium"],["icon","fa fa-exclamation-triangle","message",i,1,"dark",3,"showRefreshButton","refresh"],[1,"alg-table",3,"columns","value","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"colSpan"],[1,"header-container","header-refresh"],["icon","pi pi-refresh",3,"click"],[4,"ngFor","ngForOf"],[1,"header-container"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"alg-link",3,"routerLink"],t,[1,"alg-link",3,"ngClass","routerLink"],o]},template:function(t,o){1&t&&(e.YNc(0,dc,4,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.mk,d.sg,d.O5,d.RF,d.n9,d.ED,Y.yS,Pe.jx,de.iA,ne.q,j.N,_e.zx,d.Ov,d.uU,Et.M,zs.s,Mn.u,Xs.m],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}[_nghost-%COMP%]{position:relative;display:block;padding-top:2rem}[_nghost-%COMP%]   .header-refresh[_ngcontent-%COMP%]{justify-content:flex-end}"]}),n})();var mc=g(3347),uc=g(4925),hc=g(6763),ot=g(7942),Ec=g(5278),Tc=g(4865);const Cc=c.n_({averageScore:c.Rx,avgHintsRequested:c.Rx,avgSubmissions:c.Rx,avgTimeSpent:c.Rx,groupId:c.Z_,itemId:c.Z_,validationRate:c.Rx}),Sn=c.n_({groupId:c.Z_,hintsRequested:c.Rx,itemId:c.Z_,latestActivityAt:c.AG(G.QK),score:c.Rx,submissions:c.Rx,timeSpent:c.Rx,validated:c.O7});let Mc=(()=>{class n{constructor(t){this.http=t}getUsersProgress(t,o,r){let a=(new f.LE).set("parent_item_ids",o.join(","));return void 0!==r?.limit&&(a=a.set("limit",r.limit)),void 0!==r?.fromId&&(a=a.set("from.id",r.fromId)),this.http.get(`${w.e.apiUrl}/groups/${t}/user-progress`,{params:a}).pipe((0,u.m)(c.IX(Sn)))}getTeamsProgress(t,o){const r=(new f.LE).set("parent_item_ids",o.join(","));return this.http.get(`${w.e.apiUrl}/groups/${t}/team-progress`,{params:r}).pipe((0,u.m)(c.IX(Sn)))}getGroupsProgress(t,o){const r=(new f.LE).set("parent_item_ids",o.join(","));return this.http.get(`${w.e.apiUrl}/groups/${t}/group-progress`,{params:r}).pipe((0,u.m)(c.IX(Cc)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Sc=g(5790);let Ic=(()=>{class n{constructor(t){this.http=t}getCSVData(t,o,r){const a=(new f.LE).set("parent_item_ids",r.join(","));return this.http.get(`${w.e.apiUrl}/groups/${t}/${o}-progress-csv`,{params:a,responseType:"text"}).pipe((0,u.m)(c.Z_))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var In=g(1408),vt=g(4329);let vc=(()=>{class n{constructor(){this.change=new e.vpe,this.selectedTypeFilter=0,this.typeFilters=[{icon:"fa fa-users",label:"sous-groupes",value:"Groups"},{icon:"fa fa-users",label:"\xE9quipes",value:"Teams"},{icon:"fa fa-user",label:"utilisateurs",value:"Users"}]}ngOnInit(){this.defaultValue&&(this.selectedTypeFilter=this.typeFilters.findIndex(t=>t.value===this.defaultValue))}onTypeFilterChanged(t){this.change.emit((0,Ce.I)(this.typeFilters[t]).value),this.selectedTypeFilter=t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-composition-filter"]],inputs:{defaultValue:"defaultValue"},outputs:{change:"change"},decls:2,vars:2,consts:[[1,"selection-tool"],["type","square",3,"items","selected","change"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"alg-selection",1),e.NdJ("change",function(a){return o.onTypeFilterChanged(a)}),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("items",o.typeFilters)("selected",o.selectedTypeFilter))},dependencies:[mn.p],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.selection-tool[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-radius:.5rem;background-color:#f1f2f7;background-color:var(--base-bk-color);max-width:56rem;margin-left:auto;margin-right:auto;margin-bottom:2rem}.selection-tool[_ngcontent-%COMP%]   app-selection[_ngcontent-%COMP%]:first-child{margin:1rem}"]}),n})();const Pc=["userProgress",""];function bc(n,i){if(1&n&&e._UZ(0,"alg-score-ring",3),2&n){const t=e.oxw();e.Q6J("currentScore",t.userProgress.score)("diameter",32)("scoreFillColor","#FFF")}}function Ac(n,i){1&n&&(e.TgZ(0,"span",4),e._UZ(1,"i",5),e.qZA())}let Oc=(()=>{class n{constructor(){this.state="no-score"}ngOnInit(){(0,Ce.o)(this.userProgress,"user progress must be defined")}ngOnChanges(t){(0,Ce.o)(this.userProgress,"user progress must be defined"),this.state=this.userProgress.validated||100===this.userProgress.score?"success":this.userProgress.score>0?"in-progress":0===this.userProgress.score&&this.userProgress.timeSpent>0?"no-score":"not-started"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-user-progress","userProgress",""]],inputs:{userProgress:"userProgress"},features:[e.TTD],attrs:Pc,decls:3,vars:5,consts:[[1,"group-situation-data",3,"ngClass"],[3,"currentScore","diameter","scoreFillColor",4,"ngIf"],["class","situation-check",4,"ngIf"],[3,"currentScore","diameter","scoreFillColor"],[1,"situation-check"],[1,"fa","fa-check"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,bc,1,3,"alg-score-ring",1),e.YNc(2,Ac,2,0,"span",2),e.qZA()),2&t&&(e.ekj("pointer","not-started"!==o.state),e.Q6J("ngClass",o.state),e.xp6(1),e.Q6J("ngIf","success"!==o.state&&"not-started"!==o.state),e.xp6(1),e.Q6J("ngIf","success"===o.state))},dependencies:[d.mk,d.O5,Fe.C],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.group-situation-data[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.4167rem;height:3.5833rem}.group-situation-data.pointer[_ngcontent-%COMP%]{cursor:pointer}.group-situation-data.success[_ngcontent-%COMP%]{background-color:#9acc68}.group-situation-data.in-progress[_ngcontent-%COMP%]{background-color:#f5a623;background-color:var(--secondary-color)}.group-situation-data.no-score[_ngcontent-%COMP%]{background-color:#f9c6cd}.group-situation-data.not-started[_ngcontent-%COMP%]{background-color:#fff}.group-situation-data[_ngcontent-%COMP%]   .situation-check[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#fff}.group-situation-data[_ngcontent-%COMP%]   alg-score-ring.not-started[_ngcontent-%COMP%]{background-color:red}"]}),n})();const Le=(0,ae.zG)(Ie.Cc,c.wf(Ie.MY),c.wf(Ie.XR)),Nc=c.n_({granted:c.wf(Le)(Ie.SM),computed:Le,grantedViaGroupMembership:Le,grantedViaItemUnlocking:Le,grantedViaSelf:Le,grantedViaOther:Le});let Dc=(()=>{class n{constructor(t){this.http=t}getPermissions(t,o,r){return this.http.get(`${w.e.apiUrl}/groups/${t}/permissions/${o}/${r}`).pipe((0,u.m)(Nc))}updatePermissions(t,o,r,a){return this.http.put(`${w.e.apiUrl}/groups/${t}/permissions/${o}/${r}`,{can_view:a.canView,can_grant_view:a.canGrantView,can_watch:a.canWatch,can_edit:a.canEdit,can_make_session_official:a.canMakeSessionOfficial,is_owner:a.isOwner}).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const H={canView:{string:"Visibilit\xE9",none:"Rien",info:"Info",content:"Contenu",content_with_descendants:"Contenu et descendants",solution:"Solution"},canGrantView:{string:"Droit de donner des droits de visibilit\xE9",none:"Rien",enter:"Info & Entr\xE9e",content:"Contenu",content_with_descendants:"Contenu et descendants",solution:"Solution",solution_with_grant:"Solution et transfert"},canWatch:{string:"Droit d'observation",none:"Rien",result:"R\xE9sultats",answer:"R\xE9ponse",answer_with_grant:"R\xE9ponse et transfert"},canEdit:{string:"Droit d'\xE9dition",none:"Rien",children:"Enfants",all:"Tout",all_with_grant:"Tout et transfert"}},xc=["canView","canGrantView","canWatch","canEdit"];function vn(n){return i=>{if(function yc(n){return xc.includes(n.permission)}(i)){const t=H[i.permission],o="giver"===i.on?"Vous":function wc(n){switch(n){case"Users":return "Cet utilisateur";case"Groups":return "Ce groupe";case"Teams":return "Cette \xE9quipe"}}(n);return`${o} needs "${t.string}" ${"atLeast"===i.constraintType?"\xEAtre au moins":"\xEAtre"} "${t[i.expectedValue]}"`}if("isOwner"===i.permission&&!0===i.expectedValue)return "Vous devez \xEAtre propri\xE9taire de cet \xE9l\xE9ment";throw new Error("Unexpected constraint error on permissions")}}function W(n){return(i,t,o)=>({permission:n,expectedValue:i,constraintType:o??"equals",on:t})}function Ye(n,i){return t=>n.indexOf(i)>=n.indexOf(t)}function Pn(n,i){const t=Ye(F.Cx,i.canGrantView);return n.canView!==v.F8.Info||t(F.pE.Enter)?n.canView!==v.F8.Content||t(F.pE.Content)?n.canView!==v.F8.ContentWithDescendants||t(F.pE.ContentWithDescendants)?n.canView!==v.F8.Solution||t(F.pE.Solution)?[]:[W("canGrantView")(F.pE.Solution,"giver","atLeast")]:[W("canGrantView")(F.pE.ContentWithDescendants,"giver","atLeast")]:[W("canGrantView")(F.pE.Content,"giver","atLeast")]:[W("canGrantView")(F.pE.Enter,"giver","atLeast")]}function bn(n,i){if(n.canGrantView===F.pE.None)return[];const t=[],o=Ye(v.UJ,n.canView);return n.canGrantView===F.pE.SolutionWithGrant?(i.isOwner||t.push(W("isOwner")(!0,"giver")),o(v.F8.Solution)||t.push(W("canView")(v.F8.Solution,"receiver","atLeast"))):(i.canGrantView!==F.pE.SolutionWithGrant&&t.push(W("canGrantView")(F.pE.SolutionWithGrant,"giver")),n.canGrantView===F.pE.Enter&&!o(v.F8.Info)&&t.push(W("canView")(v.F8.Info,"receiver","atLeast")),n.canGrantView===F.pE.Content&&!o(v.F8.Content)&&t.push(W("canView")(v.F8.Content,"receiver","atLeast")),n.canGrantView===F.pE.ContentWithDescendants&&!o(v.F8.ContentWithDescendants)&&t.push(W("canView")(v.F8.ContentWithDescendants,"receiver","atLeast")),n.canGrantView===F.pE.Solution&&!o(v.F8.Solution)&&t.push(W("canView")(v.F8.Solution,"receiver","atLeast"))),t}function An(n,i){if(n.canWatch===ie.pN.None)return[];const t=[];return Ye(v.UJ,n.canView)(v.F8.Content)||t.push(W("canView")(v.F8.Content,"receiver","atLeast")),n.canWatch===ie.pN.AnswerWithGrant?i.isOwner||t.push(W("isOwner")(!0,"giver")):i.canWatch!==ie.pN.AnswerWithGrant&&t.push(W("canWatch")(ie.pN.AnswerWithGrant,"giver")),t}function On(n,i){if(n.canEdit===q.m$.None)return[];const t=[];return Ye(v.UJ,n.canView)(v.F8.Content)||t.push(W("canView")(v.F8.Content,"receiver","atLeast")),n.canEdit===q.m$.AllWithGrant?i.isOwner||t.push(W("isOwner")(!0,"giver")):i.canEdit!==q.m$.AllWithGrant&&t.push(W("canEdit")(q.m$.AllWithGrant,"giver")),t}function Nn(n,i){if(!n.canMakeSessionOfficial)return[];const t=[];return i.isOwner||t.push(W("isOwner")(!0,"giver")),Ye(v.UJ,n.canView)(v.F8.Info)||t.push(W("canView")(v.F8.Info,"receiver","atLeast")),t}function Dn(n,i){return n.isOwner?i.isOwner?[]:[W("isOwner")(!0,"giver")]:[]}function ze(n){switch(n){case"Users":return "The user";case"Groups":return "Le groupe";case"Teams":return "L\u2019\xE9quipe"}}function wn(n){const i=ze(n);return[{value:v.F8.None,label:H.canView.none,comment:"" + i + " ne peut pas voir cet \xE9l\xE9ment"},{value:v.F8.Info,label:H.canView.info,comment:"" + i + " peut voir cet \xE9l\xE9ment"},{value:v.F8.Content,label:H.canView.content,comment:"" + i + " peut voir le contenu de cet \xE9l\xE9ment"},{value:v.F8.ContentWithDescendants,label:H.canView.content_with_descendants,comment:"" + i + " peut \xE9galement voir le contenu de tous les descendants de cet \xE9l\xE9ment (lorsque c'est possible pour ce groupe)"},{value:v.F8.Solution,label:H.canView.solution,comment:"" + i + " peut \xE9galement voir les solutions de cet \xE9l\xE9ment et ses descendants (quand c'est possible pour ce groupe)"}]}function kc(n){const i=ze(n);return[{value:F.pE.None,label:H.canGrantView.none,comment:"" + i + " ne peut pas donner d'acc\xE8s \xE0 cet \xE9l\xE9ment"},{value:F.pE.Enter,label:H.canGrantView.enter,comment:"" + i + " peut donner le droit de visibilit\xE9 'info' et le droit d'entr\xE9e (si applicable)"},{value:F.pE.Content,label:H.canGrantView.content,comment:"" + i + " peut \xE9galement donner le droit de visibilit\xE9 \"contenu\""},{value:F.pE.ContentWithDescendants,label:H.canGrantView.content_with_descendants,comment:"" + i + " peut \xE9galement donner le droit de visibilit\xE9 \"contenu et descendants\""},{value:F.pE.Solution,label:H.canGrantView.solution,comment:"" + i + " peut \xE9galement donner le droit de visibilit\xE9 \"solution\""},{value:F.pE.SolutionWithGrant,label:H.canGrantView.solution_with_grant,comment:"" + i + " peut \xE9galement donner le droit de donner les droit de visibilit\xE9"}]}function Rc(n){const i=ze(n);return[{value:ie.pN.None,label:H.canWatch.none,comment:"" + i + " ne peut observer les utilisateurs sur cet \xE9l\xE9ment"},{value:ie.pN.Result,label:H.canWatch.result,comment:"" + i + " peut voir les soumissions et scores des utilisateurs sur cet \xE9l\xE9ment, mais pas leurs r\xE9ponses"},{value:ie.pN.Answer,label:H.canWatch.answer,comment:"" + i + " peut \xE9galement voir les r\xE9ponses des autres utilisateurs sur cet \xE9l\xE9ment"},{value:ie.pN.AnswerWithGrant,label:H.canWatch.answer_with_grant,comment:"" + i + " peut \xE9galement donner le droit d'observation \xE0 d'autres"}]}function $c(n){const i=ze(n);return[{value:q.m$.None,label:H.canEdit.none,comment:"" + i + " ne pas modifier cet \xE9l\xE9ment"},{value:q.m$.Children,label:H.canEdit.children,comment:"" + i + " peut ajouter des enfants \xE0 cet \xE9l\xE9ment et \xE9diter comment les permissions se propagent vers eux"},{value:q.m$.All,label:H.canEdit.all,comment:"" + i + " peut \xE9galement \xE9diter le contenu de cet \xE9l\xE9ment, mais pas le supprimer"},{value:q.m$.AllWithGrant,label:H.canEdit.all_with_grant,comment:"" + i + " peut \xE9galement donner les droits d'\xE9dition \xE0 d'autres"}]}function it(n,i){return t=>n.indexOf(i)>n.indexOf(t)}function rt(n,i,t,o){const r=n.findIndex(s=>s.value===i),a=n.findIndex(s=>s.value===t);return n.map((s,_)=>_>r&&_<=a?{...s,selected:!0,tooltip:[...s.tooltip||[],"Users"===o?"This user has this permission via one of the other group he is member of, or one of their ancestors.":"This group has this permission via one of one of its ancestor group."]}:s)}var xn=g(4813),Uc=g(6750),Zc=g(4371);const Jc=["giverPermissions",""];function Qc(n,i){if(1&n&&e._UZ(0,"alg-progress-select",12),2&n){const t=i.$implicit,o=e.oxw(2);e.Q6J("collapsed",t)("values",o.permissionsDialogData.canViewValues)}}function Bc(n,i){if(1&n&&e._UZ(0,"alg-progress-select",13),2&n){const t=i.$implicit,o=e.oxw(2);e.Q6J("collapsed",t)("values",o.permissionsDialogData.canGrantViewValues)}}function Vc(n,i){if(1&n&&e._UZ(0,"alg-progress-select",14),2&n){const t=i.$implicit,o=e.oxw(2);e.Q6J("collapsed",t)("values",o.permissionsDialogData.canWatchValues)}}function Yc(n,i){if(1&n&&e._UZ(0,"alg-progress-select",15),2&n){const t=i.$implicit,o=e.oxw(2);e.Q6J("collapsed",t)("values",o.permissionsDialogData.canEditValues)}}function zc(n,i){if(1&n&&(e.TgZ(0,"span"),e.SDv(1,18),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.pQV(t.targetTypeString),e.QtT(1)}}const yn=function(){return[]};function Xc(n,i){if(1&n&&(e.TgZ(0,"alg-switch-field",16),e.YNc(1,zc,2,1,"ng-template",null,17,e.W1O),e.qZA()),2&n){const t=i.$implicit,o=e.oxw(2);let r;e.Q6J("collapsed",t)("disabledTooltip",null!==(r=o.permissionsDialogData.canMakeSessionOfficialDisabledTooltip)&&void 0!==r?r:e.DdM(2,yn))}}function qc(n,i){if(1&n&&(e.TgZ(0,"span"),e.SDv(1,20),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.pQV(t.targetTypeString),e.QtT(1)}}function Hc(n,i){if(1&n&&(e.TgZ(0,"alg-switch-field",19),e.YNc(1,qc,2,1,"ng-template",null,17,e.W1O),e.qZA()),2&n){const t=i.$implicit,o=e.oxw(2);let r;e.Q6J("collapsed",t)("disabledTooltip",null!==(r=o.permissionsDialogData.isOwnerDisabledTooltip)&&void 0!==r?r:e.DdM(2,yn))}}function Wc(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"form",1)(1,"alg-collapsible-section",2),e.YNc(2,Qc,1,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(4,"alg-collapsible-section",4),e.YNc(5,Bc,1,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(7,"alg-collapsible-section",5),e.YNc(8,Vc,1,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(10,"alg-collapsible-section",6),e.YNc(11,Yc,1,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(13,"alg-collapsible-section",7),e.YNc(14,Xc,3,3,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(16,"alg-collapsible-section",8),e.YNc(17,Hc,3,3,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(19,"div",9)(20,"p-button",10),e.NdJ("onClick",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onCancel())}),e.qZA(),e.TgZ(21,"p-button",11),e.NdJ("onClick",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onAccept())}),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.canView))("errorMessage",null==t.form.errors||null==t.form.errors.canView?null:t.form.errors.canView[0]),e.xp6(3),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.canGrantView))("errorMessage",null==t.form.errors||null==t.form.errors.canGrantView?null:t.form.errors.canGrantView[0]),e.xp6(3),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.canWatch))("errorMessage",null==t.form.errors||null==t.form.errors.canWatch?null:t.form.errors.canWatch[0]),e.xp6(3),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.canEdit))("errorMessage",null==t.form.errors||null==t.form.errors.canEdit?null:t.form.errors.canEdit[0]),e.xp6(3),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.canMakeSessionOfficial))("errorMessage",null==t.form.errors||null==t.form.errors.canMakeSessionOfficial?null:t.form.errors.canMakeSessionOfficial[0]),e.xp6(3),e.Q6J("collapsible",!(null!=t.form.errors&&t.form.errors.isOwner))("errorMessage",null==t.form.errors||null==t.form.errors.isOwner?null:t.form.errors.isOwner[0]),e.xp6(5),e.Q6J("disabled",!t.form.dirty||t.form.invalid||t.form.disabled||t.acceptButtonDisabled)}}let Kc=(()=>{class n{constructor(t){this.fb=t,this.targetType="Users",this.acceptButtonDisabled=!1,this.save=new e.vpe,this.cancel=new e.vpe,this.targetTypeString="",this.permissionsDialogData={canViewValues:[],canGrantViewValues:[],canEditValues:[],canWatchValues:[]},this.form=this.fb.group({canView:[v.F8.None],canGrantView:[F.pE.None],canWatch:[ie.pN.None],canEdit:[q.m$.None],canMakeSessionOfficial:[!1],isOwner:[!0]}),this.regenerateValues=new N.x,this.subscription=(0,le.T)(this.form.valueChanges,this.regenerateValues.asObservable()).subscribe(()=>{if(this.permissions){const o=this.form.value;this.permissionsDialogData=function Fc(n,i,t){const o=r=>{const a=r.map(s=>vn(n)(s));return a.length?a:void 0};return{canViewValues:wn(n).map(r=>{const a=o(Pn({...i,canView:r.value},t));return a?{...r,disabled:!0,tooltip:a}:r}),canGrantViewValues:kc(n).map(r=>{const a=o(bn({...i,canGrantView:r.value},t));return a?{...r,disabled:!0,tooltip:a}:r}),canWatchValues:Rc(n).map(r=>{const a=o(An({...i,canWatch:r.value},t));return a?{...r,disabled:!0,tooltip:a}:r}),canEditValues:$c(n).map(r=>{const a=o(On({...i,canEdit:r.value},t));return a?{...r,disabled:!0,tooltip:a}:r}),isOwnerDisabledTooltip:o(Dn({...i,isOwner:!0},t))||void 0,canMakeSessionOfficialDisabledTooltip:o(Nn({...i,canMakeSessionOfficial:!0},t))||void 0}}(this.targetType,o,this.giverPermissions),this.computedPermissions&&(this.permissionsDialogData=function Gc(n,i,t,o,r){const a=it(v.UJ,o.canView),s=it(F.Cx,o.canGrantView),_=it(ie.fj,o.canWatch),l=it(q.LE,o.canEdit);return a(i.canView)&&(n.canViewValues=rt(n.canViewValues,t.canView,o.canView,r)),s(i.canGrantView)&&(n.canGrantViewValues=rt(n.canGrantViewValues,t.canGrantView,o.canGrantView,r)),_(i.canWatch)&&(n.canWatchValues=rt(n.canWatchValues,t.canWatch,o.canWatch,r)),l(i.canEdit)&&(n.canEditValues=rt(n.canEditValues,t.canEdit,o.canEdit,r)),n}(this.permissionsDialogData,this.permissions,o,this.computedPermissions,this.targetType))}})}ngOnDestroy(){this.subscription.unsubscribe(),this.regenerateValues.complete()}ngOnChanges(t){this.targetTypeString=ze(this.targetType),(t.permissions||t.giverPermissions)&&this.permissions&&(this.form.setValidators(function Lc(n,i){const t=o=>r=>{const a=r.map(vn(i));return a.length?{[o]:a}:{}};return o=>{const r={canView:o.get("canView")?.value,canGrantView:o.get("canGrantView")?.value,canWatch:o.get("canWatch")?.value,canEdit:o.get("canEdit")?.value,canMakeSessionOfficial:o.get("canMakeSessionOfficial")?.value,isOwner:o.get("isOwner")?.value,canEnterFrom:new Date,canEnterUntil:new Date};let a={...t("canView")(Pn(r,n)),...t("canGrantView")(bn(r,n)),...t("canWatch")(An(r,n)),...t("canEdit")(On(r,n))};return o.get("isOwner")?.dirty&&(a={...a,...t("isOwner")(Dn(r,n))}),o.get("canMakeSessionOfficial")?.dirty&&(a={...a,...t("canMakeSessionOfficial")(Nn(r,n))}),Object.keys(a).length>0?a:null}}(this.giverPermissions,this.targetType)),this.form.updateValueAndValidity(),this.form.reset({...this.permissions},{emitEvent:!1})),t.targetType&&this.regenerateValues.next()}onAccept(){if(!this.form.dirty||this.form.invalid)return;const t={canView:this.form.get("canView")?.value,canGrantView:this.form.get("canGrantView")?.value,canWatch:this.form.get("canWatch")?.value,canEdit:this.form.get("canEdit")?.value,canMakeSessionOfficial:this.form.get("canMakeSessionOfficial")?.value,isOwner:this.form.get("isOwner")?.value};this.save.emit(t)}onCancel(){this.cancel.emit()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.QS))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-permissions-edit-form","giverPermissions",""]],inputs:{permissions:"permissions",computedPermissions:"computedPermissions",giverPermissions:"giverPermissions",targetType:"targetType",acceptButtonDisabled:"acceptButtonDisabled"},outputs:{save:"save",cancel:"cancel"},features:[e.TTD],attrs:Jc,decls:1,vars:1,consts:function(){let i,t,o,r,a,s,_,l,p,C;return i="Visibilit\xE9",t="Droit de donner des droits de visibilit\xE9",o="Droit d'observation",r="Droit d'\xE9dition",a="Droit d'attacher des sessions officielles",s="Propri\xE9taire",_="Annuler",l="Valider",p="" + "\ufffd0\ufffd" + " peut attacher des sessions officielles \xE0 cet \xE9l\xE9ment qui seront visibles dans son onglet contenu.",C="" + "\ufffd0\ufffd" + " est propri\xE9taire de cet\n et a donc toutes les permissions ci-dessus maximales. Il peut \xE9galement l'effacer.",[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["header",i,"icon","fa fa-eye",3,"collapsible","errorMessage"],["content",""],["header",t,"icon","fa fa-key",3,"collapsible","errorMessage"],["header",o,"icon","fa fa-binoculars",3,"collapsible","errorMessage"],["header",r,"icon","fa fa-pencil-alt",3,"collapsible","errorMessage"],["header",a,"icon","fa fa-paperclip",3,"collapsible","errorMessage"],["header",s,"icon","fa fa-user-tie",3,"collapsible","errorMessage"],[1,"buttons"],["icon","fa fa-times","label",_,"styleClass","alg-button p-button-rounded p-button-danger",1,"button",3,"onClick"],["icon","fa fa-check","label",l,"styleClass","alg-button p-button-rounded",1,"button",3,"disabled","onClick"],["formControlName","canView",3,"collapsed","values"],["formControlName","canGrantView",3,"collapsed","values"],["formControlName","canWatch",3,"collapsed","values"],["formControlName","canEdit",3,"collapsed","values"],["formControlName","canMakeSessionOfficial",3,"collapsed","disabledTooltip"],["label",""],p,["formControlName","isOwner",3,"collapsed","disabledTooltip"],C]},template:function(t,o){1&t&&e.YNc(0,Wc,22,14,"form",0),2&t&&e.Q6J("ngIf",o.form)},dependencies:[d.O5,xn.u,Uc.z,Zc.E,b._Y,b.JJ,b.JL,b.sg,b.u,_e.zx],styles:[".buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:1rem}.button[_ngcontent-%COMP%]:first-child{margin-right:.5rem}"]}),n})();const jc=["currentUserPermissions","","item","","group",""];function e_(n,i){1&n&&e._UZ(0,"alg-error",10)}function t_(n,i){1&n&&e._UZ(0,"alg-loading")}function n_(n,i){1&n&&(e.TgZ(0,"alg-error")(1,"span",13),e.SDv(2,14),e.qZA(),e.TgZ(3,"span"),e.SDv(4,15),e.qZA()())}function o_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"alg-permissions-edit-form",18),e.NdJ("save",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onPermissionsDialogSave(r))})("cancel",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onCancel())}),e.qZA()()()}if(2&n){const t=e.oxw().ngIf,o=e.oxw(2);e.xp6(2),e.Q6J("targetType",o.targetType)("permissions",t.data.granted)("computedPermissions",t.data.computed)("giverPermissions",o.currentUserPermissions)("acceptButtonDisabled",o.updateInProcess)}}function i_(n,i){if(1&n&&(e.ynx(0),e.YNc(1,t_,1,0,"alg-loading",11),e.YNc(2,n_,5,0,"alg-error",11),e.YNc(3,o_,3,5,"div",12),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.isReady)}}function r_(n,i){if(1&n&&(e.YNc(0,i_,4,3,"ng-container",11),e.ALo(1,"async")),2&n){const t=e.oxw();e.Q6J("ngIf",e.lcZ(1,1,t.state$))}}let kn=(()=>{class n{constructor(t,o){this.groupPermissionsService=t,this.actionFeedbackService=o,this.close=new e.vpe,this.params$=new P.t(1),this.state$=this.params$.pipe((0,E.w)(r=>this.groupPermissionsService.getPermissions(r.sourceGroupId,r.groupId,r.itemId)),(0,I.iS)(),(0,x.d)(1)),this.updateInProcess=!1,this.targetType="Users"}ngOnDestroy(){this.params$.complete()}ngOnChanges(){if(!this.group.isUser||this.sourceGroup){if(this.sourceGroup?.isUser)throw new Error("Unexpected: Source group must not be a user");this.targetType=this.group.isUser?"Users":"Groups",this.params$.next({sourceGroupId:this.sourceGroup?.id??this.group.id,groupId:this.group.id,itemId:this.item.id})}}onPermissionsDialogSave(t){if(this.sourceGroup?.isUser)throw new Error("Unexpected: Source group must not be a user");if(this.group.isUser&&!this.sourceGroup)throw new Error("Unexpected: A user group must be provided with source group");this.updateInProcess=!0,this.groupPermissionsService.updatePermissions(this.sourceGroup?.id??this.group.id,this.group.id,this.item.id,t).subscribe({next:()=>{this.updateInProcess=!1,this.actionFeedbackService.success("Permissions successfully updated."),this.closeDialog(!0)},error:o=>{if(this.updateInProcess=!1,this.actionFeedbackService.unexpectedError(),!(o instanceof f.UA))throw o}})}onCancel(){this.closeDialog()}closeDialog(t=!1){this.close.emit(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Dc),e.Y36(Se.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-permissions-edit-dialog","currentUserPermissions","","item","","group",""]],inputs:{currentUserPermissions:"currentUserPermissions",item:"item",group:"group",sourceGroup:"sourceGroup"},outputs:{close:"close"},features:[e.TTD],attrs:jc,decls:12,vars:6,consts:function(){let i,t,o,r;return i="Permission editor",t="User permissions cannot be changed via this page for the moment",o="The permissions cannot be retrieved.",r="Si le probl\xE8me persiste, contactez-nous.",[["styleClass","alg-permissions-edit-dialog",3,"visible","modal","draggable","closable"],[1,"dialog-header"],[1,"dialog-handler"],[1,"fa","fa-lock"],[1,"dialog-title"],i,[1,"dialog-close",3,"click"],["src","assets/images/close.svg","alt","close"],["message",t,4,"ngIf","ngIfElse"],["stateBlock",""],["message",t],[4,"ngIf"],["class","dialog-container",4,"ngIf"],[1,"error-message"],o,r,[1,"dialog-container"],[1,"dialog-content"],[3,"targetType","permissions","computedPermissions","giverPermissions","acceptButtonDisabled","save","cancel"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"p-dialog",0)(1,"p-header")(2,"div",1)(3,"span",2),e._UZ(4,"i",3),e.qZA(),e.TgZ(5,"span",4),e.SDv(6,5),e.qZA(),e.TgZ(7,"span",6),e.NdJ("click",function(){return o.onCancel()}),e._UZ(8,"img",7),e.qZA()()(),e.YNc(9,e_,1,0,"alg-error",8),e.YNc(10,r_,2,3,"ng-template",null,9,e.W1O),e.qZA()),2&t){const r=e.MAs(11);e.Q6J("visible",!0)("modal",!0)("draggable",!1)("closable",!1),e.xp6(9),e.Q6J("ngIf",o.group.isUser&&!o.sourceGroup)("ngIfElse",r)}},dependencies:[d.O5,Pe.h4,ne.q,j.N,It.V,Kc,d.Ov],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.footer[_ngcontent-%COMP%]{display:flex;justify-content:center}.dialog-container[_ngcontent-%COMP%]{max-height:65vh;overflow:auto;display:flex;flex-direction:column;padding-left:3.3333rem;padding-right:1.6667rem}.dialog-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5rem}.dialog-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:transparent}.dialog-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#f1f1f1;border-radius:1rem}.dialog-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#d1d1d1}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative}.dialog-handler[_ngcontent-%COMP%]{display:flex;background-color:#4a90e2;background-color:var(--base-color);border-left:.3rem solid #33649D;border-left:.3rem solid var(--dark-color);width:5rem;height:3rem;border-top-right-radius:1.5rem;border-bottom-right-radius:1.5rem;position:relative;justify-content:flex-end;align-items:center;padding-right:1rem}.dialog-handler[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff;font-size:1.2rem}.dialog-title[_ngcontent-%COMP%]{font-size:2rem;margin-left:1.25rem;color:#4a4a4a;color:var(--dark-text-color);font-family:inherit;font-family:var(--font-family);flex:1}.dialog-close[_ngcontent-%COMP%]{width:4rem;height:4rem;color:#4a90e2;color:var(--base-color);cursor:pointer;position:absolute;right:2rem;top:-.4rem;display:flex;justify-content:center;align-items:center}.error-message[_ngcontent-%COMP%]{margin-right:.3rem}"]}),n})();var Rn=g(3687);const a_=["panel"];function s_(n,i){1&n&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e.qZA())}function c_(n,i){if(1&n&&(e.TgZ(0,"span",13),e._UZ(1,"alg-score-ring",14),e.YNc(2,s_,2,0,"span",15),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("isDark",!0)("currentScore",t.progress.score)("diameter",32),e.xp6(1),e.Q6J("ngIf",t.progress.validated)}}function __(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"span"),e._UZ(2,"i",8),e.TgZ(3,"span",9),e.SDv(4,10),e.qZA(),e.TgZ(5,"span",11),e._uU(6),e.ALo(7,"duration"),e.qZA()(),e.YNc(8,c_,3,4,"span",12),e.BQk()),2&n){const t=e.oxw(2);e.xp6(6),e.Oqu(e.lcZ(7,2,t.progress.timeSpent)),e.xp6(2),e.Q6J("ngIf",!t.progress.validated)}}function l_(n,i){1&n&&(e.TgZ(0,"span",18),e.SDv(1,19),e.qZA())}function g_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"span",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.editPermissions.emit())}),e._UZ(1,"i",21),e.TgZ(2,"span"),e.SDv(3,22),e.qZA()()}}function d_(n,i){if(1&n&&(e.TgZ(0,"div",3)(1,"div",4),e.YNc(2,__,9,4,"ng-container",5),e.YNc(3,l_,2,0,"ng-template",null,6,e.W1O),e.YNc(5,g_,4,0,"span",7),e.qZA()()),2&n){const t=e.MAs(4),o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.progress&&(o.progress.timeSpent>0||o.progress.score>0))("ngIfElse",t),e.xp6(3),e.Q6J("ngIf",o.canEditPermissions)}}let p_=(()=>{class n{constructor(){this.editPermissions=new e.vpe,this.hide=new e.vpe}ngAfterViewInit(){this.progressData&&this.showOverlay()}ngOnChanges(t){t.progressData&&!t.progressData.firstChange&&(this.progress=this.progressData?.progress,this.toggleOverlay())}toggleOverlay(){if(this.panel?.overlayVisible&&this.progressData)return this.reopenOverlay();this.progressData?this.showOverlay():this.hideOverlay()}showOverlay(){if(!this.panel)throw new Error("panel not available");if(!this.progressData)throw new Error("no progress to render");this.panel.show(null,this.progressData.target)}hideOverlay(){if(!this.panel)throw new Error("panel not available");this.panel.hide()}reopenOverlay(){if(!this.panel)throw new Error("no panel available");this.panel.onHide.pipe((0,Zt.g)(0),(0,k.q)(1)).subscribe(()=>this.showOverlay()),this.hideOverlay()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-user-progress-details"]],viewQuery:function(t,o){if(1&t&&e.Gf(a_,5),2&t){let r;e.iGM(r=e.CRH())&&(o.panel=r.first)}},inputs:{progressData:"progressData",canEditPermissions:"canEditPermissions"},outputs:{editPermissions:"editPermissions",hide:"hide"},features:[e.TTD],decls:3,vars:0,consts:function(){let i,t,o;return i="Temps \xE9coul\xE9",t="Not started",o="ACC\xC8S",[["appendTo","body","styleClass","user-progress-overlay-panel","hideTransitionOptions","0s"],["panel",""],["pTemplate",""],[1,"user-progress-info"],[1,"content","validated"],[4,"ngIf","ngIfElse"],["notStarted",""],["class","clickable",3,"click",4,"ngIf"],[1,"fa","fa-clock"],[1,"menu-label"],i,[1,"menu-value"],["class","score",4,"ngIf"],[1,"score"],[3,"isDark","currentScore","diameter"],["class","situation-check",4,"ngIf"],[1,"situation-check"],[1,"fa","fa-check"],[1,"not-started"],t,[1,"clickable",3,"click"],[1,"fa","fa-lock"],o]},template:function(t,o){1&t&&(e.TgZ(0,"p-overlayPanel",0,1),e.YNc(2,d_,6,3,"ng-template",2),e.qZA())},dependencies:[d.O5,Fe.C,Pe.jx,Ve.T,Rn.h],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.user-progress-info[_ngcontent-%COMP%]{background-color:transparent;box-shadow:none;min-height:initial!important}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{background-color:#4a90e2;background-color:var(--base-color);color:#fff;width:100%;border-radius:.5rem;padding:.4167rem;box-shadow:0 .1667rem .3333rem -.1rem #0003,0 .3333rem .4167rem #00000024,0 .1rem 1rem #0000001f;display:flex;flex-direction:column}.user-progress-info[_ngcontent-%COMP%]   .content.validated[_ngcontent-%COMP%]{background-color:#2e5e95;background-color:var(--dark-base-color)}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.4167rem;font-size:1.2rem}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:last-child{border-bottom:none}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.score[_ngcontent-%COMP%]{border-top:.1rem solid #295485;justify-content:center;border-bottom:none}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.score[_ngcontent-%COMP%]   alg-score-ring[_ngcontent-%COMP%]{color:#fff;margin-right:1rem}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.clickable[_ngcontent-%COMP%]{height:2.9167rem;padding-bottom:1rem;padding-top:1rem;border-bottom:.1rem solid #295485;background-color:#4a90e2;background-color:var(--base-color);margin-left:-.4167rem;margin-right:-.4167rem;padding-left:1rem;cursor:pointer}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.clickable[_ngcontent-%COMP%]:hover{background-color:#295485}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.clickable[_ngcontent-%COMP%]:last-child{margin-bottom:-.4167rem;border-bottom:none}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span.clickable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:1rem}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]   span.menu-label[_ngcontent-%COMP%]{flex:1}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]   span.menu-value[_ngcontent-%COMP%]{margin-left:1rem}.user-progress-info[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.4167rem;width:1.6667rem}.not-started[_ngcontent-%COMP%]{min-width:10rem;justify-content:center;padding-bottom:1rem!important}"]}),n})();function m_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",4),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.fetchRows())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function u_(n,i){1&n&&(e.TgZ(0,"div",9),e._UZ(1,"alg-loading"),e.qZA())}function h_(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,14),e.qZA())}function f_(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,15),e.qZA())}function E_(n,i){1&n&&(e.TgZ(0,"span"),e.SDv(1,16),e.qZA())}function T_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"p",10),e.ynx(1,11),e.YNc(2,h_,2,0,"span",12),e.YNc(3,f_,2,0,"span",12),e.YNc(4,E_,2,0,"span",12),e.BQk(),e.TgZ(5,"p-button",13),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.fetchRows())}),e.qZA()()}if(2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("ngSwitch",t.currentFilter),e.xp6(1),e.Q6J("ngSwitchCase","Users"),e.xp6(1),e.Q6J("ngSwitchCase","Teams"),e.xp6(1),e.Q6J("ngSwitchCase","Groups")}}function C_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"th")(1,"div",28)(2,"div",29)(3,"span",30),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(6);return e.KtG(s.navigateToItem(a))}),e._uU(4),e.qZA()()()()}if(2&n){const t=i.$implicit;e.xp6(2),e.s9C("pTooltip",t.title),e.Q6J("showDelay",100),e.xp6(2),e.Oqu(t.title)}}function M_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"th",24)(2,"p-button",25),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.fetchRows())}),e.qZA()(),e.YNc(3,C_,5,3,"th",26),e._UZ(4,"th",27),e.qZA()}if(2&n){const t=i.$implicit;e.xp6(3),e.Q6J("ngForOf",t)}}function S_(n,i){if(1&n&&e._UZ(0,"alg-user-progress",39),2&n){const t=e.oxw().index,o=e.oxw().$implicit;e.Q6J("userProgress",o.data[t])}}function I_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"td",34),e.NdJ("click",function(){const r=e.CHM(t),a=r.index,s=r.$implicit,_=e.MAs(4),l=e.oxw().$implicit,p=e.oxw(5);return e.KtG(p.showProgressDetail(_,l.data[a],l,s))}),e.YNc(1,S_,1,1,"alg-user-progress",35),e.TgZ(2,"div",36),e._UZ(3,"span",37,38),e.qZA()()}if(2&n){const t=i.index,o=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",o.data[t])}}function v_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",31)(2,"span",32),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(5);return e.KtG(s.navigateToGroup(a))}),e._uU(3),e.qZA()(),e.YNc(4,I_,5,1,"td",33),e.qZA()}if(2&n){const t=i.$implicit,o=i.columns;e.xp6(1),e.s9C("pTooltip",t.header),e.Q6J("showDelay",100),e.xp6(2),e.Oqu(t.header),e.xp6(1),e.Q6J("ngForOf",o)}}function P_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",40)(2,"div",41)(3,"button",42),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(6);return e.KtG(r.fetchMoreRows())}),e.qZA()()()()}if(2&n){const t=e.oxw(4).ngIf,o=e.oxw().ngIf;e.xp6(1),e.Q6J("colSpan",o.data.length+1),e.xp6(2),e.Q6J("disabled",t.isFetching)}}function b_(n,i){if(1&n&&(e.YNc(0,P_,4,2,"tr",1),e.ALo(1,"async")),2&n){const t=e.oxw(5);e.Q6J("ngIf","Users"===t.currentFilter&&e.lcZ(1,1,t.datapager.canLoadMore$))}}function A_(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",17)(2,"button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.onCSVExport())}),e.qZA()(),e.TgZ(3,"p-table",19,20),e.YNc(5,M_,5,1,"ng-template",21),e.YNc(6,v_,5,4,"ng-template",22),e.YNc(7,b_,2,3,"ng-template",23),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2).ngIf,o=e.oxw().ngIf,r=e.oxw();e.xp6(2),e.Q6J("disabled",r.isCSVDataFetching),e.xp6(1),e.Q6J("columns",o.data)("value",t.data)("rowTrackBy",r.trackByRow)("loading",t.isFetching)}}function O_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-permissions-edit-dialog",43),e.NdJ("close",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.onDialogClose())}),e.qZA()}if(2&n){const t=e.oxw(4);e.Q6J("currentUserPermissions",t.itemData.item.permissions)("item",t.progressDataDialog.item)("group",t.progressDataDialog.group)("sourceGroup",t.sourceGroup)}}function N_(n,i){if(1&n){const t=e.EpF();e.YNc(0,u_,2,0,"div",5),e.YNc(1,T_,6,4,"p",6),e.TgZ(2,"alg-user-progress-details",7),e.NdJ("hide",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.hideProgressDetail())})("editPermissions",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onAccessPermissions())}),e.qZA(),e.YNc(3,A_,8,5,"ng-container",1),e.YNc(4,O_,1,4,"alg-permissions-edit-dialog",8)}if(2&n){const t=e.oxw().ngIf,o=e.oxw().ngIf,r=e.oxw();e.Q6J("ngIf",t.isFetching&&(!t.data||0===t.data.length)),e.xp6(1),e.Q6J("ngIf",t.isReady&&0===t.data.length),e.xp6(1),e.Q6J("canEditPermissions",r.canAccess)("progressData",r.progressOverlay),e.xp6(1),e.Q6J("ngIf",t.data&&o.data&&t.data.length>0),e.xp6(1),e.Q6J("ngIf",r.isPermissionsDialogOpened&&r.itemData&&r.progressDataDialog&&r.sourceGroup)}}function D_(n,i){if(1&n&&(e.ynx(0),e.YNc(1,m_,1,1,"alg-error",2),e.YNc(2,N_,5,6,"ng-template",null,3,e.W1O),e.BQk()),2&n){const t=i.ngIf,o=e.MAs(3),r=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",t.isError||r.isError)("ngIfElse",o)}}function w_(n,i){if(1&n&&(e.ynx(0),e.YNc(1,D_,4,2,"ng-container",1),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.rows$))}}let y_=(()=>{class n{constructor(t,o,r,a,s,_,l,p){this.getItemChildrenService=t,this.getGroupDescendantsService=o,this.getGroupUsersProgressService=r,this.getGroupChildrenService=a,this.actionFeedbackService=s,this.progressCSVService=_,this.itemRouter=l,this.groupRouter=p,this.defaultFilter="Users",this.currentFilter=this.defaultFilter,this.isPermissionsDialogOpened=!1,this.isCSVDataFetching=!1,this.canAccess=!1,this.itemData$=new P.t(1),this.refresh$=new N.x,this.columns$=this.itemData$.pipe((0,E.w)(C=>this.getColumns(C)),(0,I.iS)({resetter:this.refresh$}),(0,x.d)(1)),this.datapager=new Ec.g({pageSize:25,fetch:(C,h)=>{if(!this.group||!this.itemData)throw new Error("properties are missing");return this.getRowsWithProgress({groupId:this.group.id,itemId:this.itemData.item.id,filter:this.currentFilter,fromId:h?.id,pageSize:C})},onLoadMoreError:()=>{this.actionFeedbackService.error("Could not load more results, are you connected to the internet?")}}),this.rows$=this.datapager.list$}ngOnChanges(t){this.isPermissionsDialogOpened=!1,t.itemData&&this.itemData&&this.itemData$.next(this.itemData),this.group&&(this.fetchRows(),this.sourceGroup=(0,ot.cw)(this.group)),this.canAccess=!!(this.group&&(0,uc.Cr)(this.group)&&this.itemData&&(0,Ie.Vi)(this.itemData.item.permissions))}trackByRow(t,o){return o.id}showProgressDetail(t,o,r,a){this.progressOverlay={target:t,progress:o},this.progressDataDialog={item:{id:a.id,string:{title:r.header}},group:(0,ot.cw)({id:r.id,isUser:"Users"===this.currentFilter})}}hideProgressDetail(){this.progressOverlay=void 0}fetchRows(){this.datapager.reset(),this.refresh$.next(),this.fetchMoreRows()}getProgress({itemId:t,groupId:o,filter:r,pageSize:a,fromId:s}){switch(r){case"Users":return this.getGroupUsersProgressService.getUsersProgress(o,[t],{limit:a,fromId:s});case"Teams":return this.getGroupUsersProgressService.getTeamsProgress(o,[t]);case"Groups":return this.getGroupUsersProgressService.getGroupsProgress(o,[t]).pipe((0,m.U)(_=>_.map(l=>({groupId:l.groupId,itemId:l.itemId,validated:1===l.validationRate,score:l.averageScore,timeSpent:l.avgTimeSpent,hintsRequested:l.avgHintsRequested,submissions:l.avgSubmissions,latestActivityAt:null}))))}}getRows({groupId:t,filter:o,pageSize:r,fromId:a}){switch(o){case"Users":return this.getGroupDescendantsService.getUserDescendants(t,{limit:r,fromId:a}).pipe((0,m.U)(s=>s.map(_=>({id:_.id,value:(0,hc.g)(_.user)}))));case"Teams":return this.getGroupDescendantsService.getTeamDescendants(t).pipe((0,m.U)(s=>s.map(_=>({id:_.id,value:_.name}))));case"Groups":return this.getGroupChildrenService.getGroupChildren(t,[],[],["Team","User"]).pipe((0,m.U)(s=>s.map(_=>({id:_.id,value:_.name}))))}}getRowsWithProgress({itemId:t,groupId:o,filter:r,fromId:a,pageSize:s}){return(0,V.D)({rows:this.getRows({groupId:o,filter:r,pageSize:s,fromId:a}),progress:this.getProgress({itemId:t,groupId:o,filter:r,pageSize:s,fromId:a})}).pipe((0,U.V)(this.columns$.pipe((0,I.RI)())),(0,m.U)(([{rows:_,progress:l},p])=>_.filter(C=>l.find(h=>h.groupId===C.id)).map(C=>({header:C.value,id:C.id,data:p.map(h=>l.find(A=>A.itemId===h.id&&A.groupId===C.id))}))))}onFilterChange(t){t!==this.currentFilter&&(this.currentFilter=t,this.fetchRows())}fetchMoreRows(){this.datapager.load()}onAccessPermissions(){this.hideProgressDetail(),this.isPermissionsDialogOpened=!0}onDialogClose(){this.isPermissionsDialogOpened=!1,this.progressDataDialog=void 0}getCSVDownloadTypeByFilter(){switch(this.currentFilter){case"Groups":return"group";case"Users":return"user";case"Teams":return"team"}}onCSVExport(){if(!this.group||!this.itemData)throw new Error("Unexpected: input component params is required");const t=this.itemData.item.id,o=this.getCSVDownloadTypeByFilter();this.isCSVDataFetching=!0,this.progressCSVService.getCSVData(this.group.id,o,[t]).subscribe({next:r=>{this.isCSVDataFetching=!1,function fc(n,i,t){const o=new Blob(n,{type:t}),r=document.createElement("a");r.href=URL.createObjectURL(o),r.download=i,r.click()}([r],`${t}-${(new Date).toDateString()}.csv`,"text/csv")},error:r=>{if(this.isCSVDataFetching=!1,this.actionFeedbackService.unexpectedError(),!(r instanceof f.UA))throw r}})}navigateToItem(t){if(!this.itemData)throw new Error("Unexpected: Missed input itemData of component");const o=this.itemData.currentResult?.attemptId;if(!o)throw new Error("Unexpected: Children have been loaded, so we are sure this item has an attempt");this.itemRouter.navigateTo({contentType:(0,ee.yq)(this.itemData.item),id:t.id,path:this.itemData.route.path.concat([this.itemData.item.id]),parentAttemptId:o})}navigateToGroup(t){this.groupRouter.navigateTo((0,ot.cw)({id:t.id,isUser:"Users"===this.currentFilter}))}getColumns(t){if(!t.currentResult?.attemptId)throw new Error("unexpected");return this.getItemChildrenService.get(t.item.id,t.currentResult.attemptId).pipe((0,m.U)(o=>[{id:t.item.id,title:t.item.string.title},...o.map(r=>({id:r.id,title:r.string.title}))]))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36($e.q),e.Y36(Tc.h),e.Y36(Mc),e.Y36(Sc.C),e.Y36(Se.C),e.Y36(Ic),e.Y36(ve.h),e.Y36(In.u))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-group-progress-grid"]],inputs:{group:"group",itemData:"itemData"},features:[e.TTD],decls:3,vars:4,consts:function(){let i,t,o,r,a,s;return i="Erreur lors du chargement des donn\xE9es",t="Ce groupe n'a pas d'utilisateur",o="Ce groupe n'a pas d'\xE9quipe",r="Ce groupe n'a pas de sous-groupe",a="Exporter en CSV",s="Load more",[[3,"defaultValue","change"],[4,"ngIf"],["class","dark","message",i,"icon","fa fa-exclamation-triangle",3,"showRefreshButton","refresh",4,"ngIf","ngIfElse"],["noError",""],["message",i,"icon","fa fa-exclamation-triangle",1,"dark",3,"showRefreshButton","refresh"],["class","loader",4,"ngIf"],["class","empty-message",4,"ngIf"],[3,"canEditPermissions","progressData","hide","editPermissions"],[3,"currentUserPermissions","item","group","sourceGroup","close",4,"ngIf"],[1,"loader"],[1,"empty-message"],[3,"ngSwitch"],[4,"ngSwitchCase"],["icon","pi pi-refresh","styleClass","p-button-sm",3,"click"],t,o,r,[1,"operations"],["pButton","","type","button","label",a,"icon","fa fa-file-download",1,"p-button-sm",3,"disabled","click"],[1,"slanted-grid",3,"columns","value","rowTrackBy","loading"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"empty","first","header-refresh"],["icon","pi pi-refresh",3,"click"],[4,"ngFor","ngForOf"],[1,"empty","last"],[1,"slanted-header"],["tooltipPosition","top",1,"slanted-header-content",3,"pTooltip","showDelay"],[1,"slanted-header-link","alg-link","cursor-pointer",3,"click"],["tooltipPosition","left",1,"users",3,"pTooltip","showDelay"],[1,"alg-link","cursor-pointer",3,"click"],["class","cursor-pointer user-progress",3,"click",4,"ngFor","ngForOf"],[1,"cursor-pointer","user-progress",3,"click"],[3,"userProgress",4,"ngIf"],[1,"overlay-target"],[1,"overlay-position"],["overlayTarget",""],[3,"userProgress"],[3,"colSpan"],[1,"text-center"],["pButton","","label",s,1,"p-button-rounded",3,"disabled","click"],[3,"currentUserPermissions","item","group","sourceGroup","close"]]},template:function(t,o){1&t&&(e.TgZ(0,"alg-composition-filter",0),e.NdJ("change",function(a){return o.onFilterChange(a)}),e.qZA(),e.YNc(1,w_,3,3,"ng-container",1),e.ALo(2,"async")),2&t&&(e.Q6J("defaultValue",o.defaultFilter),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.columns$)))},dependencies:[d.sg,d.O5,d.RF,d.n9,Pe.jx,de.iA,ne.q,j.N,vt.u,_e.Hq,_e.zx,vc,Oc,kn,p_,d.Ov],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}[_nghost-%COMP%]   .loader[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}[_nghost-%COMP%]   .empty-message[_ngcontent-%COMP%]{font-style:italic;text-align:center;font-size:medium;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .empty-message[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]{font-family:var(--font-family)}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border:none}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{border:none;height:12.5rem;transform:skew(-45deg);transform-origin:0 100%;position:relative;background-color:#f8f8f8;min-width:3.3333rem;z-index:1}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:nth-child(2){background-color:#4a90e2!important;background-color:var(--base-color)!important}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:nth-child(2)   .slanted-header[_ngcontent-%COMP%]{color:#fff!important}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:nth-child(2)   .slanted-header-link[_ngcontent-%COMP%]{color:#fff}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]   .slanted-header[_ngcontent-%COMP%]{position:absolute;left:0;right:0;bottom:0;transform:translate(50%,50%) skew(45deg) rotate(-45deg);transform-origin:0 50%;text-align:left;padding-left:3rem;color:#8c8c8c;overflow:visible;font-size:1.2rem;z-index:2}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]   .slanted-header-content[_ngcontent-%COMP%]{padding-right:10px;width:15rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:nth-child(odd){background-color:#fff}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]:not(:last-child){border-bottom:.1rem solid #C8C8C8}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th.empty[_ngcontent-%COMP%]{min-width:160px;transform:none}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th.empty.first[_ngcontent-%COMP%]{width:159px}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > th.empty.last[_ngcontent-%COMP%]{width:130px;background-color:transparent}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{background-color:#fff;border:none;padding:0}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > td.users[_ngcontent-%COMP%]{color:#787878;height:4rem;max-height:4rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:1.2rem;width:13.3333rem}[_nghost-%COMP%]   .slanted-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:not(:first-child){border-left:.1rem solid #C8C8C8;border-right:.1rem solid #C8C8C8}[_nghost-%COMP%]   .header-refresh[_ngcontent-%COMP%]{vertical-align:bottom;text-align:right;padding-left:0}.operations[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin-bottom:1rem}.user-progress[_ngcontent-%COMP%]{position:relative}.overlay-target[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:end}.overlay-position[_ngcontent-%COMP%]{width:0;height:100%;margin-left:-2.3rem}"]}),n})();function k_(n,i){if(1&n&&e._UZ(0,"alg-group-progress-grid",4),2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("itemData",o.itemData)("group",t.data)}}function R_(n,i){1&n&&(e.TgZ(0,"div",5),e._UZ(1,"alg-loading",6),e.qZA())}function $_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",7),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function F_(n,i){if(1&n&&(e.ynx(0),e.YNc(1,k_,1,2,"alg-group-progress-grid",1),e.YNc(2,R_,2,0,"div",2),e.YNc(3,$_,1,1,"alg-error",3),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isReady),e.xp6(1),e.Q6J("ngIf",t.isFetching),e.xp6(1),e.Q6J("ngIf",t.isError)}}let L_=(()=>{class n{constructor(t,o){this.groupWatchingService=t,this.getGroupByIdService=o,this.refresh$=new N.x,this.state$=this.groupWatchingService.watchedGroup$.pipe((0,M.h)(ge.K0),(0,E.w)(r=>this.getGroupByIdService.get(r.route.id)),(0,I.iS)({resetter:this.refresh$}))}ngOnDestroy(){this.refresh$.complete()}refresh(){this.refresh$.next()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ye.y),e.Y36(mc.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-chapter-group-progress"]],inputs:{itemData:"itemData"},decls:2,vars:3,consts:function(){let i;return i="Error while loading the group progress",[[4,"ngIf"],[3,"itemData","group",4,"ngIf"],["class","spinner",4,"ngIf"],["message",i,"refreshButtonType","refresh",3,"showRefreshButton","refresh",4,"ngIf"],[3,"itemData","group"],[1,"spinner"],["size","medium"],["message",i,"refreshButtonType","refresh",3,"showRefreshButton","refresh"]]},template:function(t,o){1&t&&(e.YNc(0,F_,4,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.O5,ne.q,j.N,y_,d.Ov],styles:[".spinner[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{padding:1rem;text-align:center}"]}),n})();const G_=c.n_({children:c.IX(c.n_({currentUserPermissions:Ie.Cc,hintsRequested:c.Rx,itemId:c.Z_,latestActivityAt:c.AG(G.QK),noScore:c.O7,score:c.Rx,string:c.n_({languageTag:c.Z_,title:c.AG(c.Z_)}),submissions:c.Rx,timeSpent:c.Rx,type:c.i0("Chapter","Task","Course","Skill"),validated:c.O7})),item:c.n_({hintsRequested:c.Rx,itemId:c.Z_,latestActivityAt:c.AG(G.QK),score:c.Rx,submissions:c.Rx,timeSpent:c.Rx,validated:c.O7})});let U_=(()=>{class n{constructor(t){this.http=t}get(t){return this.http.get(`${w.e.apiUrl}/items/${t}/participant-progress`).pipe((0,u.m)(G_))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Z_(n,i){1&n&&(e.TgZ(0,"div",3),e._UZ(1,"alg-loading",4),e.qZA())}function J_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",5),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function Q_(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"th")(2,"div",14),e._uU(3),e.qZA()(),e.BQk()),2&n){const t=i.$implicit;e.xp6(3),e.hij(" ",t.header," ")}}function B_(n,i){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,Q_,4,1,"ng-container",13),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function V_(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"th",10)(2,"div",11)(3,"p-button",12),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.refresh())}),e.qZA()()()(),e.YNc(4,B_,2,1,"tr",0)}if(2&n){const t=i.$implicit,o=i.$implicit;e.xp6(1),e.Q6J("colSpan",o.length),e.xp6(3),e.Q6J("ngIf",t.length>0)}}const Y_=function(n){return{disabled:n}};function z_(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"a",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.onClick(r))}),e._uU(2),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2).$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngClass",e.VKq(2,Y_,t.id===(null==o.itemData||null==o.itemData.item?null:o.itemData.item.id))),e.xp6(1),e.hij(" ",t.title," ")}}function X_(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.latestActivityAt,"short")," ")}}function q_(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"duration"),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.timeSpent)," ")}}function H_(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"div",19),e._UZ(2,"alg-score-ring",20),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(2),e.Q6J("diameter",42)("currentScore",t.score)}}function W_(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.hij(" ",o[t.field]," ")}}function K_(n,i){if(1&n&&(e.TgZ(0,"td"),e.ynx(1,15),e.YNc(2,z_,3,4,"ng-container",16),e.YNc(3,X_,3,4,"ng-container",16),e.YNc(4,q_,3,3,"ng-container",16),e.YNc(5,H_,3,2,"ng-container",16),e.YNc(6,W_,2,1,"ng-container",17),e.BQk(),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("ngSwitch",t.field),e.xp6(1),e.Q6J("ngSwitchCase","title"),e.xp6(1),e.Q6J("ngSwitchCase","latestActivityAt"),e.xp6(1),e.Q6J("ngSwitchCase","timeSpent"),e.xp6(1),e.Q6J("ngSwitchCase","score")}}function j_(n,i){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,K_,7,5,"td",13),e.qZA()),2&n){const t=i.columns;e.xp6(1),e.Q6J("ngForOf",t)}}function el(n,i){if(1&n&&(e.TgZ(0,"tr")(1,"td")(2,"span"),e.SDv(3,21),e.qZA()()()),2&n){const t=i.$implicit;e.xp6(1),e.uIk("colspan",t.length)}}function tl(n,i){if(1&n&&(e.TgZ(0,"div")(1,"p-table",6),e.YNc(2,V_,5,2,"ng-template",7),e.YNc(3,j_,2,1,"ng-template",8),e.YNc(4,el,4,1,"ng-template",9),e.qZA()()),2&n){const t=e.oxw().ngIf,o=e.oxw();e.xp6(1),e.Q6J("columns",o.columns)("value",t.data)("loading",t.isFetching)}}function nl(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Z_,2,0,"div",1),e.YNc(2,J_,1,1,"alg-error",2),e.YNc(3,tl,5,3,"div",0),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching&&!t.data),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.data)}}let ol=(()=>{class n{constructor(t,o){this.getParticipantProgressService=t,this.itemRouter=o,this.item$=new P.t(1),this.refresh$=new N.x,this.state$=this.item$.pipe((0,E.w)(r=>this.getParticipantProgressService.get(r.id).pipe((0,m.U)(a=>[{id:r.id,type:r.type,title:r.string.title||"",latestActivityAt:a.item.latestActivityAt,timeSpent:a.item.timeSpent,submissions:a.item.submissions,score:a.item.score},...a.children.map(s=>({id:s.itemId,type:s.type,title:s.string.title||"",latestActivityAt:s.latestActivityAt,timeSpent:s.timeSpent,submissions:s.submissions,score:s.score}))]))),(0,I.iS)({resetter:this.refresh$})),this.columns=[{field:"title",header:"Contenu"},{field:"latestActivityAt",header:"Latest activity"},{field:"timeSpent",header:"Temps \xE9coul\xE9"},{field:"submissions",header:"# subm."},{field:"score",header:"Score"}]}ngOnChanges(){this.itemData&&this.item$.next(this.itemData.item)}ngOnDestroy(){this.item$.complete(),this.refresh$.complete()}refresh(){this.refresh$.next()}onClick(t){if(!this.itemData)throw new Error("Unexpected: Missed input itemData of component");if(this.itemData.item.id===t.id)return;const o=this.itemData.currentResult?.attemptId;if(!o)throw new Error("Unexpected: Children have been loaded, so we are sure this item has an attempt");this.itemRouter.navigateTo({contentType:(0,ee.yq)(t),id:t.id,path:this.itemData.route.path.concat([this.itemData.item.id]),parentAttemptId:o})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(U_),e.Y36(ve.h))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-chapter-user-progress"]],inputs:{itemData:"itemData"},features:[e.TTD],decls:2,vars:3,consts:function(){let i,t;return i="Error while loading the user progress",t="There is no progress to report for this group/user.",[[4,"ngIf"],["class","spinner",4,"ngIf"],["message",i,3,"showRefreshButton","refresh",4,"ngIf"],[1,"spinner"],["size","medium"],["message",i,3,"showRefreshButton","refresh"],[1,"alg-table","alg-table","chapter-user-progress",3,"columns","value","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"colSpan"],[1,"header-container","header-refresh"],["icon","pi pi-refresh",3,"click"],[4,"ngFor","ngForOf"],[1,"header-container"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"alg-link",3,"ngClass","click"],[1,"score-ring"],[3,"diameter","currentScore"],t]},template:function(t,o){1&t&&(e.YNc(0,nl,4,3,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.state$))},dependencies:[d.mk,d.sg,d.O5,d.RF,d.n9,d.ED,Fe.C,Pe.jx,de.iA,ne.q,j.N,_e.zx,d.Ov,d.uU,Rn.h],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:1rem}.error[_ngcontent-%COMP%]{margin:0;padding:1rem;color:#4a90e2;color:var(--base-color);font-size:1.6rem;text-align:center}.score-ring[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:.4rem}tr[_ngcontent-%COMP%]:first-child   td[_ngcontent-%COMP%]{background-color:#f6f6f6}"]}),n})();const il=["historyTab"],rl=["chapterGroupProgressTab"],al=["chapterUserProgressTab"],$n=function(n,i){return{active:n,prev:i}};function sl(n,i){if(1&n&&(e.TgZ(0,"a",9,18),e.SDv(2,19),e.qZA()),2&n){const t=e.MAs(1),o=e.oxw(5);e.Q6J("ngClass",e.WLB(2,$n,!!t.isActive,!(null==o.chapterUserProgressTab||!o.chapterUserProgressTab.isActive)))("routerLink","./progress/chapter")}}const cl=function(n){return{active:n}};function _l(n,i){if(1&n&&(e.TgZ(0,"a",9,20),e.SDv(2,21),e.qZA()),2&n){const t=e.MAs(1);e.Q6J("ngClass",e.VKq(2,cl,!(null==t||!t.isActive)))("routerLink","./progress/chapter-user-progress")}}function ll(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",22)(1,"p",23)(2,"span"),e.SDv(3,24),e.qZA(),e._UZ(4,"alg-loading",25),e.TgZ(5,"p-button",26),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.skipSave.emit())}),e.qZA()()()}}function gl(n,i){if(1&n&&e._UZ(0,"alg-item-log-view",27),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)("isTaskReadOnly",t.isTaskReadOnly)}}function dl(n,i){if(1&n&&e._UZ(0,"alg-chapter-group-progress",28),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)}}function pl(n,i){if(1&n&&e._UZ(0,"alg-chapter-user-progress",28),2&n){const t=e.oxw(5);e.Q6J("itemData",t.itemData)}}function ml(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"div",6)(2,"div",7)(3,"nav",8)(4,"a",9,10),e.SDv(6,11),e.qZA(),e.YNc(7,sl,3,5,"a",12),e.YNc(8,_l,3,4,"a",12),e.qZA()()(),e.TgZ(9,"div",13),e.YNc(10,ll,6,0,"div",14),e.YNc(11,gl,1,2,"alg-item-log-view",15),e.TgZ(12,"div",16),e.YNc(13,dl,1,1,"alg-chapter-group-progress",17),e.qZA(),e.YNc(14,pl,1,1,"alg-chapter-user-progress",17),e.qZA(),e.BQk()),2&n){const t=i.ngIf,o=e.MAs(5),r=e.oxw(4);e.xp6(1),e.Q6J("hidden","none"===t),e.xp6(3),e.Q6J("ngClass",e.WLB(9,$n,!!o.isActive,!(null==r.chapterGroupProgressTab||!r.chapterGroupProgressTab.isActive)||!(null==r.chapterUserProgressTab||!r.chapterUserProgressTab.isActive)))("routerLink","./progress/history"),e.xp6(3),e.Q6J("ngIf","withGroupProgress"===t),e.xp6(1),e.Q6J("ngIf","withUserProgress"===t),e.xp6(2),e.Q6J("ngIf",r.savingAnswer),e.xp6(1),e.Q6J("ngIf",!(null==o||!o.isActive)),e.xp6(2),e.Q6J("ngIf",!(null==r.chapterGroupProgressTab||!r.chapterGroupProgressTab.isActive)),e.xp6(1),e.Q6J("ngIf",!(null==r.chapterUserProgressTab||!r.chapterUserProgressTab.isActive))}}function ul(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ml,15,12,"ng-container",5),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.selectors$))}}function hl(n,i){1&n&&(e.TgZ(0,"p",30),e.SDv(1,31),e.qZA())}function fl(n,i){1&n&&(e.TgZ(0,"p",30),e.SDv(1,32),e.qZA())}function El(n,i){if(1&n&&(e.YNc(0,hl,2,0,"p",29),e.YNc(1,fl,2,0,"p",29)),2&n){const t=e.oxw(2).ngrxLet;e.Q6J("ngIf",t),e.xp6(1),e.Q6J("ngIf",!t)}}function Tl(n,i){if(1&n&&(e.TgZ(0,"alg-section",2),e.ALo(1,"async"),e.YNc(2,ul,3,3,"ng-container",3),e.ALo(3,"allowsViewingContent"),e.ALo(4,"allowsWatchingResults"),e.YNc(5,El,2,2,"ng-template",null,4,e.W1O),e.qZA()),2&n){const t=e.MAs(6),o=e.oxw().ngrxLet,r=e.oxw();e.Q6J("label",e.lcZ(1,3,r.sectionLabel$)||""),e.xp6(2),e.Q6J("ngIf",!o&&e.lcZ(3,5,r.itemData.item.permissions)||e.lcZ(4,7,r.itemData.item.permissions))("ngIfElse",t)}}function Cl(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Tl,7,9,"alg-section",1),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.itemData)}}let Ml=(()=>{class n{constructor(t){this.groupWatchingService=t,this.isTaskReadOnly=!1,this.savingAnswer=!1,this.skipSave=new e.vpe,this.itemData$=new P.t,this.selectors$=(0,O.a)([this.itemData$,this.groupWatchingService.watchedGroup$]).pipe((0,m.U)(([o,r])=>!r||r.route.isUser?(0,ee.Tx)(o.item)?"none":"withUserProgress":"withGroupProgress")),this.sectionLabel$=this.groupWatchingService.watchedGroup$.pipe((0,m.U)(o=>o?"Situation of " + o.name + "":"Your situation")),this.isWatching$=this.groupWatchingService.isWatching$}ngOnChanges(){this.itemData&&this.itemData$.next(this.itemData)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ye.y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-progress"]],viewQuery:function(t,o){if(1&t&&(e.Gf(il,5),e.Gf(rl,5),e.Gf(al,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.historyTab=r.first),e.iGM(r=e.CRH())&&(o.chapterGroupProgressTab=r.first),e.iGM(r=e.CRH())&&(o.chapterUserProgressTab=r.first)}},inputs:{itemData:"itemData",isTaskReadOnly:"isTaskReadOnly",savingAnswer:"savingAnswer"},outputs:{skipSave:"skipSave"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,t,o,r,a,s,_;return i=" History ",t=" Chapter view ",o=" Chapter view ",r="Saving answer before loading submission...",a="Skip",s="You are not allowed to view the progress of other users on this content.",_="You are not allowed to view this content.",[[4,"ngrxLet"],["icon","fa fa-list",3,"label",4,"ngIf"],["icon","fa fa-list",3,"label"],[4,"ngIf","ngIfElse"],["unallowed",""],[4,"ngIf"],[3,"hidden"],[1,"selection-center"],[1,"tab-rounded"],["routerLinkActive","",1,"tab-rounded-item",3,"ngClass","routerLink"],["historyTab","routerLinkActive"],i,["class","tab-rounded-item","routerLinkActive","",3,"ngClass","routerLink",4,"ngIf"],[1,"container"],["class","save-answer-loader",4,"ngIf"],[3,"itemData","isTaskReadOnly",4,"ngIf"],[1,"chapter-group-progress"],[3,"itemData",4,"ngIf"],["chapterGroupProgressTab","routerLinkActive"],t,["chapterUserProgressTab","routerLinkActive"],o,[1,"save-answer-loader"],[1,"save-answer-loader-message"],r,["size","medium"],["type","button","label",a,3,"click"],[3,"itemData","isTaskReadOnly"],[3,"itemData"],["class","not-allow-caption",4,"ngIf"],[1,"not-allow-caption"],s,_]},template:function(t,o){1&t&&e.YNc(0,Cl,2,1,"ng-container",0),2&t&&e.Q6J("ngrxLet",o.isWatching$)},dependencies:[d.mk,d.O5,Y.yS,Y.Od,ue.e,j.N,Xe.eJ,_e.zx,pc,L_,ol,d.Ov,v.vJ,ie.Wk],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.selection-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:56rem;max-width:56rem;margin-left:auto;margin-right:auto}.chapter-group-progress[_ngcontent-%COMP%]{margin-top:2rem}.not-allow-caption[_ngcontent-%COMP%]{margin:0}.container[_ngcontent-%COMP%]{position:relative}.save-answer-loader[_ngcontent-%COMP%]{background-color:#4a4a4ab3;position:absolute;z-index:10;top:0;left:0;height:100%;width:100%;text-align:center}.save-answer-loader-message[_ngcontent-%COMP%]{margin:0;margin-top:5rem;padding:.5rem 2rem;background:#F1F2F7;background:var(--base-bk-color);border-radius:.5rem;font-size:1.25em;display:inline-flex;align-items:center;justify-content:center}"]}),n})();var Sl=g(6953);const Il=["answer",""];function vl(n,i){1&n&&e._UZ(0,"alg-loading",5)}function Pl(n,i){1&n&&e._UZ(0,"alg-error",6)}function bl(n,i){if(1&n&&(e.tHW(0,8,1),e._UZ(1,"span",11),e.N_p()),2&n){const t=e.oxw(3);e.xp6(1),e.pQV(t.answer.score),e.QtT(0)}}function Al(n,i){if(1&n&&(e.TgZ(0,"div",7),e.tHW(1,8),e._UZ(2,"a",9),e.ALo(3,"async"),e.ALo(4,"userCaption"),e.ALo(5,"date"),e.YNc(6,bl,2,1,"span",10),e.N_p(),e.qZA()),2&n){const t=i.ngIf,o=e.oxw(2);e.xp6(2),e.Q6J("routerLink",e.lcZ(3,4,o.groupLink$)),e.xp6(4),e.Q6J("ngIf",o.answer.score||0===o.answer.score),e.pQV(e.lcZ(4,6,t))(e.xi3(5,8,o.answer.createdAt,"short")),e.QtT(1)}}function Ol(n,i){if(1&n&&(e.TgZ(0,"div",1),e.YNc(1,vl,1,0,"alg-loading",2),e.YNc(2,Pl,1,0,"alg-error",3),e.YNc(3,Al,7,11,"div",4),e.qZA()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isFetching&&!t.data),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data)}}let Nl=(()=>{class n{constructor(t,o){this.groupRouter=t,this.getUserService=o,this.answer$=new P.t(1),this.author$=this.answer$.pipe((0,E.w)(r=>this.getUserService.getForId(r.authorId)),(0,I.iS)(),(0,x.d)(1)),this.groupLink$=this.author$.pipe((0,I.RI)(),(0,m.U)(r=>this.groupRouter.urlArray((0,ot.p6)({id:r.groupId,isUser:!0},[]))))}ngOnChanges(t){t.answer&&this.answer$.next(this.answer)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(In.u),e.Y36(Sl.u))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-answer-author-indicator","answer",""]],inputs:{answer:"answer"},features:[e.TTD],attrs:Il,decls:2,vars:3,consts:function(){let i,t;return i="Erreur lors du chargement des informations de l'auteur",t=" Submitted by " + "\ufffd#2\ufffd" + "" + "\ufffd0\ufffd" + "" + "\ufffd/#2\ufffd" + " on " + "\ufffd1\ufffd" + ". " + "\ufffd*6:1\ufffd\ufffd#1:1\ufffd" + "Score: " + "\ufffd0:1\ufffd" + " points." + "\ufffd/#1:1\ufffd\ufffd/*6:1\ufffd" + "",[["class","container",4,"ngIf"],[1,"container"],["size","small",4,"ngIf"],["message",i,4,"ngIf"],["class","content",4,"ngIf"],["size","small"],["message",i],[1,"content"],t,[1,"alg-link","links",3,"routerLink"],["class","score",4,"ngIf"],[1,"score"]]},template:function(t,o){1&t&&(e.YNc(0,Ol,4,3,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.author$))},dependencies:[d.O5,Y.yS,ne.q,j.N,d.Ov,d.uU,Mn.u],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-section[_ngcontent-%COMP%]{background-color:#dfe7f4;background-color:var(--section-color)}.line-clamp-2[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@supports (display: -webkit-box){.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;white-space:normal}}.container[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;flex-direction:column;justify-content:center;color:#787878;color:var(--base-text-color);background-color:#dfe7f4;background-color:var(--section-color);border-radius:.5rem}.content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem 1rem}.links[_ngcontent-%COMP%], .score[_ngcontent-%COMP%]{margin:0 .4rem;color:#4a90e2;color:var(--base-color)}.links[_ngcontent-%COMP%]:hover, .score[_ngcontent-%COMP%]:hover{color:#779cca;color:var(--base-color-hover)}"]}),n})();var Dl=g(5498),wl=g(4646);const xl=function(){return{true:"can",other:"can't"}},Pt=function(){return{Skill:"skill",other:"activity"}};function yl(n,i){if(1&n&&(e.ynx(0,6),e.SDv(1,7),e.ALo(2,"i18nSelect"),e.ALo(3,"allowsViewingContent"),e.ALo(4,"i18nSelect"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(4),e.pQV(t.watchedGroup.name)(e.xi3(2,3,e.lcZ(3,6,t.watchedGroupPermissions).toString(),e.DdM(11,xl)))(e.xi3(4,8,t.itemData.item.type,e.DdM(12,Pt))),e.QtT(1)}}function kl(n,i){if(1&n&&(e.ynx(0),e.SDv(1,8),e.ALo(2,"i18nSelect"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(2),e.pQV(e.xi3(2,1,t.itemData.item.type,e.DdM(4,Pt))),e.QtT(1)}}const Fn=function(){return{true:"user",other:"group"}};function Rl(n,i){if(1&n&&(e.ynx(0),e.SDv(1,9),e.ALo(2,"i18nSelect"),e.BQk()),2&n){const t=e.oxw(4);e.xp6(2),e.pQV(e.xi3(2,1,t.watchedGroup.route.isUser.toString(),e.DdM(4,Fn))),e.QtT(1)}}const $l=function(){return["Skill","Chapter"]},Fl=function(){return{true:"list its content.",other:"view its content."}};function Ll(n,i){if(1&n&&(e.ynx(0),e.SDv(1,10),e.ALo(2,"i18nSelect"),e.ALo(3,"i18nSelect"),e.ALo(4,"i18nSelect"),e.BQk()),2&n){const t=e.oxw(4);e.xp6(4),e.pQV(e.xi3(2,3,t.watchedGroup.route.isUser.toString(),e.DdM(12,Fn)))(e.xi3(3,6,t.itemData.item.type,e.DdM(13,Pt)))(e.xi3(4,9,e.DdM(14,$l).includes(t.itemData.item.type).toString(),e.DdM(15,Fl))),e.QtT(1)}}function Gl(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Rl,3,5,"ng-container",0),e.ALo(2,"allowsViewingInfo"),e.YNc(3,Ll,5,16,"ng-container",0),e.ALo(4,"allowsViewingInfo"),e.ALo(5,"allowsViewingContent"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!e.lcZ(2,2,t.watchedGroupPermissions)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.watchedGroupPermissions)&&!e.lcZ(5,6,t.watchedGroupPermissions))}}function Ul(n,i){1&n&&(e.ynx(0),e.SDv(1,11),e.BQk())}function Zl(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-progress-select",16),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw(4);return e.KtG(a.watchedGroupPermissions.canView=r)}),e.qZA()}if(2&n){const t=e.oxw(4);e.Q6J("collapsed",!0)("ngModel",t.watchedGroupPermissions.canView)("values",t.canViewValues)}}function Jl(n,i){1&n&&(e.TgZ(0,"div",17),e.SDv(1,18),e.qZA())}function Ql(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-permissions-edit-dialog",23),e.NdJ("close",function(r){e.CHM(t);const a=e.oxw(5);return e.KtG(a.closePermissionsDialog(r))}),e.qZA()}if(2&n){const t=e.oxw(5);e.Q6J("currentUserPermissions",t.itemData.item.permissions)("item",t.itemData.item)("group",t.watchedGroup.route)}}const zl=function(){return{content:"You are not allowed to give permissions on this content",group:"You are not allowed to give permissions to this group",contentGroup:"You are not allowed to give permissions on this content and to this group"}};function Xl(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",19)(2,"span",20),e.ALo(3,"i18nSelect"),e.TgZ(4,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.openPermissionsDialog())}),e.qZA()()(),e.YNc(5,Ql,1,3,"alg-permissions-edit-dialog",22),e.BQk()}if(2&n){const t=e.oxw(4);e.xp6(2),e.Q6J("pTooltip",e.xi3(3,4,t.lockEdit,e.DdM(7,zl)))("tooltipDisabled",!t.lockEdit),e.xp6(2),e.Q6J("disabled",t.lockEdit),e.xp6(1),e.Q6J("ngIf",t.isPermissionsDialogOpened)}}function ql(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"div",12)(2,"alg-section-header",13),e.YNc(3,Zl,1,3,"ng-template",null,14,e.W1O),e.qZA()(),e.YNc(5,Jl,2,0,"div",15),e.YNc(6,Xl,6,8,"ng-container",0),e.BQk()),2&n){const t=e.oxw(3);e.xp6(5),e.Q6J("ngIf",!t.watchedGroup.route.isUser),e.xp6(1),e.Q6J("ngIf",null==t.itemData||null==t.itemData.item?null:t.itemData.item.permissions)}}function Hl(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"alg-section-paragraph",1),e.YNc(2,yl,5,13,"ng-container",2),e.YNc(3,kl,3,5,"ng-template",null,3,e.W1O),e.YNc(5,Gl,6,8,"ng-container",4),e.YNc(6,Ul,2,0,"ng-template",null,5,e.W1O),e.YNc(8,ql,7,2,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=e.MAs(4),o=e.MAs(7),r=e.oxw(2);e.xp6(1),e.Q6J("theme","warning")("collapsible",!0)("collapsed",!0),e.xp6(1),e.Q6J("ngIf",r.watchedGroupPermissions)("ngIfElse",t),e.xp6(3),e.Q6J("ngIf",r.watchedGroupPermissions)("ngIfElse",o),e.xp6(3),e.Q6J("ngIf",r.watchedGroupPermissions)}}function Wl(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Hl,9,8,"ng-container",0),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.itemData)}}let Kl=(()=>{class n{constructor(){this.changed=new e.vpe,this.canViewValues=wn("Groups"),this.isPermissionsDialogOpened=!1}ngOnChanges(){this.watchedGroupPermissions=this.itemData?.item?.watchedGroup?.permissions?{...this.itemData.item.watchedGroup.permissions,canMakeSessionOfficial:!1}:void 0;const t=this.watchedGroup?.currentUserCanGrantAccess,o=this.itemData&&(0,Ie.Vi)(this.itemData.item.permissions);this.lockEdit=t&&!o?"content":!t&&o?"group":t||o?void 0:"contentGroup"}openPermissionsDialog(){this.isPermissionsDialogOpened=!0}closePermissionsDialog(t){this.isPermissionsDialogOpened=!1,t&&this.changed.emit()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-permissions"]],inputs:{itemData:"itemData",watchedGroup:"watchedGroup"},outputs:{changed:"changed"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,t,o,r,a,s,_,l;return i=" \xAB" + "\ufffd0\ufffd" + "\xBB " + "\ufffd1\ufffd" + " access this " + "\ufffd2\ufffd" + " ",t="You cannot watch this " + "\ufffd0\ufffd" + " ",o=" The " + "\ufffd0\ufffd" + " cannot currently view this content. ",r=" The " + "\ufffd0\ufffd" + " can list this " + "\ufffd1\ufffd" + " but cannot " + "\ufffd2\ufffd" + " ",a=" You cannot view the results or submissions of the group ",s="Visibilit\xE9",_=" Note that some subgroups or users of the groups may have higher permissions. ",l="Edit permissions",[[4,"ngIf"],["icon","fa fa-flag",3,"theme","collapsible","collapsed"],["label-section","",4,"ngIf","ngIfElse"],["noPermissionToWatchLabel",""],[4,"ngIf","ngIfElse"],["noPermissionToWatchContent",""],["label-section",""],i,t,o,r,a,[1,"permission-indicator-section"],["title",s,"icon","fa fa-eye","theme","warning"],["content",""],["class","text-center note-caption",4,"ngIf"],["theme","warning",3,"collapsed","ngModel","values","ngModelChange"],[1,"text-center","note-caption"],_,[1,"give-access-button"],["tooltipPosition","bottom","tooltipStyleClass","permissions-dialog",3,"pTooltip","tooltipDisabled"],["pButton","","type","button","label",l,1,"alg-button","p-button-rounded-full","p-button-warning",3,"disabled","click"],[3,"currentUserPermissions","item","group","close",4,"ngIf"],[3,"currentUserPermissions","item","group","close"]]},template:function(t,o){1&t&&e.YNc(0,Wl,2,1,"ng-container",0),2&t&&e.Q6J("ngIf",o.watchedGroup)},dependencies:[d.O5,Dl.s,xn.u,wl.I,b.JJ,b.On,vt.u,_e.Hq,kn,d._K,v.vJ,v.CG],styles:[".permission-indicator-section[_ngcontent-%COMP%]{margin-top:2rem}.give-access-button[_ngcontent-%COMP%]{margin-top:2rem;display:flex;justify-content:center}.note-caption[_ngcontent-%COMP%]{font-size:1rem}"]}),n})(),jl=(()=>{class n{constructor(t){this.http=t}create(t,o){return this.http.post(`${w.e.apiUrl}/items/${t}/prerequisites/${o}`,{grant_content_view:!0}).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),eg=(()=>{class n{constructor(t){this.http=t}delete(t,o){return this.http.delete(`${w.e.apiUrl}/items/${t}/prerequisites/${o}`).pipe((0,m.U)(ce.IZ))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var at=g(1432),Ln=g(473),Gn=g(3691);let tg=(()=>{class n{constructor(t){this.searchItemService=t,this.allowSkills=!1,this.addedIds=[],this.contentAdded=new e.vpe,this.allowedNewItemTypes=[],this.searchFunction=o=>this.searchItemService.search(o,(0,at.K)(this.allowSkills).map(r=>r.type))}ngOnChanges(t){this.allowedNewItemTypes=(0,at.K)(this.allowSkills)}addDependency(t){this.contentAdded.emit(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Ln.b))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-add-dependency"]],inputs:{allowSkills:"allowSkills",addedIds:"addedIds"},outputs:{contentAdded:"contentAdded"},features:[e.TTD],decls:2,vars:5,consts:function(){let i,t;return i="Create a new dependency",t="Enter a title to create a new dependency",[["icon","pi pi-plus","label",i],["inputCreatePlaceholder",t,3,"allowedTypesForNewContent","searchFunction","addedIds","loading","showCreateUI","contentAdded"]]},template:function(t,o){1&t&&(e.TgZ(0,"alg-section",0)(1,"alg-add-content",1),e.NdJ("contentAdded",function(a){return o.addDependency(a)}),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("allowedTypesForNewContent",o.allowedNewItemTypes)("searchFunction",o.searchFunction)("addedIds",o.addedIds)("loading",!1)("showCreateUI",!1))},dependencies:[ue.e,Gn.R]}),n})();const ng=["op"],og=["contentRef"];function ig(n,i){1&n&&e._UZ(0,"alg-loading",9)}function rg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-error",10),e.NdJ("refresh",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.refresh())}),e.qZA()}2&n&&e.Q6J("showRefreshButton",!0)}function ag(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li",17),e.NdJ("mouseleave",function(r){e.CHM(t);const a=e.oxw(6);return e.KtG(a.onMouseLeave(r))}),e.TgZ(1,"a",18,19),e.NdJ("mouseenter",function(r){const a=e.CHM(t),s=a.$implicit,_=a.index,l=e.oxw(6);return e.KtG(l.onMouseEnter(r,s.id,_))}),e.ALo(3,"rawItemLink"),e._uU(4),e.qZA(),e.TgZ(5,"button",20),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(6);return e.KtG(s.onRemove(a.id))}),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.Q6J("routerLink",e.lcZ(3,2,t)),e.xp6(3),e.hij(" ",t.string.title," ")}}function sg(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"p",11),e.tHW(2,12),e._UZ(3,"strong"),e.N_p(),e.qZA(),e.TgZ(4,"ul",13),e.YNc(5,ag,6,4,"li",14),e.qZA(),e.TgZ(6,"p",15),e.SDv(7,16),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).ngIf;e.xp6(5),e.Q6J("ngForOf",t.data)}}function cg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,sg,8,1,"ng-container",2),e.BQk()),2&n){const t=e.oxw().ngIf;e.oxw(2);const o=e.MAs(6);e.xp6(1),e.Q6J("ngIf",t.data.length>0)("ngIfElse",o)}}function _g(n,i){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,ig,1,0,"alg-loading",7),e.YNc(2,rg,1,1,"alg-error",8),e.YNc(3,cg,2,2,"ng-container",0),e.qZA()),2&n){const t=i.ngIf,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isFetching||o.changeInProgress),e.xp6(1),e.Q6J("ngIf",t.isError),e.xp6(1),e.Q6J("ngIf",!t.isFetching&&!o.changeInProgress&&t.data)}}function lg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,_g,4,3,"div",0),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.state$))}}function gg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-add-dependency",22),e.NdJ("contentAdded",function(r){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onAdd(r))}),e.qZA()}if(2&n){const t=e.oxw().ngIf;e.Q6J("addedIds",t)}}const Un=function(){return["all","all_with_grant"]};function dg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,gg,1,1,"alg-add-dependency",21),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.DdM(1,Un).includes(t.itemData.item.permissions.canEdit))}}const pg=function(){return{Skill:"skill",other:"activity"}},mg=function(){return{Skill:"skill",Chapter:"chapter",other:"activity"}};function ug(n,i){if(1&n&&(e.TgZ(0,"p",23),e.SDv(1,24),e.ALo(2,"i18nSelect"),e.ALo(3,"i18nSelect"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.pQV(e.xi3(2,2,t.itemData.item.type,e.DdM(8,pg)))(e.xi3(3,5,t.itemData.item.type,e.DdM(9,mg))),e.QtT(1)}}function hg(n,i){1&n&&(e.TgZ(0,"div",23),e.SDv(1,25),e.qZA())}function fg(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"alg-path-suggestion",26),e.NdJ("mouseleave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.closeOverlay())}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2);let o;e.xp6(1),e.Q6J("itemId",null==(o=e.lcZ(2,1,t.showOverlay$))?null:o.itemId)}}function Eg(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"alg-section",1),e.YNc(2,lg,3,3,"ng-container",2),e.qZA(),e.YNc(3,dg,2,2,"ng-container",0),e.ALo(4,"async"),e.YNc(5,ug,4,10,"ng-template",null,3,e.W1O),e.YNc(7,hg,2,0,"ng-template",null,4,e.W1O),e.TgZ(9,"p-overlayPanel",5,6),e.YNc(11,fg,3,3,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=e.MAs(8),o=e.MAs(10),r=e.oxw();e.xp6(2),e.Q6J("ngIf",e.DdM(6,Un).includes(r.itemData.item.permissions.canEdit))("ngIfElse",t),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,4,r.addedIds$)),e.xp6(8),e.Q6J("ngIf",o.overlayVisible)}}let Tg=(()=>{class n{constructor(t,o,r,a){this.getItemPrerequisitesService=t,this.addItemPrerequisiteService=o,this.removeItemPrerequisiteService=r,this.actionFeedbackService=a,this.itemId$=new P.t(1),this.refresh$=new N.x,this.state$=this.itemId$.pipe((0,E.w)(s=>this.getItemPrerequisitesService.get(s)),(0,m.U)(s=>s.filter(_=>_.dependencyGrantContentView)),(0,I.iS)({resetter:this.refresh$}),(0,pt.B)()),this.addedIds$=this.state$.pipe((0,I.RI)(),(0,m.U)(s=>s.map(_=>_.id))),this.showOverlaySubject$=new on.X(void 0),this.showOverlay$=(0,le.T)(this.showOverlaySubject$.pipe((0,rn.b)(750)),this.showOverlaySubject$.pipe((0,M.h)(s=>!s))).pipe((0,y.x)(),(0,x.d)(1)),this.showOverlaySubscription=this.showOverlay$.subscribe(s=>{s?this.op?.toggle(s.event,s.target):this.op?.hide()}),this.changeInProgress=!1}ngOnChanges(){this.itemData&&this.itemId$.next(this.itemData.item.id)}ngOnDestroy(){this.itemId$.complete(),this.showOverlaySubject$.complete(),this.refresh$.complete(),this.showOverlaySubscription.unsubscribe()}onMouseEnter(t,o,r){const a=this.contentRef?.get(r);if(!a)throw new Error("Unexpected: Target is not found");this.showOverlaySubject$.next({event:t,itemId:o,target:a.nativeElement})}onMouseLeave(t){(0,an.j)(t)&&this.closeOverlay()}closeOverlay(){this.showOverlaySubject$.next(void 0)}refresh(){this.refresh$.next()}onAdd(t){if(!t.id)throw new Error("Unexpected: item id is missing");const o=this.itemData?.item.id;if(!o)throw new Error("Unexpected: dependent item id is missing");this.changeInProgress=!0,this.addItemPrerequisiteService.create(o,t.id).subscribe({next:()=>{this.changeInProgress=!1,this.actionFeedbackService.success("The new dependency has been added"),this.refresh()},error:r=>{if(this.changeInProgress=!1,this.actionFeedbackService.unexpectedError(),!(r instanceof f.UA))throw r}})}onRemove(t){const o=this.itemData?.item.id;if(!o)throw new Error("Unexpected: Missed dependent item id");this.changeInProgress=!0,this.removeItemPrerequisiteService.delete(o,t).subscribe({next:()=>{this.changeInProgress=!1,this.actionFeedbackService.success("The dependency has been removed"),this.refresh()},error:r=>{if(this.changeInProgress=!1,this.actionFeedbackService.unexpectedError(),!(r instanceof f.UA))throw r}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(sn),e.Y36(jl),e.Y36(eg),e.Y36(Se.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-dependencies"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ng,5),e.Gf(og,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.op=r.first),e.iGM(r=e.CRH())&&(o.contentRef=r)}},inputs:{itemData:"itemData"},features:[e.TTD],decls:1,vars:1,consts:function(){let i,t,o,r,a,s;return i="Prerequisites",t="Unable to load the dependencies",o=" Users will unlock access to this content if they solve " + "\ufffd#3\ufffd" + "at least one" + "\ufffd/#3\ufffd" + " of the content below. ",r=" Users will see the list of dependencies on the \"content\" tab and only when they do not have access to the content yet. They will only see dependencies they are allowed to view already. ",a=" There are no prerequisites for this " + "\ufffd0\ufffd" + ". Users will have access to it only if they are given access manually or if the \"default access\" is configured as \"open\" in its parent " + "\ufffd1\ufffd" + ". ",s="You are not allowed to view dependencies for this content",[[4,"ngIf"],["icon","fa fa-list","label",i],[4,"ngIf","ngIfElse"],["emptyList",""],["notAllowToView",""],["styleClass","alg-path-suggestion-overlay"],["op",""],["size","medium",4,"ngIf"],["class","dark","icon","fa fa-exclamation-triangle","message",t,3,"showRefreshButton","refresh",4,"ngIf"],["size","medium"],["icon","fa fa-exclamation-triangle","message",t,1,"dark",3,"showRefreshButton","refresh"],[1,"explanation"],o,[1,"list"],["class","list-item",3,"mouseleave",4,"ngFor","ngForOf"],[1,"note-caption"],r,[1,"list-item",3,"mouseleave"],[1,"alg-link",3,"routerLink","mouseenter"],["contentRef",""],["pButton","","type","button","icon","fa fa-trash-alt",1,"p-button-text",3,"click"],[3,"addedIds","contentAdded",4,"ngIf"],[3,"addedIds","contentAdded"],[1,"alg-error-text"],a,s,[3,"itemId","mouseleave"]]},template:function(t,o){1&t&&e.YNc(0,Eg,12,7,"ng-container",0),2&t&&e.Q6J("ngIf",o.itemData)},dependencies:[d.sg,d.O5,Y.yS,ue.e,ne.q,j.N,cn.a,_e.Hq,Ve.T,tg,d.Ov,d._K,Et.M],styles:[".explanation[_ngcontent-%COMP%]{margin:0;font-size:1.4rem}.note-caption[_ngcontent-%COMP%]{margin:1rem 0;font-size:1rem;text-align:center}.list[_ngcontent-%COMP%]{list-style-type:none;margin:1rem 0 0;padding:0}.list-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:4rem;border-bottom:.1rem solid var(--light-border-color)}"]}),n})();const Cg=["progressTab"];function Mg(n,i){if(1&n&&e._UZ(0,"alg-item-header",23),2&n){const t=e.oxw(2).ngIf;e.Q6J("itemData",t)}}function Sg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-access-code-view",24),e.NdJ("groupJoined",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.reloadItem())}),e.qZA()}if(2&n){const t=e.oxw(2).ngIf;e.Q6J("itemData",t)}}function Ig(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-item-permissions",25),e.NdJ("changed",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.reloadItem())}),e.qZA()}if(2&n){const t=i.ngIf,o=e.oxw(2).ngIf;e.Q6J("itemData",o)("watchedGroup",t)}}function vg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"a",27),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(5);return e.KtG(s.setTaskTabActive(a))}),e._uU(1),e.qZA()}if(2&n){const t=i.$implicit;e.oxw(2);const o=e.MAs(11),r=e.oxw(3);e.ekj("active",o.isActive&&t.view===r.taskView),e.Q6J("routerLink","./"),e.xp6(1),e.hij(" ",t.name," ")}}function Pg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,vg,2,4,"a",26),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}function bg(n,i){if(1&n&&e._UZ(0,"alg-error",28),2&n){const t=e.oxw(4);e.Q6J("message",t.errorMessage)}}function Ag(n,i){1&n&&(e.ynx(0),e.SDv(1,31),e.BQk())}function Og(n,i){if(1&n&&(e.ynx(0),e.tHW(1,32),e._UZ(2,"a",33),e.N_p(),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(2),e.Q6J("routerLink",t)}}function Ng(n,i){if(1&n&&(e.TgZ(0,"alg-error"),e.YNc(1,Ag,2,0,"ng-container",29),e.ALo(2,"async"),e.YNc(3,Og,3,1,"ng-template",null,30,e.W1O),e.qZA()),2&n){const t=e.MAs(4),o=e.oxw(5);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.taskReadOnly$))("ngIfElse",t)}}function Dg(n,i){if(1&n&&e._UZ(0,"alg-answer-author-indicator",38),2&n){const t=e.oxw(2).ngIf;e.Q6J("answer",t.formerAnswer)}}function wg(n,i){if(1&n&&(e.TgZ(0,"div",36),e.YNc(1,Dg,1,1,"alg-answer-author-indicator",37),e.qZA()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",t.formerAnswer)}}function xg(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.YNc(1,wg,2,1,"div",34),e.TgZ(2,"alg-item-content",35),e.NdJ("taskViewChange",function(r){e.CHM(t);const a=e.oxw(5);return e.KtG(a.taskView=r)})("taskTabsChange",function(r){e.CHM(t);const a=e.oxw(5);return e.KtG(a.setTaskTabs(r))})("scoreChange",function(r){e.CHM(t);const a=e.oxw(5);return e.KtG(a.patchStateWithScore(r))})("skipSave",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.skipBeforeUnload())})("refresh",function(){e.CHM(t);const r=e.oxw(5);return e.KtG(r.reloadItem())}),e.ALo(3,"async"),e.qZA(),e.BQk()}if(2&n){const t=i.ngIf;e.oxw(2);const o=e.MAs(11),r=e.MAs(14),a=e.oxw().ngIf,s=e.oxw(2);let _;e.xp6(1),e.Q6J("ngIf",t.readOnly&&o.isActive),e.xp6(1),e.Q6J("hidden",!o.isActive&&!r.isActive)("itemData",a)("taskConfig",t)("savingAnswer",null!==(_=e.lcZ(3,7,s.savingAnswer$))&&void 0!==_&&_)("taskView",s.taskView)("editModeEnabled",r.isActive)}}function yg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ng,5,4,"alg-error",0),e.ALo(2,"async"),e.YNc(3,xg,4,9,"ng-container",0),e.ALo(4,"async"),e.BQk()),2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.answerFallbackLink$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.taskConfig$))}}function kg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"alg-item-progress",39),e.NdJ("skipSave",function(){e.CHM(t);const r=e.oxw(4);return e.KtG(r.skipBeforeUnload())}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&n){const t=e.oxw(2).ngIf,o=e.oxw(2);let r,a;e.Q6J("itemData",t)("isTaskReadOnly",null!==(r=e.lcZ(1,3,o.taskReadOnly$))&&void 0!==r&&r)("savingAnswer",null!==(a=e.lcZ(2,5,o.savingAnswer$))&&void 0!==a&&a)}}function Rg(n,i){if(1&n&&(e.ynx(0),e._UZ(1,"alg-item-dependencies",23),e.BQk()),2&n){const t=e.oxw(2).ngIf;e.xp6(1),e.Q6J("itemData",t)}}function $g(n,i){if(1&n&&(e.ynx(0),e._UZ(1,"alg-item-edit-wrapper",23),e.BQk()),2&n){const t=e.oxw(2).ngIf;e.xp6(1),e.Q6J("itemData",t)}}const st=function(){return{matrixParams:"ignored",queryParams:"ignored",paths:"exact",fragment:"ignored"}},Fg=function(n){return{"compensate-margin":n}};function Lg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Mg,1,1,"alg-item-header",2),e.ALo(2,"async"),e.YNc(3,Sg,1,1,"alg-access-code-view",3),e.ALo(4,"async"),e.YNc(5,Ig,1,2,"alg-item-permissions",4),e.ALo(6,"async"),e.TgZ(7,"nav",5),e.ALo(8,"async"),e.ALo(9,"allowsEditingAll"),e.TgZ(10,"a",6,7),e.SDv(12,8),e.qZA(),e.TgZ(13,"a",6,9),e.SDv(15,10),e.qZA(),e.YNc(16,Pg,2,1,"ng-container",0),e.TgZ(17,"a",11,12),e.ALo(19,"async"),e._UZ(20,"i",13),e._uU(21," \xa0 "),e.TgZ(22,"span"),e.SDv(23,14),e.qZA()(),e.TgZ(24,"a",15,16),e.ALo(26,"allowsEditingAll"),e.TgZ(27,"span"),e.SDv(28,17),e.qZA()(),e.TgZ(29,"a",15,18),e.ALo(31,"allowsEditingAll"),e.TgZ(32,"span"),e.SDv(33,19),e.qZA()()(),e.TgZ(34,"div",20),e.ALo(35,"async"),e.ALo(36,"allowsEditingAll"),e.YNc(37,bg,1,1,"alg-error",21),e.YNc(38,yg,5,6,"ng-container",0),e.YNc(39,kg,3,7,"alg-item-progress",22),e.YNc(40,Rg,2,1,"ng-container",0),e.YNc(41,$g,2,1,"ng-container",0),e.qZA(),e.BQk()),2&n){const t=i.ngIf,o=e.MAs(11),r=e.MAs(14),a=e.MAs(18),s=e.MAs(25),_=e.MAs(30),l=e.oxw().ngIf,p=e.oxw(2);let C;e.xp6(1),e.Q6J("ngIf",!(null!=(C=e.lcZ(2,35,p.fullFrame$))&&C.active)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,37,p.showAccessCodeField$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,39,p.watchedGroup$)),e.xp6(2),e.Q6J("hidden",!e.lcZ(8,41,p.showProgressTab$)&&t.length<=1&&!e.lcZ(9,43,l.item.permissions)&&!a.isActive&&!s.isActive&&!_.isActive),e.xp6(3),e.ekj("active",o.isActive),e.Q6J("routerLink","./")("routerLinkActiveOptions",e.DdM(55,st))("hidden",t.length>1||r.isActive),e.xp6(3),e.ekj("active",r.isActive),e.Q6J("routerLink","./edit-children")("routerLinkActiveOptions",e.DdM(56,st))("hidden",t.length>1||!r.isActive),e.xp6(3),e.Q6J("ngIf",t.length>1),e.xp6(1),e.ekj("active",null==a?null:a.isActive),e.Q6J("hidden",!e.lcZ(19,45,p.showProgressTab$)&&!a.isActive)("routerLink","./progress"),e.xp6(7),e.ekj("active",s.isActive),e.Q6J("hidden",!e.lcZ(26,47,l.item.permissions)&&!s.isActive)("routerLink","./dependencies")("routerLinkActiveOptions",e.DdM(57,st)),e.xp6(5),e.ekj("active",_.isActive),e.Q6J("hidden",!e.lcZ(31,49,l.item.permissions)&&!_.isActive)("routerLink","./parameters")("routerLinkActiveOptions",e.DdM(58,st)),e.xp6(5),e.Q6J("ngClass",e.VKq(59,Fg,!e.lcZ(35,51,p.showProgressTab$)&&t.length<=1&&!e.lcZ(36,53,l.item.permissions))),e.xp6(3),e.Q6J("ngIf",p.unknownError),e.xp6(1),e.Q6J("ngIf",o.isActive||r.isActive||t.length>0),e.xp6(1),e.Q6J("ngIf",null==a?null:a.isActive),e.xp6(1),e.Q6J("ngIf",s.isActive),e.xp6(1),e.Q6J("ngIf",_.isActive)}}function Gg(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Lg,42,61,"ng-container",0),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.taskTabs$))}}function Ug(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Gg,3,3,"ng-container",0),e.BQk()),2&n){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",t.isReady&&t.data)}}function Zg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",43),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.skipBeforeUnload())}),e.qZA(),e.TgZ(1,"button",44),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.retryBeforeUnload())}),e.qZA()}}function Jg(n,i){1&n&&(e.TgZ(0,"p-dialog",40)(1,"p"),e.SDv(2,41),e.qZA(),e.YNc(3,Zg,2,0,"ng-template",42),e.qZA()),2&n&&e.Q6J("visible",!0)("modal",!0)("closeOnEscape",!1)("closable",!1)}const bt=new Error("load answer forbidden");let Qg=(()=>{class n{constructor(t,o,r,a,s,_){this.userService=t,this.groupWatchingService=o,this.itemDataSource=r,this.layoutService=a,this.getAnswerService=s,this.router=_,this.itemData$=this.itemDataSource.state$,this.showAccessCodeField$=this.itemData$.pipe((0,I.sf)(l=>l.item.promptToJoinGroupByCode&&!(0,v.hO)(l.item)&&!this.userService.isCurrentUserTemp()),(0,m.U)(l=>l.isReady&&l.data)),this.tabs=new P.t(1),this.tabs$=(0,O.a)([this.tabs,this.itemData$.pipe((0,I.RI)())]).pipe((0,m.U)(([l,p])=>(0,v._G)(p.item,p.currentResult)?l:l.filter(C=>"solution"!==C.view)),(0,m.U)(l=>l.filter(p=>!w.e.featureFlags.hideTaskTabs.includes(p.view))),(0,x.d)(1)),this.taskTabs$=this.tabs$.pipe((0,m.U)(l=>l.filter(p=>"progress"!==p.view))),this.showProgressTab$=(0,O.a)([this.itemData$.pipe((0,I.RI)()),this.groupWatchingService.isWatching$,this.tabs$]).pipe((0,m.U)(([l,p,C])=>!p&&(0,v.Sj)(l.item.permissions)&&C.some(h=>"progress"===h.view)||p&&(0,ie.H3)(l.item.permissions))),this.fullFrame$=this.layoutService.fullFrame$,this.watchedGroup$=this.groupWatchingService.watchedGroup$,this.formerAnswer$=this.itemData$.pipe((0,m.U)(l=>l.data?.route.answerId),(0,y.x)(),(0,E.w)(l=>l?this.getAnswerService.get(l):(0,D.of)(null)),(0,x.d)(1)),this.formerAnswerError$=this.formerAnswer$.pipe((0,J.K)(l=>(0,pe.Lg)(l)?(0,D.of)(bt):(0,D.of)(l instanceof Error?l:new Error("unknown error"))),(0,M.h)(l=>l instanceof Error)),this.formerAnswerLoadForbidden$=this.formerAnswerError$.pipe((0,M.h)(l=>l===bt)),this.answerFallbackLink$=(0,O.a)([this.itemData$.pipe((0,I.RI)()),this.formerAnswerLoadForbidden$]).pipe((0,m.U)(([{route:l}])=>(0,oe.PI)({...l,attemptId:void 0,parentAttemptId:void 0,answerId:void 0}))),this.taskReadOnly$=this.groupWatchingService.isWatching$,this.taskConfig$=(0,O.a)([this.formerAnswer$.pipe((0,J.K)(()=>z.E)),this.taskReadOnly$,this.itemData$.pipe((0,I.RI)())]).pipe((0,m.U)(([l,p,C])=>({readOnly:p,formerAnswer:l,locale:C.item.string.languageTag}))),this.skipBeforeUnload$=new N.x,this.retryBeforeUnload$=new N.x,this.beforeUnload$=new N.x,this.saveBeforeUnload$=(0,le.T)(this.beforeUnload$,this.retryBeforeUnload$).pipe((0,E.w)(()=>this.itemContentComponent?.itemDisplayComponent?this.itemContentComponent.itemDisplayComponent.saveAnswerAndState().pipe((0,J.K)(()=>(0,D.of)({saving:!1,error:new Error("fail")}))):(0,D.of)({saving:!1})),(0,we.R)(this.skipBeforeUnload$),function co(...n){return function so(...n){const i=(0,yt.yG)(n),t=(0,yt._6)(n,1/0);return n=(0,io.k)(n),(0,Z.e)((o,r)=>{(0,ro.J)(t)((0,ao.D)([o,...n],i)).subscribe(r)})}(...n)}(this.skipBeforeUnload$.pipe((0,m.U)(()=>({saving:!1})))),(0,x.d)(1)),this.savingAnswer$=this.saveBeforeUnload$.pipe((0,m.U)(({saving:l})=>l)),this.saveBeforeUnloadError$=this.saveBeforeUnload$.pipe((0,m.U)(({error:l})=>l)),this.subscriptions=[this.itemDataSource.state$.pipe((0,y.x)((l,p)=>l.data?.route.id===p.data?.route.id)).subscribe(l=>{l.isFetching&&this.tabs.next(this.showTaskTab()?[]:[{view:"progress",name:"Progress"}]),l.isReady&&this.tabs.next((0,ee.N2)(l.data.item)&&this.showTaskTab()?[]:[{view:"progress",name:"Progress"}])}),(0,Ke.R)(globalThis,"beforeunload",{capture:!0}).pipe((0,E.w)(()=>this.itemContentComponent?.itemDisplayComponent?.saveAnswerAndState()??(0,D.of)(void 0)),(0,k.q)(1)).subscribe({error:()=>{}}),this.formerAnswerError$.subscribe(l=>{l!==bt&&(this.unknownError=l)})],this.errorMessage="Une erreur est survenue. "+"Si le probl\xE8me persiste, contactez-nous."}isDirty(){return!!this.itemContentComponent?.isDirty()||!!this.itemEditWrapperComponent?.isDirty()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.tabs.complete()}reloadItem(){this.itemDataSource.refreshItem()}patchStateWithScore(t){this.itemDataSource.patchItemScore(t)}setTaskTabs(t){this.tabs.next(t),t.every(o=>o.view!==this.taskView)&&(this.taskView=t[0]?.view)}setTaskTabActive(t){this.taskView=t.view}beforeUnload(){return this.beforeUnload$.next(),this.saveBeforeUnload$.pipe((0,m.U)(({saving:t,error:o})=>!t&&!o),(0,M.h)(t=>t),(0,k.q)(1))}retryBeforeUnload(){this.retryBeforeUnload$.next()}skipBeforeUnload(){this.skipBeforeUnload$.next()}showTaskTab(){return!this.isProgressPage()&&!this.isDependenciesPage()&&!this.isParametersPage()}isProgressPage(){return this.router.url.includes("/progress/")}isDependenciesPage(){return this.router.url.includes("/dependencies")}isParametersPage(){return this.router.url.includes("/parameters")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Qe.o),e.Y36(ye.y),e.Y36(ke),e.Y36(wt.P),e.Y36(ks),e.Y36(Y.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-item-details"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Cg,5),e.Gf(_n,5),e.Gf(Cn,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.progressTab=r.first),e.iGM(r=e.CRH())&&(o.itemContentComponent=r.first),e.iGM(r=e.CRH())&&(o.itemEditWrapperComponent=r.first)}},decls:4,vars:6,consts:function(){let i,t,o,r,a,s,_,l,p,C,h,A,Q;return i="Ne pas sauvegarder la r\xE9ponse",t="Access to activity",o="Rejoindre",r=" Contenu ",a=" Contenu ",s="Avancement",_="Dependencies",l="Parameters",p="Unable to load the answer",C=" Unable to load the answer, " + "\ufffd#2\ufffd" + "load your most recent answer" + "\ufffd/#2\ufffd" + "",h="Vous ne semblez pas \xEAtre connect\xE9 \xE0 Internet, si vous quittez cette t\xE2che, vous perdrez vos changements. \xCAtes-vous s\xFBr de vouloir continuer ?",A="Perdre les changement et quitter la t\xE2che",Q="R\xE9essayer",[[4,"ngIf"],["header",i,3,"visible","modal","closeOnEscape","closable",4,"ngIf"],[3,"itemData",4,"ngIf"],["sectionLabel",t,"buttonLabel",o,3,"itemData","groupJoined",4,"ngIf"],[3,"itemData","watchedGroup","changed",4,"ngIf"],[1,"nav-tab",3,"hidden"],["routerLinkActive","",1,"nav-tab-item",3,"routerLink","routerLinkActiveOptions","hidden"],["contentTab","routerLinkActive"],r,["editChildrenTab","routerLinkActive"],a,["routerLinkActive","",1,"nav-tab-item",3,"hidden","routerLink"],["progressTab","routerLinkActive"],[1,"fa","fa-chart-line"],s,["routerLinkActive","",1,"nav-tab-item",3,"hidden","routerLink","routerLinkActiveOptions"],["dependenciesTab","routerLinkActive"],_,["parametersTab","routerLinkActive"],l,[1,"bg-white",3,"ngClass"],[3,"message",4,"ngIf"],[3,"itemData","isTaskReadOnly","savingAnswer","skipSave",4,"ngIf"],[3,"itemData"],["sectionLabel",t,"buttonLabel",o,3,"itemData","groupJoined"],[3,"itemData","watchedGroup","changed"],["class","nav-tab-item cursor-pointer",3,"routerLink","active","click",4,"ngFor","ngForOf"],[1,"nav-tab-item","cursor-pointer",3,"routerLink","click"],[3,"message"],[4,"ngIf","ngIfElse"],["fallback",""],p,C,[1,"alg-link",3,"routerLink"],["class","indicator",4,"ngIf"],[3,"hidden","itemData","taskConfig","savingAnswer","taskView","editModeEnabled","taskViewChange","taskTabsChange","scoreChange","skipSave","refresh"],[1,"indicator"],[3,"answer",4,"ngIf"],[3,"answer"],[3,"itemData","isTaskReadOnly","savingAnswer","skipSave"],["header",i,3,"visible","modal","closeOnEscape","closable"],h,["pTemplate","footer"],["pButton","","label",A,1,"p-button-danger",3,"click"],["pButton","","label",Q,3,"click"]]},template:function(t,o){1&t&&(e.YNc(0,Ug,2,1,"ng-container",0),e.ALo(1,"async"),e.YNc(2,Jg,4,4,"p-dialog",1),e.ALo(3,"async")),2&t&&(e.Q6J("ngIf",e.lcZ(1,2,o.itemData$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,o.saveBeforeUnloadError$)))},dependencies:[d.mk,d.sg,d.O5,Y.yS,Y.Od,Pe.jx,Rs.P,ne.q,It.V,_e.Hq,Ys,_n,Ml,Nl,Kl,Tg,Cn,d.Ov,q.fy],styles:[".indicator[_ngcontent-%COMP%]{padding:1rem;margin-right:2rem}.nav-tab[hidden][_ngcontent-%COMP%]{display:none}.compensate-margin[_ngcontent-%COMP%]{margin-top:-1rem}"]}),n})(),Bg=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[Y.Bz.forChild([{path:"by-id/:id",component:oo,children:[{path:"",redirectTo:"details",pathMatch:"full"},{path:"details",component:Qg,canDeactivate:[Je,S.w],children:[{path:"",pathMatch:"full",children:[]},{path:"edit-children",canDeactivate:[S.w],children:[]},{path:"parameters",canDeactivate:[S.w],children:[]},{path:"progress",children:[{path:"",redirectTo:"history",pathMatch:"full"},{path:"history",children:[]},{path:"chapter",children:[]},{path:"chapter-user-progress",children:[]}]},{path:"dependencies",children:[]}]},{path:"edit",component:pn,canDeactivate:[S.w],children:[{path:"",pathMatch:"full",children:[]},{path:"advanced-parameters",children:[]}]}]}]),Y.Bz]}),n})();var Vg=g(6284),Yg=g(8526);let zg=(()=>{class n{constructor(t){this.searchItemService=t,this.allowSkills=!1,this.addedItemIds=[],this.contentAdded=new e.vpe,this.allowedNewItemTypes=[],this.searchFunction=o=>this.searchItemService.search(o,(0,at.K)(this.allowSkills).map(r=>r.type))}ngOnChanges(t){this.allowedNewItemTypes=(0,at.K)(this.allowSkills)}addChild(t){this.contentAdded.emit(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Ln.b))},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-add-item"]],inputs:{allowSkills:"allowSkills",addedItemIds:"addedItemIds"},outputs:{contentAdded:"contentAdded"},features:[e.TTD],decls:2,vars:3,consts:function(){let i;return i="Ajouter du contenu",[["icon","sign-in-alt","label",i],[3,"allowedTypesForNewContent","searchFunction","addedIds","contentAdded"]]},template:function(t,o){1&t&&(e.TgZ(0,"alg-sub-section",0)(1,"alg-add-content",1),e.NdJ("contentAdded",function(a){return o.addChild(a)}),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("allowedTypesForNewContent",o.allowedNewItemTypes)("searchFunction",o.searchFunction)("addedIds",o.addedItemIds))},dependencies:[Yg.d,Gn.R]}),n})();const At=function(n){return{active:n}};function Xg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li",11),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onClick("as_info"))}),e.TgZ(1,"div",5),e.SDv(2,12),e.qZA(),e.TgZ(3,"div",7),e._UZ(4,"i",13),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(1,At,"as_info"===(null==t.childData?null:t.childData.contentViewPropagation)))}}function qg(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.onClick("as_content"))}),e.TgZ(1,"div",5),e.SDv(2,14),e.qZA(),e.TgZ(3,"div",7),e._UZ(4,"i",15),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(1,At,"as_content"===(null==t.childData?null:t.childData.contentViewPropagation)))}}const Hg=function(){return["as_info","as_content"]};let Wg=(()=>{class n{constructor(){this.clickEvent=new e.vpe}onClick(t){this.clickEvent.emit(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["alg-propagation-edit-menu"]],inputs:{childData:"childData"},outputs:{clickEvent:"clickEvent"},decls:13,vars:10,consts:function(){let i,t,o,r;return i="Default access",t="Locked and hidden",o="Locked",r="Open",[[1,"menu"],[1,"menu-item","menu-header","no-hover"],[1,"menu-item-title","uppercase","text-center"],i,[1,"menu-item","cursor-pointer",3,"ngClass","click"],[1,"menu-item-title"],t,[1,"menu-item-icon"],[1,"fa","fa-eye-slash"],["class","menu-item active cursor-pointer",3,"ngClass","click",4,"ngIf"],["class","menu-item cursor-pointer",3,"ngClass","click",4,"ngIf"],[1,"menu-item","active","cursor-pointer",3,"ngClass","click"],o,[1,"fa","fa-lock"],r,[1,"fa","fa-eye"]]},template:function(t,o){1&t&&(e.TgZ(0,"ul",0)(1,"li",1)(2,"div",2),e.SDv(3,3),e.qZA()(),e.TgZ(4,"li",4),e.NdJ("click",function(){return o.onClick("none")}),e.TgZ(5,"div",5),e.SDv(6,6),e.qZA(),e.TgZ(7,"div",7),e._UZ(8,"i",8),e.qZA()(),e.YNc(9,Xg,5,3,"li",9),e.ALo(10,"allowsGrantingView"),e.YNc(11,qg,5,3,"li",10),e.ALo(12,"allowsGrantingContentView"),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngClass",e.VKq(7,At,"none"===(null==o.childData?null:o.childData.contentViewPropagation))),e.xp6(5),e.Q6J("ngIf",(null==o.childData?null:o.childData.permissions)&&e.lcZ(10,3,o.childData.permissions)||e.DdM(9,Hg).includes((null==o.childData?null:o.childData.contentViewPropagation)||"")),e.xp6(2),e.Q6J("ngIf",(null==o.childData?null:o.childData.permissions)&&e.lcZ(12,5,o.childData.permissions)||"as_content"===(null==o.childData?null:o.childData.contentViewPropagation)))},dependencies:[d.mk,d.O5,F.j4,F.TB],styles:["[_ngcontent-%COMP%]:root{--base-color: #4A90E2;--base-bk-color: #F1F2F7;--base-text-color: #787878;--secondary-color: #F5A623;--warning-color: #f5a623;--danger-color: #ff001f;--secondary-btn-color: #4a4a4a;--base-color-hover: #779CCA;--base-dark-color-hover: #3B73B4;--hover-mask: rgba(white, .1);--light-text-color: #dbdbdb;--light-color: #DFE7F4;--light-border-color: #EBEBEB;--dark-text-color: #4A4A4A;--dark-color: #33649D;--dark-base-color: #2E5E95;--dark-secondary-color: rgb(195,131,27);--dark-black-color: #464646;--dark-transparency-color: rgba(74,74,74,.1);--input-transparency-color: rgba(0,0,0,.05);--nav-bk-color: #4E4E4E;--nav-bg-color: #4A90E2;--nav-bg-secondary-color: #3B73B4;--nav-bg-child-color: #3c7ac1;--nav-child-border-color: #2f6fc1;--nav-bg-handle-color: #3B73B4;--nav-border-color: #2e5e95;--nav-border-secondary-color: #4587D4;--nav-branch-border-color: #2e5e95;--nav-handle-icon-color: rgb(99, 150, 209);--nav-bg-hover-color: #779CCA;--nav-bg-hover-secondary-color: #578CCA;--nav-text-color: #4A90E2;--nav-dark-bg-color: #373738;--nav-dark-bg-secondary-color: #474747;--nav-dark-bg-child-color: #2c2b2b;--nav-dark-child-border-color: #313132;--nav-dark-bg-handle-color: #2C2C2C;--nav-dark-border-color: #313132;--nav-dark-border-secondary-color: #313132;--nav-dark-branch-border-color: rgba(255, 255, 255, .6);--nav-dark-handle-icon-color: rgba(255, 255, 255, .6);--nav-dark-bg-hover-color: #373738;--nav-dark-bg-hover-secondary-color: #676767;--nav-dark-text-color: #464646;--section-color: #DFE7F4;--section-border-color: #D1D9E5;--section-danger-color: #F2D9E0;--section-danger-handle-color: #FF001F;--section-danger-handle-border-color: #B20015;--section-warning-color: #fde8c8;--section-warning-handle-color: #f9b42c;--section-warning-handle-border-color: #ba861c;--session-left-view-color: #F2F2F2;--session-right-view-color: #E5E5E5;--notify-error-color: #FF001F;--lock-border-color: #c1c2c6}.menu[_ngcontent-%COMP%]{margin:0;padding:0;list-style-type:none}.menu-header[_ngcontent-%COMP%]{background-color:#33649d;background-color:var(--dark-color)}.menu-item[_ngcontent-%COMP%]{display:flex;margin:0;padding:.1rem .4rem;align-items:center;height:3rem;font-size:1.2rem;border-bottom:.1rem solid #4587d4;color:#fff}.menu-item[_ngcontent-%COMP%]:not(.no-hover):hover{background-color:#3b73b4;background-color:var(--base-dark-color-hover)}.menu-item.active[_ngcontent-%COMP%]{font-weight:700}.menu-item-title[_ngcontent-%COMP%]{flex:1;font-size:1.2rem}.menu-item-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-left:1rem;width:2.5rem}"]}),n})(),Kg=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[S.w,Je],imports:[d.ez,Bg,Vg.q,b.UX,Xe.WG,b.u5,vt.z,It.S,_e.hJ,un._8,St.L$,Ve.y]}),n})();e.B6R(pn,[d.O5,Y.yS,Y.Od,Tt.a,ut.b,b._Y,b.JL,b.sg,gn,fn],[d.Ov,q.fy,q.pG]),e.B6R(Kt,[d.mk,d.O5,nt.q,Pe.jx,de.iA,de.Ei,de.Wq,de.YL,de.UA,de.Mo,de.Mv,de.qO,ne.q,j.N,b.JJ,b.On,St.Rn,Ve.T,zg,Wg],[d.Ov])},2047:function(Ot){Ot.exports=function(){"use strict";return function(){var g=Math.floor(1000001*Math.random()),d={};function D(S){return Array.isArray?Array.isArray(S):-1!=S.constructor.toString().indexOf("Array")}var e={},Je=function(S){try{var M=JSON.parse(S.data);if("object"!=typeof M||null===M)throw"malformed"}catch{return}var $,Z,R,U=S.source,y=S.origin;if("string"==typeof M.method){var K=M.method.split("::");2==K.length?($=K[0],R=K[1]):R=M.method}if(typeof M.id<"u"&&(Z=M.id),"string"==typeof R){var m=!1;if(d[y]&&d[y][$])for(var k=0;k<d[y][$].length;k++)if(d[y][$][k].win===U){d[y][$][k].handler(y,R,M),m=!0;break}if(!m&&d["*"]&&d["*"][$])for(k=0;k<d["*"][$].length;k++)if(d["*"][$][k].win===U){d["*"][$][k].handler(y,R,M);break}}else typeof Z<"u"&&e[Z]&&e[Z](y,R,M)};return window.addEventListener?window.addEventListener("message",Je,!1):window.attachEvent&&window.attachEvent("onmessage",Je),{build:function(S){var M=function(u){if(S.debugOutput&&window.console&&window.console.log){try{"string"!=typeof u&&(u=JSON.stringify(u))}catch{}window.console.log("["+$+"] "+u)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof S)throw"Channel build invoked without a proper object argument";if(!S.window||!S.window.postMessage)throw"Channel.build() called without a valid window argument";window===S.window&&M("target window is same as present window -- use at your own risk");var y,U=!1;if("string"==typeof S.origin&&("*"===S.origin?U=!0:null!==(y=S.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(S.origin=y[0].toLowerCase(),U=!0)),!U)throw"Channel.build() called with an invalid origin";if(typeof S.scope<"u"){if("string"!=typeof S.scope)throw"scope, when specified, must be a string";if(S.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}else S.scope="__default";var $=function(){for(var u="",f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",T=0;T<5;T++)u+=f.charAt(Math.floor(Math.random()*f.length));return u}(),Z={},R={},K={},m=!1,k=[],E=[],J=function(u,f,T){if("function"==typeof S.gotMessageObserver)try{S.gotMessageObserver(u,T)}catch(I){M("gotMessageObserver() raised an exception: "+I.toString())}if(T.id&&f){K[T.id]={};var X=function(u,f,T){var X=!1,te=!1;return{origin:f,invoke:function(P,N){if(!K[u])throw"attempting to invoke a callback of a nonexistent transaction: "+u;for(var O=!1,V=0;V<T.length;V++)if(P===T[V]){O=!0;break}if(!O)throw"request supports no such callback '"+P+"'";w({id:u,callback:P,params:N})},error:function(P,N){if(te=!0,!K[u])throw"error called for nonexistent message: "+u;delete K[u],w({id:u,error:P,message:N})},complete:function(P){if(te=!0,!K[u])throw"complete called for nonexistent message: "+u;delete K[u],w({id:u,result:P})},delayReturn:function(P){return"boolean"==typeof P&&(X=!0===P),X},completed:function(){return te}}}(T.id,u,T.callbacks?T.callbacks:[]);if(Z[f])try{if(T.callbacks&&D(T.callbacks)&&T.callbacks.length>0)for(var te=0;te<T.callbacks.length;te++){for(var P=T.callbacks[te],N=T.params,O=P.split("/"),V=0;V<O.length-1;V++){var z=O[V];"object"!=typeof N[z]&&(N[z]={}),N=N[z]}N[O[O.length-1]]=function(){var I=P;return function(He){return X.invoke(I,He)}}()}var qe=Z[f](X,T.params);!X.delayReturn()&&!X.completed()&&X.complete(qe)}catch(I){var me="runtime_error",x=null;if("string"==typeof I?x=I:"object"==typeof I&&(I instanceof Error?(me=I.constructor.name,x=I.message):I&&D(I)&&2==I.length?(me=I[0],x=I[1]):"string"==typeof I.error&&(me=I.error,I.message?"string"==typeof I.message?x=I.message:I=I.message:x="")),null===x)try{typeof(x=JSON.stringify(I))>"u"&&(x=I.toString())}catch{x=I.toString()}X.error(me,x)}else X.error("method_not_found","No method '"+f+"' was (yet) bound by the provider")}else T.id&&T.callback?R[T.id]&&R[T.id].callbacks&&R[T.id].callbacks[T.callback]?R[T.id].callbacks[T.callback](T.params):M("ignoring invalid callback, id:"+T.id+" ("+T.callback+")"):T.id?R[T.id]?(T.error?R[T.id].error&&R[T.id].error(T.error,T.message):void 0!==T.result?R[T.id].success(T.result):R[T.id].success(),delete R[T.id],delete e[T.id]):M("ignoring invalid response: "+T.id):f&&Z[f]&&Z[f]({origin:u},T.params)};!function Xe(S,M,U,y){function $(K){for(var m=0;m<K.length;m++)if(K[m].win===S)return!0;return!1}var Z=!1;if("*"===M){for(var R in d)if(d.hasOwnProperty(R)&&"*"!==R&&"object"==typeof d[R][U]&&(Z=$(d[R][U])))break}else d["*"]&&d["*"][U]&&(Z=$(d["*"][U])),!Z&&d[M]&&d[M][U]&&(Z=$(d[M][U]));if(Z)throw"A channel is already bound to the same window which overlaps with origin '"+M+"' and has scope '"+U+"'";"object"!=typeof d[M]&&(d[M]={}),"object"!=typeof d[M][U]&&(d[M][U]=[]),d[M][U].push({win:S,handler:y})}(S.window,S.origin,S.scope,J);var oe=function(u){return[S.scope,u].join("::")},w=function(u,f){if(!u)throw"postMessage called with null message";if(f||m){if("function"==typeof S.postMessageObserver)try{S.postMessageObserver(S.origin,u)}catch(T){M("postMessageObserver() raised an exception: "+T.toString())}M("post message: "+JSON.stringify(u)+" with origin "+S.origin),S.window.postMessage(JSON.stringify(u),S.origin)}else M("queue message: "+JSON.stringify(u)),k.push(u)},Ce=function(u,f){u=[].concat(u);for(var T,X=0;X<u.length;X++)f[T=u[X].toString()]=function(te){return function(P,N,O){N?c.call({method:te,params:P,success:N,error:O}):c.notify({method:te,params:P})}}(T)},c={remote:{},unbind:function(u,f){if(Z[u]){if(!delete Z[u])throw"can't delete method: "+u;return S.publish&&!f&&(m?c.notify({method:"__unbind",params:u}):E.push({action:"unbind",method:u})),!0}return!1},bind:function(u,f,T){if(!u||"string"!=typeof u)throw"'method' argument to bind must be string";if(!f||"function"!=typeof f)throw"callback missing from bind params";if(Z[u])throw"method '"+u+"' is already bound!";return Z[u]=f,S.publish&&!T&&(m?c.notify({method:"__bind",params:u}):E.push({action:"bind",method:u})),this},call:function(u){if(!u)throw"missing arguments to call function";if(!u.method||"string"!=typeof u.method)throw"'method' argument to call must be string";if(!u.success||"function"!=typeof u.success)throw"'success' callback missing from call";var f={},T=[],X=[],te=function(N,O){if(X.indexOf(O)>=0)throw"params cannot be a recursive data structure";if(O&&X.push(O),"object"==typeof O)for(var V in O)if(O.hasOwnProperty(V)){var z=N+(N.length?"/":"")+V;"function"==typeof O[V]?(f[z]=O[V],T.push(z),delete O[V]):"object"==typeof O[V]&&te(z,O[V])}};te("",u.params);var P={id:g,method:oe(u.method),params:u.params};T.length&&(P.callbacks=T),u.timeout&&function(u,f,T){window.setTimeout(function(){R[u]&&(R[u].error&&R[u].error("timeout_error","timeout ("+f+"ms) exceeded on method '"+T+"'"),delete R[u],delete e[u])},f)}(g,u.timeout,oe(u.method)),R[g]={callbacks:f,error:u.error,success:u.success},e[g]=J,g++,w(P)},notify:function(u){if(!u)throw"missing arguments to notify function";if(!u.method||"string"!=typeof u.method)throw"'method' argument to notify must be string";w({method:oe(u.method),params:u.params})},destroy:function(){(function Y(S,M,U){for(var y=d[M][U],$=0;$<y.length;$++)y[$].win===S&&y.splice($,1);0===d[M][U].length&&delete d[M][U]})(S.window,S.origin,S.scope),window.removeEventListener?window.removeEventListener("message",J,!1):window.detachEvent&&window.detachEvent("onmessage",J),m=!1,Z={},K={},R={},S.origin=null,k=[],M("channel destroyed"),$=""}};return c.bind("__ready",function(u,f){if(M("ready msg received"),m&&!S.reconnect)throw"received ready message while in ready state.";m=!0,$.length<6&&($+="publish-request"===f.type?"-R":"-L"),M("ready msg accepted."),"publish-request"===f.type&&c.notify({method:"__ready",params:{type:"publish-reply",publish:E}});for(var T=0;T<f.publish.length;T++)"bind"===f.publish[T].action?Ce([f.publish[T].method],c.remote):delete c.remote[f.publish[T].method];for(S.reconnect||c.unbind("__ready",!0);k.length;)w(k.splice(0,1)[0]);E=[],"function"==typeof S.onReady&&S.onReady(c)},!0),c.bind("__bind",function(u,f){Ce([f],c.remote)},!0),c.bind("__unbind",function(u,f){c.remote[f]&&delete c.remote[f]},!0),S.remote&&Ce(S.remote,c.remote),setTimeout(function(){$.length>0&&w({method:oe("__ready"),params:{type:"publish-request",publish:E}},!0)},0),c}}}()}()}}]);
//# sourceMappingURL=134.e84988d770b92753.js.map