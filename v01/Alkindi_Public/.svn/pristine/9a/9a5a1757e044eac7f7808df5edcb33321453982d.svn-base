function initTask () {
   var data = {
      easy: {
         ciphertext: "Fva prtczqva Vqzhpr uv f'ropvv vw uv f'rjzrwzmq rffvprquva vwrzvqw vnxzbvva uv womza omwmoa, bmxo fva bovpzvova jvoazmqa. Fv 15 uvtvpsov 1938, tv qmpsov ixw bmowv r tzqn, umqw avxfvpvqw womza vwrzvqw tcmzaza bmxo vwov zqawrffva urqa fr prtczqv. Tcrnxv omwmo vwrzw pronxv u'xq tcziiov omprzq rizq uv bmxjmzo fva uzawzqhxvo : Z, ZZ, ZZZ, ZJ vw J. Wmxa q'vwrzvqw vnxzbva nxv u'xqv avxfv vqtmtcv.\n" +
            "Fr jvoazmq uv fr prtczqv Vqzhpr uv fr Eozvhaprozqv (prozqv uv hxvoov rffvprquv) r wmxdmxoa vwv imxoqzv rjvt bfxa uv omwmoa nxv fva rxwova jvoazmqa. Rx uvbrow, azl omwmoa vnxzbrzvqw fva prtczqva, bxza avbw vw izqrfvpvqw cxzw. Fva omwmoa axbbfvpvqwrzova vwrzvqw qxpvomwva JZ, JZZ vw JZZZ, vw rjrzvqw uva tmqqvlzmqa vfvtwoznxva uziivovqwva uva rxwova omwmoa. Zfa vwrzvqw vq mxwov vnxzbva uv uvxl vqtmtcva, tv nxz vqworzqrzw umqt xqv iovnxvqtv uv omwrwzmq axbvozvxov. Tvwwv jvoazmq, P4, tmpbwrzw nxrwov omwmoa urqa fr prtczqv r fr bfrtv uva womza uva rxwova jvoazmqa. Tvwwv jrozrqwv ixw tmqawoxzwv arqa pmuzizvo horquvpvqw fr prtczqv, vq ovpbfrtrqw azpbfvpvqw fv ovifvtwvxo u'mozhzqv bro xq rxwov svrxtmxb bfxa izq vw vq rdmxwrqw xq omwmo abvtzrf vq nxrwozvpv bmazwzmq. Tv nxrwozvpv omwmo bmxjrzw vwov uv uvxl wgbva : Svwr mx Hrppr. Zf qv wmxoqrzw tvbvqurqw drprza rxwmprwznxvpvqw, prza bmxjrzw vwov bfrtv prqxvffvpvqw axo f'xqv uv ava 26 bmazwzmqa bro f'mbvorwvxo.\n" +
            "Hortv r f'zqwvotmqqvlzmq rfvrwmzov uv tcrnxv omwmo, fr avnxvqtv vlrtwv uv tva axsawzwxwzmqa uvbvqurzw uv fr bmazwzmq zqzwzrfv uva omwmoa, uv fvxo mouov u'zqawrffrwzmq, vw ux tcmzl uva omwmoa (trsfrhv zqwvoqv). Tva ovhfrhva imopvqw fr tmqizhxorwzmq zqzwzrfv uv fr prtczqv.\n" +
            "Fva jvoazmqa fva bfxa tmxorqwva u'Vqzhpr amqw uzwva agpvwoznxva urqa fv avqa nxv fv tcziiovpvqw vw fv uvtcziiovpvqw uv f'zqimoprwzmq imqtwzmqqv uv fr pvpv prqzvov. Vq viivw, az f'mq wrbv fv wvlwv tcziiov urqa Vqzhpr, fr avnxvqtv uva frpbva rffxpvva tmoovabmquor rx wvlwv vq tfrzo. Prza tvfr qv imqtwzmqqv nxv urqa fv tra mx fr prtczqv bmaavuv fr pvpv tmqizhxorwzmq zqzwzrfv nxv tvffv nxz r tcziiov fv pvaarhv\n" +
            "Bmxo bfxa uv uvwrzfa axo fv trsfrhv uva omwmoa vw fv ovhfrhv uv f'rqqvrx vfrawznxv rzqaz nxv fvxoa viivwa axo fv tcziiovpvqw, tmqaxfwvo Uvwrzfa uva omwmoa uv f'Vqzhpr.\n" +
            "Vqzhpr vaw sovjvwvv vw uvjvfmbbvv bro f'zqhvqzvxo vq vfvtwoztzwv rffvprqu Rowcxo Atcvoszxa r browzo uv 1918. Zf rtcvwv tvbvqurqw vq 1927, rizq uv bomwvhvo ava bombova sovjvwa, fva uomzwa u'xqv  prtczqv r omwmoa  uvjvfmbbvv vw sovjvwvv uva 1919 bro fv tcvotcvxo qvvofrqurza Cxhm Rfvlrquvo Emtc (vq)7. Zf imquv xqv amtzvwv r Svofzq nxz bomuxzw vw jvqu fr bovpzvov jvoazmq tmppvotzrfv (Vqzhpr-R) vq 19236. Fv bozl vlmoszwrqw uv tvwwv prtczqv r f'vbmnxv (vnxzjrfvqw r 30 000 vxoma rxdmxou'cxz) vq izw xq vtcvt txzarqw. Womza rxwova jvoazmqa tmppvotzrfva jmqw axzjov, vw f'Vqzhpr-U uvjzvqw fv pmuvfv fv bfxa ovbrqux rbova amq rumbwzmq bro fr Prozqv rffvprquv vq 1926. F'rbbrovzf vaw vqaxzwv ovboza bro f'ropvv uv wvoov rffvprquv vq 1929. R browzo uv tv pmpvqw, amq xarhv vaw vwvqux r wmxwva fva imotva ropvva rffvprquva vw xqv horquv browzv uv fr czvorotczv qryzv. Fr Eozvhaprozqv axoqmppv Vqzhpr  fr prtczqv P .\n" +
            "Fv Uvxlzvpv Sxovrx iorqtrza, (umqw fv tcrohv uva tcziiova rffvprqua, fv trbzwrzqv Svoworqu), rtcvwv vq 1932 r Crqa-Wczfm Atcpzuw, imqtwzmqqrzov ux pzqzawvov uv fr Hxvoov r Svofzq, fv prqxvf mbvorwvxo Vqzhpr (f' Vqzhpr uv brbzvo ) vw xqv nxrqwzwv uv umtxpvqwa bfxa wrou worqapza rxl Bmfmqrza. Fv tcziiov Vqzhpr vaw bvqvwov uva 1933 bro fva prwcvprwztzvqa bmfmqrza Prozrq Ovdvkaez, Dvoyg Omygtez vw Cvqoge Yghrfaez nxz, tzqn rqa rbova, tmqtmzjvqw uva vqhzqa vfvtwompvtrqznxva, fva  smpsva 8.\n" +
            "Uva 1938, fv HT&TA, rzuv bro fva rbbmowa iorqtrza vw bmfmqrza, vqwov vq fztv. Vq uv qmpsovxava mttrazmqa, fva Rffvprqua ovqimotvqw fr avtxozwv u'Vqzhpr. Rx bozl uv pzffv uziiztxfwva, fva Sozwrqqznxva ovtmqawzwxvqw fva ovhfrhva vw brojzvqqvqw bvwzw r bvwzw r uvtogbwvo xq qmpsov tomzaarqw uv pvaarhva, prfhov uv fmqhxva bvozmuva uv womxa qmzoa. R fr izq uv fr hxvoov, Ovdvkaez, nxz tomgrzw nxv ava worjrxl q'rjrzvqw avojz r ozvq, ixw zpbovaazmqqv. Axo xqv irtv amqw uzabmava vq tvotfv uva tmqwrtwa vfvtwoznxva r rzhxzffva, umqt vnxzbva uv ovaamowa. Axo f'rxwov irtv, fv pvpv qmpsov uv tmqwrtwa bfrwa amqw uzabmava. Fva tmqwrtwa bfrwa vw r rzhxzffva ovbovavqwvqw f'rfbcrsvw - hvqvorfvpvqw fva 26 fvwwova (mq ivor tvwwv axbbmazwzmq urqa fr axzwv uv tvwwv uvatozbwzmq, pvpv az broimza uva tcziiova bmxjrzvqw vwov xwzfzava axzjrqw fv pvpv bozqtzbv).\n" +
            "Bvqurqw fr Avtmquv Hxvoov pmquzrfv, uziivovqwva jvoazmqa u'Vqzhpr amqw xwzfzavva bmxo fva worqapzaazmqa rffvprquva (prza rxaaz tvffva u'rxwova bxzaarqtva uv f'Rlv) rx qzjvrx uv fr uzjzazmq vw rx-uvaaxa. Tvowrzqa sxffvwzqa pvwvma amqw tcziiova rjvt Vqzhpr. Fva Vabrhqmfa (fmoa uv fr hxvoov tzjzfv vabrhqmfv) bxza fva Zwrfzvqa (bvqurqw fr Avtmquv Hxvoov pmquzrfv) xwzfzavqw xqv uva jvoazmqa tmppvotzrfva uv fr prtczqv, zqtcrqhvv, bmxo fvxoa tmppxqztrwzmqa pzfzwrzova. Tvwwv zpboxuvqtv svqviztzv rxl Sozwrqqznxva (vw tmqwozsxv r fr jztwmzov sozwrqqznxv irtv r fr ifmwwv zwrfzvqqv rx trb Prwrbrq).\n" +
            "Fr Omgrf Qrjg mohrqzav bfxazvxoa tmxba uv przq tmqwov uva tcrfxwzvoa ropva vw uva qrjzova-pvwvm. Uva vnxzbva uv bozav pmqwvqw r smou uv X-Smmwv rsrqumqqva bro fvxo vnxzbrhv. R tcrnxv imza, uva prqxvfa vw uva umtxpvqwa amqw trbwxova. Xq vlvpbfv : fv 9 prz 1941, f'X-110 vaw boza bro fva prozqa ux uvawomgvo CPA Sxffumh nxz orpvqvqw xq dvx uv wrsfva uv szhorppva, fv prqxvf xwzfzav bmxo tcziiovo fva orbbmowa pvwvm vw fv prqxvf xwzfzav bmxo tcziiovo fva pvaarhva tmxowa.\n" +
            "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxaaaaaaaaaaaaaaaaaaaaaaaaa\n" +
            "aaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbbb\n" +
            "rrrrrrrrrrrrrrrrrrrrrrrr",
         solutionHash: 16903
      },
      medium: {
         ciphertext: "L’ciclxhr sfrbmrijyrllr, am ciclxhr ur sfrbmrinrh, rhj mir grjeaur ur nfxkjciclxhr uaij lc urhnfykjyai lc klmh cinyriir rhj frclyhrr kcf Cl-Tyiuy cm YWr hyrnlr. Rllr naihyhjr c rwcgyirf lc sfrbmrinr urh lrjjfrh rgklaxrrh ucih mi grhhcdr neyssfr. Nrjjr grjeaur rhj sfrbmrggrij mjylyhrr kamf urnaurf urh grhhcdrh neyssfrh kcf hmohjyjmjyai, uaij mi rwrgklr jfrh hygklr rhj lr neyssfr ur Nrhcf.\n" +
            "L'ciclxhr sfrbmrijyrllr rhj ochrr hmf lr scyj bmr, ucih necbmr lcidmr, nrfjcyirh lrjjfrh am nagoyicyhaih ur lrjjfrh ckkcfcyhhrij cqrn mir nrfjcyir sfrbmrinr. Kcf rwrgklr, ri sfcincyh, lr r rhj lc lrjjfr lc klmh mjylyhrr, hmyqyr um c rj um h. Yiqrfhrgrij, lr v rhj krm mjylyhr.\n" +
            "Nrh yisafgcjyaih krfgrjjrij cmw nfxkjciclxhjrh ur scyfr urh exkajerhrh hmf lr jrwjr nlcyf, c naiuyjyai bmr l'cldafyjegr ur neyssfrgrij naihrfqr lc frkcfjyjyai urh sfrbmrinrh, nr bmy rhj lr nch kamf urh hmohjyjmjyaih gaia-clkecorjybmrh rj kalx-clkecorjybmrh.\n" +
            "Mir urmwyrgr naiuyjyai irnrhhcyfr kamf ckklybmrf nrjjr jrneiybmr rhj lc laidmrmf um nfxkjadfcggr. Ri rssrj, mi jrwjr jfak namfj ir frslrjr kch aolydcjayfrgrij lc frkcfjyjyai drirfclr urh sfrbmrinrh urh lrjjfrh. Ur klmh, hy lc nlr rhj ur lc grgr laidmrmf bmr lr grhhcdr, yl ir kamffc x cqayf ur frkrjyjyai ur lrjjfr rj l'ciclxhr sfrbmrijyrllr urqyriufc ygkahhyolr.\n" +
            "L'ciclxhr sfrbmrijyrllr ir krmj rjfr mjylyhrr bmr kamf urh naurh ur hmohjyjmjyaih hygklrh, rllr rhj kcf rwrgklr yirssyncnr naijfr lrh grjeaurh ur neyssfrgrij FHC rj URH. Rllr ir sainjyaiir kch kamf lrh naurh uyjh ur jfcihkahyjyai, bmy necidrij lc klcnr urh lrjjfrh am urh hxgoalrh ucih lr grhhcdr. Kamf hcqayf hy l'ai c csscyfr c mi naur ur hmohjyjmjyaih, ai krmj mjylyhrf l'yiuynr ur naïinyurinr cqcij l'ciclxhr sfrbmrijyrllr. Nrlc krfgrj rdclrgrij u'cqayf mir laidmrmf ur gaj nlr naihryllrr bmy krmj hrfqyf ur ochr kamf l'ciclxhr hjcjyhjybmr.\n" +
            "L'ciclxhr ur sfrbmrinrh ir krmj kch iai klmh rjfr mjylyhrr hy lc laidmrmf um grhhcdr rhj jfrh scyolr, ncf lc nlr hr frkrjrfc jfrh krm rj iamh ir kamffaih aohrfqrf ur kcfjynmlcfyjrh ucih lc sfrbmrinr urh lrjjfrh. N'rhj cmhhy kamf nrjjr fcyhai bmr l'ai ir krmj kch urneyssfrf mi grhhcdr naur cqrn mir laidmrmf ur nlr rdclr c nrllr um grhhcdr. Mi grgr grhhcdr neyssfr krmj naffrhkaiufr clafh c i'ygkafjr bmrl grhhcdr nlcyf, kmyhbm'yl x c cmjcij ur nlrh bmr ur nlcyfh. Iamh ir kamqaih uain kch ucih nr nch kfrnyh urjrfgyirf lr hrih drirfcl um grhhcdr, n'rhj lr kfyinykr um gchbmr prjcolr bmy dcfcijyj mi grhhcdr frrllrgrij yiurneyssfcolr.\n" +
            "Kamf hr kfrgmiyf u'mir nfxkjciclxhr kcf ciclxhr sfrbmrijyrllr, lrh nfxkjadfckerh aij yiqrijr klmhyrmfh kcfcurh mjylyhrrh ucih lrh cldafyjegrh ur neyssfrgrijh. Ai krmj mjylyhrf mi neyssfr bmy cjjfyomr klmhyrmfh hxgoalrh kamf mir hrmlr lrjjfr, ri sainjyai ur hc sfrbmrinr (kcf rwrgklr, ai mjylyhrfc bmcjfr am nyib hxgoalrh kamf lr R gcyh mi hrml kamf lr T). Ai uyj clafh bmr l'ai mjylyhr mi naur eagakeaiybmr.\n" +
            "Ai krmj rdclrgrij mjylyhrf lr hmfneyssfrgrij, bmy naihyhjr c frnaurf lr jrwjr neyssfr kcf mi cmjfr jxkr ur neyssfrgrij kamf ir kch krfgrjjfr ur scyfr urh exkajerhrh hmf lrh lrjjfrh lrh klmh sfrbmrijrh. Kamf mir nagoyicyhai ur neyssfrgrijh oyri neayhyr, mi jrwjr hmfneyssfr hrfc uain klmh uyssynylr c urneyssfrf.\n" +
            "Lr neyssfrgrij kcf hmohjyjmjyai rhj mir jrneiybmr ur neyssfrgrij mjylyhrr urkmyh oyri laidjrgkh kmyhbmr lr neyssfr ur Nrhcf ri rhj mi nch kcfjynmlyrf. Hcih cmjfr kfrnyhyai, rllr urhydir ri drirfcl mi neyssfrgrij kcf hmohjyjmjyai gaiaclkecorjybmr, bmy naihyhjr c hmohjyjmrf ucih mi grhhcdr necnmir urh lrjjfrh ur l'clkecorj kcf mir cmjfr (um grgr clkecorj am rqrijmrllrgrij u'mi cmjfr clkecorj), kcf rwrgklr, cyihy bmr kfanrucyj Nrhcf c kcf u, o kcf r rj cyihy ur hmyjr. Bmciu l'clkecorj u'cffyqrr rhj lr grgr, lc hmohjyjmjyai rhj ursyiyr kcf mir krfgmjcjyai urh lrjjfrh ur l'clkecorj. Gcyh lr neyssfrgrij kcf hmohjyjmjyai hr uyhjyidmr uain urh neyssfrgrijh kcf krfgmjcjyai, ursyiyh rmw kcf mir krfgmjcjyai urh lrjjfrh um grhhcdr.\n" +
            "Lr hygklr neyssfrgrij kcf hmohjyjmjyai rhj scnylr c nchhrf kcf ciclxhr urh sfrbmrinrh urh lrjjfrh um jrwjr neyssfr, gcyh urgrmfr nrkriucij ri jcij bmr nagkahcij rlrgrijcyfr urh neyssfrgrijh gaurfirh (nr haij lrh H-Oawrh urh frhrcmw ur hmohjyjmjyai-krfgmjcjyai).\n" +
            "Kamf ofamyllrf lc nfxkjciclxhr kcf ciclxhr ur sfrbmrinrh, uyqrfhrh jrneiybmrh ur hmohjyjmjyai klmh am gayih rlcoafrrh aij rjr yiqrijrrh cm namfh urh hyrnlrh, naggr lrh neyssfrgrijh kcf hmohjyjmjyai eagakeaiybmr (mir lrjjfr sfrbmrijr krmj rjfr frgklcnrr kcf urh hydirh uyssrfrijh), am kcf hmohjyjmjyai kalxclkecorjybmr.",
         solutionHash: 55320
      },
      hard: {
         ciphertext:  "AipNvprgbp,jtfhvppibqhgtmaipkgfbpmfrdip,pgbqbivbkgfbpaippitapjtf,sihtfpribqvbp,vfibqithvmqvtngtuimbikibqibOmvbri.Iqpvbpvaaimrdimrdimaips’Ihimbgb,aipAvtztb,sia’vbrfibqikhp,jt’faugtppgtufibbijt’ibriatf-rf,avrgbuibqfgb,a’ikhfmiiqavmgyvtqib’gbqutjtisipNvprgbpvtqfkgbsipvoovfmip,qikgfb,ibsimbfimafit:KK.Avfbi,Mvuiz,Sirvpip,Ufaaiai,Kvmqfnbvr.SiqgtpaipmgfpsiEgbvhvmqi,ibofb,tbpitaipqmipqi!VtppfEimbvsgqiipq-fanvprgb.\n"+
            "Qgtqrihmivketaib’ipqjtirijtibgtpvhhiagbptbihmirvtqfgbgmvqgfmi,vofbsisiqgtmbimsibgtpaipgthrgbsiugtagfmvqqvjtima’dgbbitmiqavhmgefqisiKK.aipbgqvfmip,vugtip,dtfppfimp,iqr.Bgtppvugbphvmovfqikibqefibjtipfa’gbvvskfpibhmfbrfhisimibsmictpqfrivrdvrtb,riqqictpqfri,jtfb’yugfqngtqqi,veipgfbs’goofrfimp;kvfp,rgkkifab’yvhvpsiefibfrf-evpjtfb’vfqhgtmomimitbvetp,vhmipvugfmhgpirgkkivxfgkijt’tbbgqvfmi,tbvugti,tbdtfppfimpgbqhvmkfaipfbuibqfgbppgrfvaip,ctsfrfvfmip,kfbfpqimfiaaip,hgafqfjtip,a’fbuibqfgbavhatpainfqfki,avhatpefibovfpvbqi,jt’fabgtppgfqhimkfps’ixvkfbimaipsvbnimpvqqvrdipvripefibovfqp.Avrvppvuisgbbiaihvfbvtxbinmip;iqpfa’gbb’gqihvpqgtqpgbavfqaikvbfgrsiufibqtbhgfpgb.\n"+
            "Avegbbiogfipqvmmfuiivtbqiahgfbqsihimoirqfgb,jtikikitbrgbqmvqefibibogmkiiqefibixhafjtibipfnbfofijtiajtiogfpmfib;iqa’gbugtsmvfqpihvppimsibgqvfmip,jtfpgbqsipiphiripsirgkhvnbfips’vpptmvbrirgbqmiaipfbrimqfqtsipsiavrgbprfibri;s’vugtip,jtf,ibctpqfri,ogbqa’goofrisipvbrfibphvmmvfbpsvbpaipctnikibqpsihvmSfit!Ritx-rf,ibiooiq,vmkvfibqaiprgkevqqvbp,vmmvbnivfibqaiprtfmvppip,ugyvfibqpfaipihiipiqvfibqefibvoofaiip,iqrmfvfibqvthithai,rdvrtbsipgbrgqi,jtiairgkevqqvbqvuvfqmvfpgb.Jtisfveai!pgygbpctpqipiqmirgbbvfppgbpsvbpripsitxpgmqips’goofrfimptbifbpqfqtqfgbkgbvmrdfjti,tbivbqfjtfqioigsvai.\n"+
            "Mirgbbvfppgbpibptfqisiprdvbnikibpbgqveaip,sipvkiafgmvqfgbppibpfeaipsvbpaihimpgbbiasiripsitxiqvqp,iqmibsgbpnmvrivriqqihimoirqfefafqifbsiofbfiuimpavjtiaaibgtpqibsgbppvbprippi.\n"+
            "Vtqmiogfp,jt’ipq-rijtir’iqvfqjt’tbhmgrtmitmiqjt’tbrgbpifaaimbgqvfmi?sitxiqmipaiphatpkvtppvsipstkgbsiiqaiphatpsipvnmiveaipvugfm:aihmgrtmitmiqvfqtbdgkkiqgtcgtmpdvefaaisibgfm,rgfoois’tbivkhaihimmtjtiravppfjti,bihvmavbqjtisipvoovfmips’vtqmtf,iqibqimkipevmevmipjtfeaippvfibqa’gmifaai;qgtcgtmpibogtfppgtptbevqfkibqsihvhimvppipibsirgkemip,aiphmgrtmitmpogtfaavfibqaipqfqmip,pirgtumvfibqs’tbihgtppfimimfsfrtai,hmibvfibqvrœtma’fbqimiqs’tbrafibqctpjt’vpiovfmiirdfbimhgtmatf;fapb’vaavfibqcvkvfpsvbpaikgbsi,bipiugyvfibqjt’ibqmiitx;ibofbtbhmgrtmitmhmgsfntihvppvfqhgtmtbkgbpqmi,iqriatfjtfvtmvfqiqivppizdvmsfhgtmvaaimvtRdvqiaiqibugfqtmi,itqiqiqvxisiogafi.Vtegtqsijtiajtirfbjtvbqivbp,hvppipsvbpavnibiiqavhmvqfjti,fappimiqfmvfibqvjtiajtirvkhvnbi,gtfapb’vuvfibqhatps’vtqmicgfijtisiugfmhvppimsinmvbsipevbsipsirgmeivtxjtfaitmmvhhiavfibqa’dgbgmveairgmhpsiphmgrtmitmpvtxnmvbspcgtmps’vppikeaii.Gbvuvfqofbfhvmaipmiphirqimrgkkisipogtphitsvbnimitx.\n"+
            "Qgtqvtrgbqmvfmi,tbvugtis’vtcgtms’dtfipqtbcitbidgkkivfkveai,nvf,phfmfqtia,kfprgkkiaiuitqa’vmmiqpthmikimibstrdizQgmqgbf;fargtmqaipevap,aipoiqip,aiprgbrimqp;pvoikki,hvmpvqgfaiqqi,irmvpiaipsvkipsiavrgtm;bgqmivugtisisvfnbiqgtqrijtfb’ipqhvpiainvbq,pgbrvefbiqipqtbegtsgfm,pvefeafgqdijtiipqsvbppvqiqi;fahavfpvbqisiprdgpipaiphatpnmvuip,iqbgqmiditmitpiOmvbrivriavsieivt,jt’gbyhmibsqgtqibmfvbq;bgtpvaagbpa’ixhmghmfim,bgtpvaagbpaihgtmptfumi,qgtqriavipqsfqvuiraipimfitxsiHgafrdfbiaai.Aipvugtiprgtmibqibrvemfgaiq,cgtibqva’irvmqi,aipraimrpogbqsipuvtsiufaaip,iqqgtq,sfpibq-fap,b’ibuvhvphatpkva.\n"+
            "Aipbgqvfmipvuvfibqagbn-qikhpmipfpqivavhimoirqfefafqi;aipfsiipsirirgmhpatqqvfibqvuirrgtmvnirgbqmiaipfsiipbgtuiaaip;kvfpibofbfargkkibrivpikiqqmivtbfuivtstpfirai,iqmfibsihatpgmsfbvfmijtisiugfmsvbptbpvagbsvbpimtbbgqvfmi,tbkisirfb,tbvugti,tbdtfppfimiqtbctni.PfSfitugtavfqjt’fayitqvtppftbkfbfpqmi,gbhgtmmvfqkgtmfmibhaifbeva,ptms’vugfmaipjtvqmiovrtaqipvpiprgqip,iqsihgtugfmovfmipgbqipqvkibqsvbpaipogmkip.\n"+
            "Fayvibrgmisipbfvfpjtfp’fkvnfbibqegbbikibqjt’tbvugti,tbbgqvfmipgbqsipnibpqibtpsip’grrthim,aiptbps’vaaimvtHvavfpsioibsmi,vppfpqimaitmprafibqp,iqsiqmgtuimsvbpaiprgsipsipvmkippgafsip;aipvtqmipsimisfnimiqsiefibrgkhmibsmiaipfbqibqfgbpsiprgbqmvrqvbp;qgtqriaviqvfqegbsvbpaipfiraihvppi,gtqgtqhmibvfqtbiogmkifsivai,gtrdvjtiiqvqiqvfqmihmipibqihvmtbipgkkis’geafnvqfgbpvmikhafm;vtcgtms’dtfgbvqgtqkgbiqfpi:vfbpfa’gbbisfqhvp,kgbpfitmtbqiaviqibgkkihmgrtmitm-nibimva,fauvpgtqibfmaipfbqimiqpsipvhmgufbrirgkkiAvrdvagqvfp.Bgb,immitm;kgbpfitmtbqiaufibqs’vugfmtbieiaaihavri,hmgrtmitm-nibimva...riavuvtqufbnqkfaaiom.siqmvfqikibq:favsihibpiribqkfaaiomvbrphgtmiqmibgkki:vfbpfpgbvmnibqipqhavrivufbnqhgtmribq.\n"+
            "Sikikigbbipiovfqhatpvugtigtbgqvfmisvbpaietqhmfkfqfosipvhmgoippfgb;gbibqmiugfqefibjt’gbfmvvtHvavfphvm-rf,hvm-av,gtjt’gboimvsipvrqipiqsipfbuibqvfmip;kvfpavhmikfimihibpiiipqriaai-rf:Ibvrdiqvbqtbirdvmni…sitxribqkfaaiomvbrp,hmibvbqjt’iaaimvhhgmqiufbnqkfaaiomvbrp,a’vmnibqipqhavrivsfx.Vfbpfgbhavrikfitxibbgqvfmijt’ibqimmip,ibvugtijt’ibkvfpgbp.Faovtqrgbuibfmjtia’gbvrmiiibOmvbrisibgtuiaaipmfrdippipvavhavris’fsiiprmitpip.Qgtqp’ipqvfbpfmistfqvtbipitaiixhmippfgb,iqsvbpqgtqgbugfqtbiogmkihatpgtkgfbphmgstrqfui;kvfpgtpgbqaipmiuibtp?ptmjtiaaipqimmippgbq-fapvppfp?Vd!ugfavairdvhfqmisipsvbnimp.\n"+
            "Tbiogfpjtia’gbsfqvtbdgkki:Ugfavstnvagbs’vmnibqhgtmemgsimugqmidvefq,b’ibkiqqizjtiptmaiphvmikibpgtvtrgaaiq,hmibizavegefbi,aiegefbiqipqvsfprmiqfgb,aiphvppfgbp,aipibufipsioikkipnmgppip,qgtqvmmfuiibogtai,iqvagmpgbkiqstnvagbptmqgtqipaiprgtqtmip;htfptbeivtkvqfbavegefbiipqpirdirgkkitbragt.\n",
         solutionHash: 63143
      }
   };
   var answer = null;
   var state = null;
   var level = null;
   var correctCharsRequired = 60;
   var tool;
   var font = "alien";
   var defaultToolHTML;

   task.load = function(views, callback) {
      saveDefaultHTML();
      displayHelper.thresholdEasy = 120;
      displayHelper.thresholdMedium = 180;
      displayHelper.avatarType = "laptop";
      displayHelper.setupLevels();

      // displayHelper.hideValidateButton = true;
      //displayHelper.hideRestartButton = true;

      if (views.solutions) {
         $("#solution").show();
      }
      
      callback();
   };

   task.unload = function(callback) {
      try {
         delete window.Highcharts;
         delete window.HighchartsAdapter;
      }
      catch(e) {
         window.Highcharts = undefined;
         window.HighchartsAdapter = undefined;
      }
      callback();
   };

   task.getDefaultStateObject = function() {
      return { level: "easy" };
   };

   task.getStateObject = function() {
      state.level = level;
      return state;
   };

   task.reloadStateObject = function(stateObj, display) {
      state = stateObj;
      level = state.level;

      if (display) {
         resetToolState();
      }
   };

   task.reloadAnswerObject = function(answerObj) {
      answer = answerObj;
      if(!answer[level]) {
         if(isToolShowing()) {
            resetToolState();
         }
         return;
      }
      if(!tool.mSub) {
         $(".section-output").show();
         tool.clickApplyInput();
      }
      updateToolSubstitution();
   };

   task.getAnswerObject = function() {
      if(tool && tool.mSub) {
         // TODO Is copying really necessary?
         answer[level] = $.extend(true, [], tool.mSub);
      }
      return answer;
   };

   task.getDefaultAnswerObject = function() {
      return {};
   };
         
   var saveDefaultHTML = function() {
      defaultToolHTML = $("#tool").html();
   };
   
   var loadDefaultHTML = function() {
      $("#tool").html(defaultToolHTML);
      $("#apply-input").click(function() {
         $(".section-output").show();
      });
   };
   
   var isToolShowing = function() {
      return tool && tool.mSub;
   };
   
   var resetToolState = function() {
      loadDefaultHTML();
      tool = new frequency_analyzer(data[level].ciphertext, font);
      tool.init();
   };
   
   var updateToolSubstitution = function() {
      tool.updateSub(answer[level], font);
      tool.updateChartSum();
      tool.updateTokensSub(tool.mTokens, answer[level]);
      tool.displayOutput(tool.mTokens);
   };
   
   var accentReplace = function(str) {
      str = str.replace(/[ÂÃÄÀÁÅ]/gi, "A");
      str = str.replace(/[Ç]/gi,      "C");
      str = str.replace(/[ÈÉÊË]/gi,   "E");
      str = str.replace(/[ÌÍÎÏ]/gi,   "I");
      str = str.replace(/[Ñ]/gi,      "N");
      str = str.replace(/[ÒÓÔÕÖØ]/gi, "O");
      str = str.replace(/[ÙÚÛÜ]/gi,   "U");
      str = str.replace(/[Ý]/gi,      "Y");
      str = str.replace(/[âãäàáå]/gi, "a");
      str = str.replace(/[ç]/gi,      "c");
      str = str.replace(/[èéêë]/gi,   "e");
      str = str.replace(/[ìíîï]/gi,   "i");
      str = str.replace(/[ñ]/gi,      "n");
      str = str.replace(/[òóôõöø]/gi, "o");
      str = str.replace(/[ùúûü]/gi,   "u");
      str = str.replace(/[ý]/gi,      "y");
      return str;
   };

   var hashText = function(text) {
      var value = 0;
      for (var iLetter = 0; iLetter < text.length; iLetter++) {
         var code = text.charCodeAt(iLetter);
         value += code;
         value = (value * 19) % 79197;
      }
      return value;
   }
      
   var getResultAndMessage = function(answer, level) {
      // For efficiency (tool uses array of pairs).
      var answerDict = {};
      for(var iKey in answer[level]) {
         answerDict[answer[level][iKey].key] = answer[level][iKey].value;
      }
      
      var max = Math.min(correctCharsRequired, data[level].ciphertext.length);
      var cipherText = data[level].ciphertext.toLowerCase();
      var clearText = "";
      for(var iLetter = 0; iLetter < max; iLetter++) {
         var cipherLetter = cipherText.charAt(iLetter);
         if(!cipherLetter.match(/[a-z]/)) {
            continue;
         }
         clearText += answerDict[cipherLetter];
      }

      var hash = hashText(clearText);
      if (hash == data[level].solutionHash) {
         return {
            result: "correct"
         };
      } else {
         return {
            result: "bad",
            message: "Il faut déchiffrer au moins la première ligne."
         };
      }
   };

   grader.gradeTask = function(strAnswer, token, callback) {
      task.getLevelGrade(strAnswer, token, callback, null);
   };

   task.getLevelGrade = function(strAnswer, token, callback, gradedLevel) {
      var answer = $.parseJSON(strAnswer);
      var taskParams = displayHelper.taskParams;
      var scores = {};
      var messages = {};
      var maxScores = displayHelper.getLevelsMaxScores();

      // clone the state to restore after grading.
      var oldState = $.extend({}, task.getStateObject());
      for (var curLevel in data) {
         state.level = curLevel;
         task.reloadStateObject(state, false);

         var resultAndMessage = getResultAndMessage(answer, curLevel);
         if (resultAndMessage.result == "correct") {
            scores[curLevel] = maxScores[curLevel];
            messages[curLevel] = "Bravo ! Vous avez réussi.";
         }
         else {
            scores[curLevel] = taskParams.noScore;
            messages[curLevel] = resultAndMessage.message;
         }
      }

      task.reloadStateObject(oldState, false);
      if (!gradedLevel) {
         displayHelper.sendBestScore(callback, scores, messages);
      } else {
         callback(scores[gradedLevel], messages[gradedLevel]);
      }
   };
}

initTask();
